<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Глава 4 Техники программирования | Визуализация и анализ географических данных на языке R</title>
  <meta name="description" content="Курс лекций, посвященных использованию языка программирования R для визуализации и анализа географических данных" />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="Глава 4 Техники программирования | Визуализация и анализ географических данных на языке R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Курс лекций, посвященных использованию языка программирования R для визуализации и анализа географических данных" />
  <meta name="github-repo" content="tsamsonov/r-geo-course" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Глава 4 Техники программирования | Визуализация и анализ географических данных на языке R" />
  
  <meta name="twitter:description" content="Курс лекций, посвященных использованию языка программирования R для визуализации и анализа географических данных" />
  

<meta name="author" content="Тимофей Самсонов" />


<meta name="date" content="2020-02-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="tables.html"/>
<link rel="next" href="graphics.html"/>
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets/htmlwidgets.js"></script>
<link href="libs/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding/datatables.js"></script>
<link href="libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk/js/crosstalk.min.js"></script>
<script src="libs/plotly-binding/plotly.js"></script>
<script src="libs/typedarray/typedarray.min.js"></script>
<link href="libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main/plotly-latest.min.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Визуализация и анализ географических данных на языке R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Введение</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#программное-обеспечение"><i class="fa fa-check"></i>Программное обеспечение</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#установка-и-подключение-пакетов"><i class="fa fa-check"></i>Установка и подключение пакетов</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#выполнение-программного-кода"><i class="fa fa-check"></i>Выполнение программного кода</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#установка-рабочей-директории"><i class="fa fa-check"></i>Установка рабочей директории</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#диагностические-функции"><i class="fa fa-check"></i>Диагностические функции</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#получение-справки"><i class="fa fa-check"></i>Получение справки</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#комментарии"><i class="fa fa-check"></i>Комментарии</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#стандарт-оформления-кода-на-r"><i class="fa fa-check"></i>Стандарт оформления кода на R</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#зарезервированные-слова"><i class="fa fa-check"></i>Зарезервированные слова</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#названия-переменных"><i class="fa fa-check"></i>Названия переменных</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#названия-специальных-символов"><i class="fa fa-check"></i>Названия специальных символов</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#ссылка-на-пособие"><i class="fa fa-check"></i>Ссылка на пособие</a></li>
</ul></li>
<li class="part"><span><b>I Основы языка R</b></span></li>
<li class="chapter" data-level="1" data-path="data-types.html"><a href="data-types.html"><i class="fa fa-check"></i><b>1</b> Типы данных, условия, ввод и вывод</a><ul>
<li class="chapter" data-level="1.1" data-path="data-types.html"><a href="data-types.html#data_types"><i class="fa fa-check"></i><b>1.1</b> Типы данных</a><ul>
<li class="chapter" data-level="1.1.1" data-path="data-types.html"><a href="data-types.html#numbers"><i class="fa fa-check"></i><b>1.1.1</b> Числа</a></li>
<li class="chapter" data-level="1.1.2" data-path="data-types.html"><a href="data-types.html#strings"><i class="fa fa-check"></i><b>1.1.2</b> Строки</a></li>
<li class="chapter" data-level="1.1.3" data-path="data-types.html"><a href="data-types.html#dates"><i class="fa fa-check"></i><b>1.1.3</b> Даты</a></li>
<li class="chapter" data-level="1.1.4" data-path="data-types.html"><a href="data-types.html#booleans"><i class="fa fa-check"></i><b>1.1.4</b> Логические</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="data-types.html"><a href="data-types.html#manipulations"><i class="fa fa-check"></i><b>1.2</b> Манипуляции с типами</a><ul>
<li class="chapter" data-level="1.2.1" data-path="data-types.html"><a href="data-types.html#determine_data_type"><i class="fa fa-check"></i><b>1.2.1</b> Определение типа данных</a></li>
<li class="chapter" data-level="1.2.2" data-path="data-types.html"><a href="data-types.html#conversion"><i class="fa fa-check"></i><b>1.2.2</b> Преобразование типов данных</a></li>
<li class="chapter" data-level="1.2.3" data-path="data-types.html"><a href="data-types.html#check_types"><i class="fa fa-check"></i><b>1.2.3</b> Проверка типов данных и пустых значений</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="data-types.html"><a href="data-types.html#read_write_console"><i class="fa fa-check"></i><b>1.3</b> Ввод и вывод данных в консоли</a><ul>
<li class="chapter" data-level="1.3.1" data-path="data-types.html"><a href="data-types.html#read_console"><i class="fa fa-check"></i><b>1.3.1</b> Ввод данных</a></li>
<li class="chapter" data-level="1.3.2" data-path="data-types.html"><a href="data-types.html#write_console"><i class="fa fa-check"></i><b>1.3.2</b> Вывод данных</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="data-types.html"><a href="data-types.html#ifelse"><i class="fa fa-check"></i><b>1.4</b> Условный оператор</a></li>
<li class="chapter" data-level="1.5" data-path="data-types.html"><a href="data-types.html#switch"><i class="fa fa-check"></i><b>1.5</b> Оператор переключения</a></li>
<li class="chapter" data-level="1.6" data-path="data-types.html"><a href="data-types.html#stop"><i class="fa fa-check"></i><b>1.6</b> Прерывание программы</a></li>
<li class="chapter" data-level="1.7" data-path="data-types.html"><a href="data-types.html#basics-detail"><i class="fa fa-check"></i><b>1.7</b> Технические детали</a></li>
<li class="chapter" data-level="1.8" data-path="data-types.html"><a href="data-types.html#review"><i class="fa fa-check"></i><b>1.8</b> Краткий обзор</a></li>
<li class="chapter" data-level="1.9" data-path="data-types.html"><a href="data-types.html#questions_tasks_basics"><i class="fa fa-check"></i><b>1.9</b> Контрольные вопросы и упражнения</a><ul>
<li class="chapter" data-level="1.9.1" data-path="data-types.html"><a href="data-types.html#questions_basics"><i class="fa fa-check"></i><b>1.9.1</b> Вопросы</a></li>
<li class="chapter" data-level="1.9.2" data-path="data-types.html"><a href="data-types.html#tasks_basic"><i class="fa fa-check"></i><b>1.9.2</b> Упражнения</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-structures.html"><a href="data-structures.html"><i class="fa fa-check"></i><b>2</b> Структуры данных и циклы</a><ul>
<li class="chapter" data-level="2.1" data-path="data-structures.html"><a href="data-structures.html#data_structures_homo"><i class="fa fa-check"></i><b>2.1</b> Однородные структуры данных</a><ul>
<li class="chapter" data-level="2.1.1" data-path="data-structures.html"><a href="data-structures.html#vectors"><i class="fa fa-check"></i><b>2.1.1</b> Векторы</a></li>
<li class="chapter" data-level="2.1.2" data-path="data-structures.html"><a href="data-structures.html#matrices"><i class="fa fa-check"></i><b>2.1.2</b> Матрицы</a></li>
<li class="chapter" data-level="2.1.3" data-path="data-structures.html"><a href="data-structures.html#arrays"><i class="fa fa-check"></i><b>2.1.3</b> Массивы</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="data-structures.html"><a href="data-structures.html#heterogeneous"><i class="fa fa-check"></i><b>2.2</b> Разнородные структуры данных</a><ul>
<li class="chapter" data-level="2.2.1" data-path="data-structures.html"><a href="data-structures.html#data_frames"><i class="fa fa-check"></i><b>2.2.1</b> Фреймы данных</a></li>
<li class="chapter" data-level="2.2.2" data-path="data-structures.html"><a href="data-structures.html#lists"><i class="fa fa-check"></i><b>2.2.2</b> Списки</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="data-structures.html"><a href="data-structures.html#factors"><i class="fa fa-check"></i><b>2.3</b> Факторы</a></li>
<li class="chapter" data-level="2.4" data-path="data-structures.html"><a href="data-structures.html#vector_desc"><i class="fa fa-check"></i><b>2.4</b> Описание структуры данных</a></li>
<li class="chapter" data-level="2.5" data-path="data-structures.html"><a href="data-structures.html#cycles"><i class="fa fa-check"></i><b>2.5</b> Циклы</a></li>
<li class="chapter" data-level="2.6" data-path="data-structures.html"><a href="data-structures.html#structures-detail"><i class="fa fa-check"></i><b>2.6</b> Технические детали</a></li>
<li class="chapter" data-level="2.7" data-path="data-structures.html"><a href="data-structures.html#review_structures"><i class="fa fa-check"></i><b>2.7</b> Краткий обзор</a></li>
<li class="chapter" data-level="2.8" data-path="data-structures.html"><a href="data-structures.html#questions_tasks_vectors"><i class="fa fa-check"></i><b>2.8</b> Контрольные вопросы и упражнения</a><ul>
<li class="chapter" data-level="2.8.1" data-path="data-structures.html"><a href="data-structures.html#questions_vectors"><i class="fa fa-check"></i><b>2.8.1</b> Вопросы</a></li>
<li class="chapter" data-level="2.8.2" data-path="data-structures.html"><a href="data-structures.html#tasks_vectors"><i class="fa fa-check"></i><b>2.8.2</b> Упражнения</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="tables.html"><a href="tables.html"><i class="fa fa-check"></i><b>3</b> Табличные данные</a><ul>
<li class="chapter" data-level="3.1" data-path="tables.html"><a href="tables.html#tables_prerequisites"><i class="fa fa-check"></i><b>3.1</b> Предварительные требования</a></li>
<li class="chapter" data-level="3.2" data-path="tables.html"><a href="tables.html#tables_datastructures"><i class="fa fa-check"></i><b>3.2</b> Структуры данных</a></li>
<li class="chapter" data-level="3.3" data-path="tables.html"><a href="tables.html#tables_reading"><i class="fa fa-check"></i><b>3.3</b> Чтение</a><ul>
<li class="chapter" data-level="3.3.1" data-path="tables.html"><a href="tables.html#tables_reading_inner"><i class="fa fa-check"></i><b>3.3.1</b> Встроенные данные</a></li>
<li class="chapter" data-level="3.3.2" data-path="tables.html"><a href="tables.html#tables_reading_text"><i class="fa fa-check"></i><b>3.3.2</b> Текстовые таблицы</a></li>
<li class="chapter" data-level="3.3.3" data-path="tables.html"><a href="tables.html#tables_reading_excel"><i class="fa fa-check"></i><b>3.3.3</b> Таблицы Microsoft Excel</a></li>
<li class="chapter" data-level="3.3.4" data-path="tables.html"><a href="tables.html#tables_reading_params"><i class="fa fa-check"></i><b>3.3.4</b> Параметры</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="tables.html"><a href="tables.html#tables_view"><i class="fa fa-check"></i><b>3.4</b> Просмотр</a></li>
<li class="chapter" data-level="3.5" data-path="tables.html"><a href="tables.html#tables_elements"><i class="fa fa-check"></i><b>3.5</b> Столбцы, строки и ячейки</a><ul>
<li class="chapter" data-level="3.5.1" data-path="tables.html"><a href="tables.html#tables_elements_names"><i class="fa fa-check"></i><b>3.5.1</b> Названия</a></li>
<li class="chapter" data-level="3.5.2" data-path="tables.html"><a href="tables.html#tables_elements_columns"><i class="fa fa-check"></i><b>3.5.2</b> Обращение к столбцам</a></li>
<li class="chapter" data-level="3.5.3" data-path="tables.html"><a href="tables.html#tables_elements_rows"><i class="fa fa-check"></i><b>3.5.3</b> Обращение к строкам</a></li>
<li class="chapter" data-level="3.5.4" data-path="tables.html"><a href="tables.html#tables_elements_cells"><i class="fa fa-check"></i><b>3.5.4</b> Обращение к ячейкам</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="tables.html"><a href="tables.html#tables_manipuilations"><i class="fa fa-check"></i><b>3.6</b> Преобразования</a><ul>
<li class="chapter" data-level="3.6.1" data-path="tables.html"><a href="tables.html#tables_manipiulations_grammar"><i class="fa fa-check"></i><b>3.6.1</b> Грамматика манипуляций</a></li>
<li class="chapter" data-level="3.6.2" data-path="tables.html"><a href="tables.html#tables_manipiulations_pipeline"><i class="fa fa-check"></i><b>3.6.2</b> Конвейер манипуляций</a></li>
<li class="chapter" data-level="3.6.3" data-path="tables.html"><a href="tables.html#tables_tidy"><i class="fa fa-check"></i><b>3.6.3</b> Преобразование структуры</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="tables.html"><a href="tables.html#tables_join"><i class="fa fa-check"></i><b>3.7</b> Соединение</a></li>
<li class="chapter" data-level="3.8" data-path="tables.html"><a href="tables.html#tables_write"><i class="fa fa-check"></i><b>3.8</b> Запись</a></li>
<li class="chapter" data-level="3.9" data-path="tables.html"><a href="tables.html#tables_rules"><i class="fa fa-check"></i><b>3.9</b> Рекомендации по подготовке таблиц для чтения в R</a></li>
<li class="chapter" data-level="3.10" data-path="tables.html"><a href="tables.html#tables_review"><i class="fa fa-check"></i><b>3.10</b> Краткий обзор</a></li>
<li class="chapter" data-level="3.11" data-path="tables.html"><a href="tables.html#tables_questions"><i class="fa fa-check"></i><b>3.11</b> Контрольные вопросы и упражнения</a><ul>
<li class="chapter" data-level="3.11.1" data-path="tables.html"><a href="tables.html#tables_questions_questions"><i class="fa fa-check"></i><b>3.11.1</b> Вопросы</a></li>
<li class="chapter" data-level="3.11.2" data-path="tables.html"><a href="tables.html#tables_questions_tasks"><i class="fa fa-check"></i><b>3.11.2</b> Упражнения</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="tech.html"><a href="tech.html"><i class="fa fa-check"></i><b>4</b> Техники программирования</a><ul>
<li class="chapter" data-level="4.1" data-path="tech.html"><a href="tech.html#tech-fun"><i class="fa fa-check"></i><b>4.1</b> Функциональное программирование</a><ul>
<li class="chapter" data-level="4.1.1" data-path="tech.html"><a href="tech.html#tech-fun-functions"><i class="fa fa-check"></i><b>4.1.1</b> Функции</a></li>
<li class="chapter" data-level="4.1.2" data-path="tech.html"><a href="tech.html#tech-fun-functionals"><i class="fa fa-check"></i><b>4.1.2</b> Функционалы</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="tech.html"><a href="tech.html#tech-meta"><i class="fa fa-check"></i><b>4.2</b> Метапрограммирование</a></li>
<li class="chapter" data-level="4.3" data-path="tech.html"><a href="tech.html#tech_review"><i class="fa fa-check"></i><b>4.3</b> Краткий обзор</a></li>
<li class="chapter" data-level="4.4" data-path="tech.html"><a href="tech.html#tech_questions"><i class="fa fa-check"></i><b>4.4</b> Контрольные вопросы и упражнения</a><ul>
<li class="chapter" data-level="4.4.1" data-path="tech.html"><a href="tech.html#tech_questions_questions"><i class="fa fa-check"></i><b>4.4.1</b> Вопросы</a></li>
<li class="chapter" data-level="4.4.2" data-path="tech.html"><a href="tech.html#tech_questions_tasks"><i class="fa fa-check"></i><b>4.4.2</b> Упражнения</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Графика и статистика</b></span></li>
<li class="chapter" data-level="5" data-path="graphics.html"><a href="graphics.html"><i class="fa fa-check"></i><b>5</b> Базовая графика</a><ul>
<li class="chapter" data-level="5.1" data-path="graphics.html"><a href="graphics.html#yfxcharts"><i class="fa fa-check"></i><b>5.1</b> Стандартные графики</a><ul>
<li class="chapter" data-level="5.1.1" data-path="graphics.html"><a href="graphics.html#scatterplots"><i class="fa fa-check"></i><b>5.1.1</b> Диаграммы рассеяния</a></li>
<li class="chapter" data-level="5.1.2" data-path="graphics.html"><a href="graphics.html#linear_graphs"><i class="fa fa-check"></i><b>5.1.2</b> Линейные графики</a></li>
<li class="chapter" data-level="5.1.3" data-path="graphics.html"><a href="graphics.html#graph_combining"><i class="fa fa-check"></i><b>5.1.3</b> Совмещение графиков</a></li>
<li class="chapter" data-level="5.1.4" data-path="graphics.html"><a href="graphics.html#func_parameters"><i class="fa fa-check"></i><b>5.1.4</b> Функциональные параметры</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="graphics.html"><a href="graphics.html#histograms"><i class="fa fa-check"></i><b>5.2</b> Гистограммы</a></li>
<li class="chapter" data-level="5.3" data-path="graphics.html"><a href="graphics.html#barplots"><i class="fa fa-check"></i><b>5.3</b> Столбчатые графики</a></li>
<li class="chapter" data-level="5.4" data-path="graphics.html"><a href="graphics.html#piecharts"><i class="fa fa-check"></i><b>5.4</b> Круговые (секторные) диаграммы</a></li>
<li class="chapter" data-level="5.5" data-path="graphics.html"><a href="graphics.html#colors"><i class="fa fa-check"></i><b>5.5</b> Цвет и прозрачность</a></li>
<li class="chapter" data-level="5.6" data-path="graphics.html"><a href="graphics.html#disp_settings"><i class="fa fa-check"></i><b>5.6</b> Настройки отображения</a><ul>
<li class="chapter" data-level="5.6.1" data-path="graphics.html"><a href="graphics.html#graph_params"><i class="fa fa-check"></i><b>5.6.1</b> Графические параметры</a></li>
<li class="chapter" data-level="5.6.2" data-path="graphics.html"><a href="graphics.html#axes"><i class="fa fa-check"></i><b>5.6.2</b> Разметка осей, рамка, сетка координат и произвольные линии</a></li>
<li class="chapter" data-level="5.6.3" data-path="graphics.html"><a href="graphics.html#annotations"><i class="fa fa-check"></i><b>5.6.3</b> Аннотации данных (текст на графике)</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="graphics.html"><a href="graphics.html#legend"><i class="fa fa-check"></i><b>5.7</b> Легенда</a></li>
<li class="chapter" data-level="5.8" data-path="graphics.html"><a href="graphics.html#questions_tasks_graphics"><i class="fa fa-check"></i><b>5.8</b> Контрольные вопросы и упражнения</a><ul>
<li class="chapter" data-level="5.8.1" data-path="graphics.html"><a href="graphics.html#questions_graphics"><i class="fa fa-check"></i><b>5.8.1</b> Вопросы</a></li>
<li class="chapter" data-level="5.8.2" data-path="graphics.html"><a href="graphics.html#tasks_graphics"><i class="fa fa-check"></i><b>5.8.2</b> Упражнения</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="advgraphics.html"><a href="advgraphics.html"><i class="fa fa-check"></i><b>6</b> Продвинутая графика</a><ul>
<li class="chapter" data-level="6.1" data-path="advgraphics.html"><a href="advgraphics.html#advgraphics_prerequisites"><i class="fa fa-check"></i><b>6.1</b> Предварительные требования</a></li>
<li class="chapter" data-level="6.2" data-path="advgraphics.html"><a href="advgraphics.html#advgraphics_eurostat"><i class="fa fa-check"></i><b>6.2</b> Загрузка данных Евростата</a></li>
<li class="chapter" data-level="6.3" data-path="advgraphics.html"><a href="advgraphics.html#advgraphics_nasapower"><i class="fa fa-check"></i><b>6.3</b> Загрузка данных NASA POWER</a></li>
<li class="chapter" data-level="6.4" data-path="advgraphics.html"><a href="advgraphics.html#advgraphics_template"><i class="fa fa-check"></i><b>6.4</b> Базовый шаблон ggplot</a></li>
<li class="chapter" data-level="6.5" data-path="advgraphics.html"><a href="advgraphics.html#advgraphics_geoms"><i class="fa fa-check"></i><b>6.5</b> Геометрические типы и преобразования</a></li>
<li class="chapter" data-level="6.6" data-path="advgraphics.html"><a href="advgraphics.html#advgraphics_aes"><i class="fa fa-check"></i><b>6.6</b> Графические переменные и группировки</a></li>
<li class="chapter" data-level="6.7" data-path="advgraphics.html"><a href="advgraphics.html#advgraphics_coords"><i class="fa fa-check"></i><b>6.7</b> Системы координат</a></li>
<li class="chapter" data-level="6.8" data-path="advgraphics.html"><a href="advgraphics.html#advgraphics_titles"><i class="fa fa-check"></i><b>6.8</b> Названия осей и легенды</a></li>
<li class="chapter" data-level="6.9" data-path="advgraphics.html"><a href="advgraphics.html#advgraphics_axes"><i class="fa fa-check"></i><b>6.9</b> Разметка осей</a></li>
<li class="chapter" data-level="6.10" data-path="advgraphics.html"><a href="advgraphics.html#advgraphics_labels"><i class="fa fa-check"></i><b>6.10</b> Подписи и аннотации</a></li>
<li class="chapter" data-level="6.11" data-path="advgraphics.html"><a href="advgraphics.html#advgraphics_facets"><i class="fa fa-check"></i><b>6.11</b> Фасеты</a></li>
<li class="chapter" data-level="6.12" data-path="advgraphics.html"><a href="advgraphics.html#advgraphics_themes"><i class="fa fa-check"></i><b>6.12</b> Темы</a></li>
<li class="chapter" data-level="6.13" data-path="advgraphics.html"><a href="advgraphics.html#questions_tasks_advgraphics"><i class="fa fa-check"></i><b>6.13</b> Контрольные вопросы и упражнения</a><ul>
<li class="chapter" data-level="6.13.1" data-path="advgraphics.html"><a href="advgraphics.html#questions_advgraphics"><i class="fa fa-check"></i><b>6.13.1</b> Вопросы</a></li>
<li class="chapter" data-level="6.13.2" data-path="advgraphics.html"><a href="advgraphics.html#tasks_advgraphics"><i class="fa fa-check"></i><b>6.13.2</b> Упражнения</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="stat-analysis.html"><a href="stat-analysis.html"><i class="fa fa-check"></i><b>7</b> Основы статистики</a><ul>
<li class="chapter" data-level="7.1" data-path="stat-analysis.html"><a href="stat-analysis.html#stat_analysis_prerequisites"><i class="fa fa-check"></i><b>7.1</b> Предварительные требования</a></li>
<li class="chapter" data-level="7.2" data-path="stat-analysis.html"><a href="stat-analysis.html#stat_analysis_intro"><i class="fa fa-check"></i><b>7.2</b> Введение</a><ul>
<li class="chapter" data-level="7.2.1" data-path="stat-analysis.html"><a href="stat-analysis.html#stat_analysis_intro_sources"><i class="fa fa-check"></i><b>7.2.1</b> Источники данных</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="stat-analysis.html"><a href="stat-analysis.html#stat_analysis_one"><i class="fa fa-check"></i><b>7.3</b> Одна переменная</a><ul>
<li class="chapter" data-level="7.3.1" data-path="stat-analysis.html"><a href="stat-analysis.html#stat_analysis_one_distr"><i class="fa fa-check"></i><b>7.3.1</b> Оценка распределения</a></li>
<li class="chapter" data-level="7.3.2" data-path="stat-analysis.html"><a href="stat-analysis.html#stat_analysis_one_summary"><i class="fa fa-check"></i><b>7.3.2</b> Описательные статистики</a></li>
<li class="chapter" data-level="7.3.3" data-path="stat-analysis.html"><a href="stat-analysis.html#stat_analysis_one_tests"><i class="fa fa-check"></i><b>7.3.3</b> Статистические тесты</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="stat-analysis.html"><a href="stat-analysis.html#stat_analysis_two"><i class="fa fa-check"></i><b>7.4</b> Две переменных</a><ul>
<li class="chapter" data-level="7.4.1" data-path="stat-analysis.html"><a href="stat-analysis.html#stat_analysis_two_distr"><i class="fa fa-check"></i><b>7.4.1</b> Оценка распределения</a></li>
<li class="chapter" data-level="7.4.2" data-path="stat-analysis.html"><a href="stat-analysis.html#stat_analysis_two_distr_correg"><i class="fa fa-check"></i><b>7.4.2</b> Корреляция и регрессия</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="stat-analysis.html"><a href="stat-analysis.html#questions_tasks_stat_analysis"><i class="fa fa-check"></i><b>7.5</b> Контрольные вопросы и упражнения</a><ul>
<li class="chapter" data-level="7.5.1" data-path="stat-analysis.html"><a href="stat-analysis.html#questions_stat_analysis"><i class="fa fa-check"></i><b>7.5.1</b> Вопросы</a></li>
<li class="chapter" data-level="7.5.2" data-path="stat-analysis.html"><a href="stat-analysis.html#tasks_stat_analysis"><i class="fa fa-check"></i><b>7.5.2</b> Упражнения</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="circular.html"><a href="circular.html"><i class="fa fa-check"></i><b>8</b> Дирекционные и временные данные</a><ul>
<li class="chapter" data-level="8.1" data-path="circular.html"><a href="circular.html#circular_prerequisites"><i class="fa fa-check"></i><b>8.1</b> Предварительные требования</a></li>
<li class="chapter" data-level="8.2" data-path="circular.html"><a href="circular.html#circular_circ"><i class="fa fa-check"></i><b>8.2</b> Статистика направлений</a><ul>
<li class="chapter" data-level="8.2.1" data-path="circular.html"><a href="circular.html#circular_circ_theory"><i class="fa fa-check"></i><b>8.2.1</b> Теория</a></li>
<li class="chapter" data-level="8.2.2" data-path="circular.html"><a href="circular.html#circular_circ_vis"><i class="fa fa-check"></i><b>8.2.2</b> Практика</a></li>
<li class="chapter" data-level="8.2.3" data-path="circular.html"><a href="circular.html#circular_tests"><i class="fa fa-check"></i><b>8.2.3</b> Статистические тесты</a></li>
<li class="chapter" data-level="8.2.4" data-path="circular.html"><a href="circular.html#circular_correlation"><i class="fa fa-check"></i><b>8.2.4</b> Корреляция и регрессия</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="circular.html"><a href="circular.html#circular_time"><i class="fa fa-check"></i><b>8.3</b> Временные ряды</a><ul>
<li class="chapter" data-level="8.3.1" data-path="circular.html"><a href="circular.html#circular_time_lubridate"><i class="fa fa-check"></i><b>8.3.1</b> Создание и преобразование дат и времени</a></li>
<li class="chapter" data-level="8.3.2" data-path="circular.html"><a href="circular.html#circular_time_complete"><i class="fa fa-check"></i><b>8.3.2</b> Восстановление пропусков и проверка корректности дат</a></li>
<li class="chapter" data-level="8.3.3" data-path="circular.html"><a href="circular.html#circular_time_interp"><i class="fa fa-check"></i><b>8.3.3</b> Интерполяция по времени</a></li>
<li class="chapter" data-level="8.3.4" data-path="circular.html"><a href="circular.html#circular_time_tests"><i class="fa fa-check"></i><b>8.3.4</b> Статистики</a></li>
<li class="chapter" data-level="8.3.5" data-path="circular.html"><a href="circular.html#circular_time_animation"><i class="fa fa-check"></i><b>8.3.5</b> Анимация</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="circular.html"><a href="circular.html#questions_tasks_circular"><i class="fa fa-check"></i><b>8.4</b> Контрольные вопросы и упражнения</a><ul>
<li class="chapter" data-level="8.4.1" data-path="circular.html"><a href="circular.html#questions_circular"><i class="fa fa-check"></i><b>8.4.1</b> Вопросы</a></li>
<li class="chapter" data-level="8.4.2" data-path="circular.html"><a href="circular.html#tasks_circular"><i class="fa fa-check"></i><b>8.4.2</b> Упражнения</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Пространственные данные</b></span></li>
<li class="chapter" data-level="9" data-path="spatial-data.html"><a href="spatial-data.html"><i class="fa fa-check"></i><b>9</b> Пространственные данные</a><ul>
<li class="chapter" data-level="9.1" data-path="circular.html"><a href="circular.html#circular_prerequisites"><i class="fa fa-check"></i><b>9.1</b> Предварительные требования</a></li>
<li class="chapter" data-level="9.2" data-path="spatial-data.html"><a href="spatial-data.html#spatial_models"><i class="fa fa-check"></i><b>9.2</b> Модели пространственных данных</a><ul>
<li class="chapter" data-level="9.2.1" data-path="spatial-data.html"><a href="spatial-data.html#simple_features"><i class="fa fa-check"></i><b>9.2.1</b> Векторные данные</a></li>
<li class="chapter" data-level="9.2.2" data-path="spatial-data.html"><a href="spatial-data.html#raster_data"><i class="fa fa-check"></i><b>9.2.2</b> Растровые данные</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="spatial-data.html"><a href="spatial-data.html#spatref"><i class="fa fa-check"></i><b>9.3</b> Пространственная привязка</a><ul>
<li class="chapter" data-level="9.3.1" data-path="spatial-data.html"><a href="spatial-data.html#spatref_components"><i class="fa fa-check"></i><b>9.3.1</b> Компоненты пространственной привязки</a></li>
<li class="chapter" data-level="9.3.2" data-path="spatial-data.html"><a href="spatial-data.html#spatref_formats"><i class="fa fa-check"></i><b>9.3.2</b> Форматы описания пространственной привязки</a></li>
<li class="chapter" data-level="9.3.3" data-path="spatial-data.html"><a href="spatial-data.html#spatref_transform"><i class="fa fa-check"></i><b>9.3.3</b> Преобразование координат</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="spatial-data.html"><a href="spatial-data.html#vector_data_r"><i class="fa fa-check"></i><b>9.4</b> Векторные данные</a><ul>
<li class="chapter" data-level="9.4.1" data-path="spatial-data.html"><a href="spatial-data.html#vector_data_packages"><i class="fa fa-check"></i><b>9.4.1</b> Базовые библиотеки</a></li>
<li class="chapter" data-level="9.4.2" data-path="spatial-data.html"><a href="spatial-data.html#vector_data_reading"><i class="fa fa-check"></i><b>9.4.2</b> Чтение</a></li>
<li class="chapter" data-level="9.4.3" data-path="spatial-data.html"><a href="spatial-data.html#sf_structure"><i class="fa fa-check"></i><b>9.4.3</b> Внутренняя структура</a></li>
<li class="chapter" data-level="9.4.4" data-path="spatial-data.html"><a href="spatial-data.html#sf_plotting"><i class="fa fa-check"></i><b>9.4.4</b> Визуализация</a></li>
<li class="chapter" data-level="9.4.5" data-path="spatial-data.html"><a href="spatial-data.html#sf_crs"><i class="fa fa-check"></i><b>9.4.5</b> Системы координат и проекции</a></li>
<li class="chapter" data-level="9.4.6" data-path="spatial-data.html"><a href="spatial-data.html#sf_attrs"><i class="fa fa-check"></i><b>9.4.6</b> Атрибутивные операции</a></li>
<li class="chapter" data-level="9.4.7" data-path="spatial-data.html"><a href="spatial-data.html#sf_spat_selection"><i class="fa fa-check"></i><b>9.4.7</b> Пространственные операции</a></li>
<li class="chapter" data-level="9.4.8" data-path="spatial-data.html"><a href="spatial-data.html#sf_creation"><i class="fa fa-check"></i><b>9.4.8</b> Создание пространственных объектов</a></li>
<li class="chapter" data-level="9.4.9" data-path="spatial-data.html"><a href="spatial-data.html#sf_geom_attrs"><i class="fa fa-check"></i><b>9.4.9</b> Геометрические атрибуты</a></li>
<li class="chapter" data-level="9.4.10" data-path="spatial-data.html"><a href="spatial-data.html#sf_export"><i class="fa fa-check"></i><b>9.4.10</b> Экспорт</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="spatial-data.html"><a href="spatial-data.html#raster_data_r"><i class="fa fa-check"></i><b>9.5</b> Растровые данные</a><ul>
<li class="chapter" data-level="9.5.1" data-path="spatial-data.html"><a href="spatial-data.html#raster_read"><i class="fa fa-check"></i><b>9.5.1</b> Чтение</a></li>
<li class="chapter" data-level="9.5.2" data-path="spatial-data.html"><a href="spatial-data.html#raster_viz"><i class="fa fa-check"></i><b>9.5.2</b> Визуализация</a></li>
<li class="chapter" data-level="9.5.3" data-path="spatial-data.html"><a href="spatial-data.html#raster_proj"><i class="fa fa-check"></i><b>9.5.3</b> Системы координат и проекции</a></li>
<li class="chapter" data-level="9.5.4" data-path="spatial-data.html"><a href="spatial-data.html#raster_values"><i class="fa fa-check"></i><b>9.5.4</b> Операции со значениями</a></li>
<li class="chapter" data-level="9.5.5" data-path="spatial-data.html"><a href="spatial-data.html#raster_export"><i class="fa fa-check"></i><b>9.5.5</b> Экспорт</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="spatial-data.html"><a href="spatial-data.html#spatial_ggplot2"><i class="fa fa-check"></i><b>9.6</b> Визуализация средствами ggplot2</a></li>
<li class="chapter" data-level="9.7" data-path="spatial-data.html"><a href="spatial-data.html#spatial_interactive"><i class="fa fa-check"></i><b>9.7</b> Интерактивные карты</a></li>
<li class="chapter" data-level="9.8" data-path="spatial-data.html"><a href="spatial-data.html#questions_tasks_spatial"><i class="fa fa-check"></i><b>9.8</b> Контрольные вопросы и упражнения</a><ul>
<li class="chapter" data-level="9.8.1" data-path="spatial-data.html"><a href="spatial-data.html#questions_spatial"><i class="fa fa-check"></i><b>9.8.1</b> Вопросы</a></li>
<li class="chapter" data-level="9.8.2" data-path="spatial-data.html"><a href="spatial-data.html#tasks_spatial"><i class="fa fa-check"></i><b>9.8.2</b> Упражнения</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html"><i class="fa fa-check"></i><b>10</b> Тематические карты</a><ul>
<li class="chapter" data-level="" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#предварительные-условия"><i class="fa fa-check"></i>Предварительные условия</a></li>
<li class="chapter" data-level="10.1" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#thematic_mapping_intro"><i class="fa fa-check"></i><b>10.1</b> Введение</a><ul>
<li class="chapter" data-level="10.1.1" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#thematic_mapping_intro_ne"><i class="fa fa-check"></i><b>10.1.1</b> Данные Natural Earth</a></li>
<li class="chapter" data-level="10.1.2" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#thematic_mapping_intro_wc"><i class="fa fa-check"></i><b>10.1.2</b> Данные WorldClim</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#thematic_mapping_tmap"><i class="fa fa-check"></i><b>10.2</b> Способы изображения</a><ul>
<li class="chapter" data-level="10.2.1" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#thematic_mapping_vectors"><i class="fa fa-check"></i><b>10.2.1</b> Векторные данные</a></li>
<li class="chapter" data-level="10.2.2" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#thematic_mapping_rasters"><i class="fa fa-check"></i><b>10.2.2</b> Растровые данные</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#thematic_color_scales"><i class="fa fa-check"></i><b>10.3</b> Цветовые шкалы</a></li>
<li class="chapter" data-level="10.4" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#thematic_mapping_class"><i class="fa fa-check"></i><b>10.4</b> Классификация</a><ul>
<li class="chapter" data-level="10.4.1" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#thematic_mapping_class_methods"><i class="fa fa-check"></i><b>10.4.1</b> Методы классификации</a></li>
<li class="chapter" data-level="10.4.2" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#thematic_mapping_class_application"><i class="fa fa-check"></i><b>10.4.2</b> Применение на картах</a></li>
<li class="chapter" data-level="10.4.3" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#thematic_mapping_class_application"><i class="fa fa-check"></i><b>10.4.3</b> Классификация при отображении</a></li>
<li class="chapter" data-level="10.4.4" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#thematic_mapping_na"><i class="fa fa-check"></i><b>10.4.4</b> Пропущенные данные</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#thematic_mapping_layouts"><i class="fa fa-check"></i><b>10.5</b> Компоновка</a></li>
<li class="chapter" data-level="10.6" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#thematic_mapping_facets"><i class="fa fa-check"></i><b>10.6</b> Фасеты и серии карт</a></li>
<li class="chapter" data-level="10.7" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#thematic_mapping_animations"><i class="fa fa-check"></i><b>10.7</b> Картографические анимации</a></li>
<li class="chapter" data-level="10.8" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#thematic_mapping_interactive"><i class="fa fa-check"></i><b>10.8</b> Интерактивные карты</a></li>
<li class="chapter" data-level="10.9" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#questions_tasks_tmap"><i class="fa fa-check"></i><b>10.9</b> Контрольные вопросы и упражнения</a><ul>
<li class="chapter" data-level="10.9.1" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#questions_tmap"><i class="fa fa-check"></i><b>10.9.1</b> Вопросы</a></li>
<li class="chapter" data-level="10.9.2" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#tasks_tmap"><i class="fa fa-check"></i><b>10.9.2</b> Упражнения</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="vector-analysis.html"><a href="vector-analysis.html"><i class="fa fa-check"></i><b>11</b> Векторный и сетевой анализ</a><ul>
<li class="chapter" data-level="11.1" data-path="vector-analysis.html"><a href="vector-analysis.html#spatial_queries"><i class="fa fa-check"></i><b>11.1</b> Пространственные запросы</a><ul>
<li class="chapter" data-level="11.1.1" data-path="vector-analysis.html"><a href="vector-analysis.html#context_objects"><i class="fa fa-check"></i><b>11.1.1</b> Контекстные и целевые объекты</a></li>
<li class="chapter" data-level="11.1.2" data-path="vector-analysis.html"><a href="vector-analysis.html#zones"><i class="fa fa-check"></i><b>11.1.2</b> Зоны окружения объектов</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="vector-analysis.html"><a href="vector-analysis.html#use_case"><i class="fa fa-check"></i><b>11.2</b> Постановка задач и изучение данных</a></li>
<li class="chapter" data-level="11.3" data-path="vector-analysis.html"><a href="vector-analysis.html#distance_analysis"><i class="fa fa-check"></i><b>11.3</b> Анализ расстояний</a></li>
<li class="chapter" data-level="11.4" data-path="vector-analysis.html"><a href="vector-analysis.html#topology_analysis"><i class="fa fa-check"></i><b>11.4</b> Анализ взаимного положения (топологический)</a></li>
<li class="chapter" data-level="11.5" data-path="vector-analysis.html"><a href="vector-analysis.html#absolute_zones"><i class="fa fa-check"></i><b>11.5</b> Анализ абсолютных зон окружения</a></li>
<li class="chapter" data-level="11.6" data-path="vector-analysis.html"><a href="vector-analysis.html#conc_zones"><i class="fa fa-check"></i><b>11.6</b> Анализ конкурентных зон окружения</a></li>
<li class="chapter" data-level="11.7" data-path="vector-analysis.html"><a href="vector-analysis.html#transport_zones"><i class="fa fa-check"></i><b>11.7</b> Анализ зон транспортной доступности</a></li>
<li class="chapter" data-level="11.8" data-path="vector-analysis.html"><a href="vector-analysis.html#routes"><i class="fa fa-check"></i><b>11.8</b> Построение маршрутов и матриц времени движения</a></li>
<li class="chapter" data-level="11.9" data-path="vector-analysis.html"><a href="vector-analysis.html#qtasks_vector_analysis"><i class="fa fa-check"></i><b>11.9</b> Контрольные вопросы и упражнения</a><ul>
<li class="chapter" data-level="11.9.1" data-path="vector-analysis.html"><a href="vector-analysis.html#questions_vector_analysis"><i class="fa fa-check"></i><b>11.9.1</b> Вопросы</a></li>
<li class="chapter" data-level="11.9.2" data-path="vector-analysis.html"><a href="vector-analysis.html#tasks_vector_analysis"><i class="fa fa-check"></i><b>11.9.2</b> Упражнения</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="raster-analysis.html"><a href="raster-analysis.html"><i class="fa fa-check"></i><b>12</b> Растровый анализ</a><ul>
<li class="chapter" data-level="" data-path="raster-analysis.html"><a href="raster-analysis.html#предварительные-условия-1"><i class="fa fa-check"></i>Предварительные условия</a></li>
<li class="chapter" data-level="12.1" data-path="raster-analysis.html"><a href="raster-analysis.html#raster_intro"><i class="fa fa-check"></i><b>12.1</b> Введение</a></li>
<li class="chapter" data-level="12.2" data-path="raster-analysis.html"><a href="raster-analysis.html#растровая-алгебра"><i class="fa fa-check"></i><b>12.2</b> Растровая алгебра</a><ul>
<li class="chapter" data-level="12.2.1" data-path="raster-analysis.html"><a href="raster-analysis.html#raster_local"><i class="fa fa-check"></i><b>12.2.1</b> Локальные операции</a></li>
<li class="chapter" data-level="12.2.2" data-path="raster-analysis.html"><a href="raster-analysis.html#raster_focal"><i class="fa fa-check"></i><b>12.2.2</b> Фокальные операции</a></li>
<li class="chapter" data-level="12.2.3" data-path="raster-analysis.html"><a href="raster-analysis.html#raster_zonal"><i class="fa fa-check"></i><b>12.2.3</b> Зональные операции</a></li>
<li class="chapter" data-level="12.2.4" data-path="raster-analysis.html"><a href="raster-analysis.html#raster_global"><i class="fa fa-check"></i><b>12.2.4</b> Глобальные операции</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="raster-analysis.html"><a href="raster-analysis.html#raster_extract"><i class="fa fa-check"></i><b>12.3</b> Извлечение данных</a></li>
<li class="chapter" data-level="12.4" data-path="raster-analysis.html"><a href="raster-analysis.html#questions_tasks_raster"><i class="fa fa-check"></i><b>12.4</b> Контрольные вопросы и упражнения</a><ul>
<li class="chapter" data-level="12.4.1" data-path="raster-analysis.html"><a href="raster-analysis.html#questions_raster"><i class="fa fa-check"></i><b>12.4.1</b> Вопросы</a></li>
<li class="chapter" data-level="12.4.2" data-path="raster-analysis.html"><a href="raster-analysis.html#tasks_raster"><i class="fa fa-check"></i><b>12.4.2</b> Упражнения</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Пространственная статистика</b></span></li>
<li class="chapter" data-level="13" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html"><i class="fa fa-check"></i><b>13</b> Моделирование геополей</a><ul>
<li class="chapter" data-level="13.1" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#interpolation_intro"><i class="fa fa-check"></i><b>13.1</b> Введение</a></li>
<li class="chapter" data-level="13.2" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#interpolation_grid"><i class="fa fa-check"></i><b>13.2</b> Построение сетки</a></li>
<li class="chapter" data-level="13.3" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#interpolation_methods"><i class="fa fa-check"></i><b>13.3</b> Интерполяционные методы</a><ul>
<li class="chapter" data-level="13.3.1" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#interpolation_nn"><i class="fa fa-check"></i><b>13.3.1</b> Метод ближайшего соседа (nearest neighbour)</a></li>
<li class="chapter" data-level="13.3.2" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#interpolation_tin"><i class="fa fa-check"></i><b>13.3.2</b> Интерполяция на основе триангуляции</a></li>
<li class="chapter" data-level="13.3.3" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#interpolation_idw"><i class="fa fa-check"></i><b>13.3.3</b> Метод обратно взвешенных расстояний (IDW)</a></li>
<li class="chapter" data-level="13.3.4" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#interpolation_rbf"><i class="fa fa-check"></i><b>13.3.4</b> Метод радиальных базисных функций (РБФ)</a></li>
<li class="chapter" data-level="13.3.5" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#interpolation_bspline"><i class="fa fa-check"></i><b>13.3.5</b> Метод иерархических базисных сплайнов (B-сплайнов)</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#approximation_methods"><i class="fa fa-check"></i><b>13.4</b> Аппроксимационные методы</a><ul>
<li class="chapter" data-level="13.4.1" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#approximation_global"><i class="fa fa-check"></i><b>13.4.1</b> Глобальный тренд</a></li>
<li class="chapter" data-level="13.4.2" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#approximation_local"><i class="fa fa-check"></i><b>13.4.2</b> Локальный тренд</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#areal_interpolation"><i class="fa fa-check"></i><b>13.5</b> Интерполяция по ареалам</a></li>
<li class="chapter" data-level="13.6" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#interp_review"><i class="fa fa-check"></i><b>13.6</b> Краткий обзор</a></li>
<li class="chapter" data-level="13.7" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#questions_tasks_interp"><i class="fa fa-check"></i><b>13.7</b> Контрольные вопросы и упражнения</a><ul>
<li class="chapter" data-level="13.7.1" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#questions_interp"><i class="fa fa-check"></i><b>13.7.1</b> Вопросы</a></li>
<li class="chapter" data-level="13.7.2" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#tasks_interp"><i class="fa fa-check"></i><b>13.7.2</b> Упражнения</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="kriging.html"><a href="kriging.html"><i class="fa fa-check"></i><b>14</b> Геостатистика</a><ul>
<li class="chapter" data-level="14.1" data-path="kriging.html"><a href="kriging.html#введение-1"><i class="fa fa-check"></i><b>14.1</b> Введение</a></li>
<li class="chapter" data-level="14.2" data-path="kriging.html"><a href="kriging.html#базовые-понятия-и-элементы-геостатистики"><i class="fa fa-check"></i><b>14.2</b> Базовые понятия и элементы геостатистики</a><ul>
<li class="chapter" data-level="14.2.1" data-path="kriging.html"><a href="kriging.html#базовые-понятия"><i class="fa fa-check"></i><b>14.2.1</b> Базовые понятия</a></li>
<li class="chapter" data-level="14.2.2" data-path="kriging.html"><a href="kriging.html#случайный-процесс-в-пространстве-и-его-моменты"><i class="fa fa-check"></i><b>14.2.2</b> Случайный процесс в пространстве и его моменты</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="kriging.html"><a href="kriging.html#стационарность-и-эргодичность"><i class="fa fa-check"></i><b>14.3</b> Стационарность и эргодичность</a><ul>
<li class="chapter" data-level="14.3.1" data-path="kriging.html"><a href="kriging.html#стационарность"><i class="fa fa-check"></i><b>14.3.1</b> Стационарность</a></li>
<li class="chapter" data-level="14.3.2" data-path="kriging.html"><a href="kriging.html#эргодичность"><i class="fa fa-check"></i><b>14.3.2</b> Эргодичность</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="kriging.html"><a href="kriging.html#геостатистическое-оценивание"><i class="fa fa-check"></i><b>14.4</b> Геостатистическое оценивание</a><ul>
<li class="chapter" data-level="14.4.1" data-path="kriging.html"><a href="kriging.html#простой-кригинг"><i class="fa fa-check"></i><b>14.4.1</b> Простой кригинг</a></li>
<li class="chapter" data-level="14.4.2" data-path="kriging.html"><a href="kriging.html#дисперсия-простого-кригинга"><i class="fa fa-check"></i><b>14.4.2</b> Дисперсия простого кригинга</a></li>
<li class="chapter" data-level="14.4.3" data-path="kriging.html"><a href="kriging.html#стационарность-приращений"><i class="fa fa-check"></i><b>14.4.3</b> Стационарность приращений</a></li>
<li class="chapter" data-level="14.4.4" data-path="kriging.html"><a href="kriging.html#положительная-определенность"><i class="fa fa-check"></i><b>14.4.4</b> Положительная определенность</a></li>
<li class="chapter" data-level="14.4.5" data-path="kriging.html"><a href="kriging.html#допустимые-линейные-комбинации"><i class="fa fa-check"></i><b>14.4.5</b> Допустимые линейные комбинации</a></li>
<li class="chapter" data-level="14.4.6" data-path="kriging.html"><a href="kriging.html#условная-положительная-определенность"><i class="fa fa-check"></i><b>14.4.6</b> Условная положительная определенность</a></li>
<li class="chapter" data-level="14.4.7" data-path="kriging.html"><a href="kriging.html#переход-от-ковариации-к-вариограмме"><i class="fa fa-check"></i><b>14.4.7</b> Переход от ковариации к вариограмме</a></li>
<li class="chapter" data-level="14.4.8" data-path="kriging.html"><a href="kriging.html#обычный-кригинг"><i class="fa fa-check"></i><b>14.4.8</b> Обычный кригинг</a></li>
<li class="chapter" data-level="14.4.9" data-path="kriging.html"><a href="kriging.html#дисперсия-обычного-кригинга"><i class="fa fa-check"></i><b>14.4.9</b> Дисперсия обычного кригинга</a></li>
<li class="chapter" data-level="14.4.10" data-path="kriging.html"><a href="kriging.html#универсальный-кригинг"><i class="fa fa-check"></i><b>14.4.10</b> Универсальный кригинг</a></li>
<li class="chapter" data-level="14.4.11" data-path="kriging.html"><a href="kriging.html#дисперсия-универсального-кригинга"><i class="fa fa-check"></i><b>14.4.11</b> Дисперсия универсального кригинга</a></li>
<li class="chapter" data-level="14.4.12" data-path="kriging.html"><a href="kriging.html#кросс-валидация"><i class="fa fa-check"></i><b>14.4.12</b> Кросс-валидация</a></li>
<li class="chapter" data-level="14.4.13" data-path="kriging.html"><a href="kriging.html#вариограмма"><i class="fa fa-check"></i><b>14.4.13</b> Вариограмма</a></li>
<li class="chapter" data-level="14.4.14" data-path="kriging.html"><a href="kriging.html#сферическая-модель"><i class="fa fa-check"></i><b>14.4.14</b> Сферическая модель</a></li>
<li class="chapter" data-level="14.4.15" data-path="kriging.html"><a href="kriging.html#экспоненциальная-модель"><i class="fa fa-check"></i><b>14.4.15</b> Экспоненциальная модель</a></li>
<li class="chapter" data-level="14.4.16" data-path="kriging.html"><a href="kriging.html#гауссова-модель"><i class="fa fa-check"></i><b>14.4.16</b> Гауссова модель</a></li>
<li class="chapter" data-level="14.4.17" data-path="kriging.html"><a href="kriging.html#степенная-модель"><i class="fa fa-check"></i><b>14.4.17</b> Степенная модель</a></li>
<li class="chapter" data-level="14.4.18" data-path="kriging.html"><a href="kriging.html#эффект-самородка-модель-наггет"><i class="fa fa-check"></i><b>14.4.18</b> Эффект самородка (модель наггет)</a></li>
<li class="chapter" data-level="14.4.19" data-path="kriging.html"><a href="kriging.html#диаграмма-рассеяния-с-лагом"><i class="fa fa-check"></i><b>14.4.19</b> Диаграмма рассеяния с лагом</a></li>
<li class="chapter" data-level="14.4.20" data-path="kriging.html"><a href="kriging.html#вариограммное-облако"><i class="fa fa-check"></i><b>14.4.20</b> Вариограммное облако</a></li>
<li class="chapter" data-level="14.4.21" data-path="kriging.html"><a href="kriging.html#эмпирическая-вариограмма"><i class="fa fa-check"></i><b>14.4.21</b> Эмпирическая вариограмма</a></li>
<li class="chapter" data-level="14.4.22" data-path="kriging.html"><a href="kriging.html#вариокарта"><i class="fa fa-check"></i><b>14.4.22</b> Вариокарта</a></li>
<li class="chapter" data-level="14.4.23" data-path="kriging.html"><a href="kriging.html#приближение-теоретической-модели"><i class="fa fa-check"></i><b>14.4.23</b> Приближение теоретической модели</a></li>
<li class="chapter" data-level="14.4.24" data-path="kriging.html"><a href="kriging.html#обычный-кригинг-1"><i class="fa fa-check"></i><b>14.4.24</b> Обычный кригинг</a></li>
<li class="chapter" data-level="14.4.25" data-path="kriging.html"><a href="kriging.html#обычный-кригинг-2"><i class="fa fa-check"></i><b>14.4.25</b> Обычный кригинг</a></li>
<li class="chapter" data-level="14.4.26" data-path="kriging.html"><a href="kriging.html#оценка-и-дисперсия-кригинга"><i class="fa fa-check"></i><b>14.4.26</b> Оценка и дисперсия кригинга</a></li>
<li class="chapter" data-level="14.4.27" data-path="kriging.html"><a href="kriging.html#кросс-валидация-1"><i class="fa fa-check"></i><b>14.4.27</b> Кросс-валидация</a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path="kriging.html"><a href="kriging.html#geostat_review"><i class="fa fa-check"></i><b>14.5</b> Краткий обзор</a></li>
<li class="chapter" data-level="14.6" data-path="kriging.html"><a href="kriging.html#geostat_qt"><i class="fa fa-check"></i><b>14.6</b> Контрольные вопросы и упражнения</a><ul>
<li class="chapter" data-level="14.6.1" data-path="kriging.html"><a href="kriging.html#geostat_q"><i class="fa fa-check"></i><b>14.6.1</b> Вопросы</a></li>
<li class="chapter" data-level="14.6.2" data-path="kriging.html"><a href="kriging.html#geostat_t"><i class="fa fa-check"></i><b>14.6.2</b> Упражнения</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://istina.msu.ru/profile/tsamsonov/" target="blank">Тимофей Самсонов</a></li>
<li><a href="https://doi.org/10.5281/zenodo.901911"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.901911.svg" title="DOI"></a><li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Визуализация и анализ географических данных на языке R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="tech" class="section level1">
<h1><span class="header-section-number">Глава 4</span> Техники программирования</h1>
<p>В настоящей главе мы кратко познакомимся с функциональным программированием и метапрограммированием, которые являются одними из основных техник программирования на R.</p>
<div id="tech-fun" class="section level2">
<h2><span class="header-section-number">4.1</span> Функциональное программирование</h2>
<div id="tech-fun-functions" class="section level3">
<h3><span class="header-section-number">4.1.1</span> Функции</h3>
<p>Функции в R можно использовать для структурирования кода на логически завершенные, автономные фрагменты кода, каждый из которых выполняет конкретную задачу. Синтаксис функции выглядит следующим образом:</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="tech.html#cb191-1"></a>functionName =<span class="st"> </span><span class="cf">function</span>(parameter1, parameter2, ...){</span>
<span id="cb191-2"><a href="tech.html#cb191-2"></a>  ...</span>
<span id="cb191-3"><a href="tech.html#cb191-3"></a>  <span class="kw">return</span>(result)</span>
<span id="cb191-4"><a href="tech.html#cb191-4"></a>  ...</span>
<span id="cb191-5"><a href="tech.html#cb191-5"></a>  last_value =<span class="st"> </span>...</span>
<span id="cb191-6"><a href="tech.html#cb191-6"></a>}</span></code></pre></div>
<p>Функция создается c помощью ключевого слова <code>function</code>, за которым в круглых скобках заключается произвольное количество параметров (столько, сколько вам нужно: от нуля и более). С помощью этих параметров вы сможете передавать внутрь функции значения переменных. Созданной функции необходимо дать имя, используя оператор присвоения <code>&lt;-</code> или <code>=</code>.</p>
<p>Возврат значения функции осуществляется двумя способами:</p>
<ul>
<li>Если не указано иное, то будет возвращен результат вычисления последнего выражения, выполненного внутри функции (<code>last_value</code> в примере выше)</li>
<li>Результат можно вернуть принудительно в любом месте функции, передав его в выражение <code>return()</code>.</li>
</ul>
<blockquote>
<p>Выражение <code>return()</code> работает аналогично ключевому слову <code>break</code> в циклах: оно прерывает выполнение функции и осуществляет выход из нее. Как правило, return() используется, если возврат значения надо сделать где-то посередине или в начале функции. Однако я реккомендую использовать его всегда, поскольку это помогает читателю вашей функции быстро определить, что же именно возвращается из функции</p>
</blockquote>
<p>Как правило, функции оказываются полезны, если:</p>
<ul>
<li>Вы дублируете один и тот же код в разных частях программы</li>
<li>Ваш код становится слишком длинным, при этом присутствует очевидная этапность решения задачи, позволяющая разбить программу на автономные блоки</li>
<li>У вас есть фрагмент кода, который выполняет вспомогательную (второстепенную функцию), и не относится непосредственно к основной логике программы.</li>
</ul>
<p>Предположим, у нас есть линия, заданная координатами четырех точек, и нам надо вычислить длины каждого из трех отрезков. Без использования функции мы запишем это так:</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="tech.html#cb192-1"></a>x =<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">4</span>)</span>
<span id="cb192-2"><a href="tech.html#cb192-2"></a>y =<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">4</span>)</span>
<span id="cb192-3"><a href="tech.html#cb192-3"></a>d12 =<span class="st"> </span><span class="kw">sqrt</span>((x[<span class="dv">1</span>] <span class="op">-</span><span class="st"> </span>x[<span class="dv">2</span>]) <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>(y[<span class="dv">1</span>] <span class="op">-</span><span class="st"> </span>y[<span class="dv">2</span>]) <span class="op">^</span><span class="st"> </span><span class="dv">2</span>)</span>
<span id="cb192-4"><a href="tech.html#cb192-4"></a>d23 =<span class="st"> </span><span class="kw">sqrt</span>((x[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span>x[<span class="dv">3</span>]) <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>(y[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span>y[<span class="dv">3</span>]) <span class="op">^</span><span class="st"> </span><span class="dv">2</span>)</span>
<span id="cb192-5"><a href="tech.html#cb192-5"></a>d31 =<span class="st"> </span><span class="kw">sqrt</span>((x[<span class="dv">3</span>] <span class="op">-</span><span class="st"> </span>x[<span class="dv">4</span>]) <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>(y[<span class="dv">3</span>] <span class="op">-</span><span class="st"> </span>y[<span class="dv">4</span>]) <span class="op">^</span><span class="st"> </span><span class="dv">2</span>)</span>
<span id="cb192-6"><a href="tech.html#cb192-6"></a><span class="kw">cat</span>(d12, d23, d31)</span>
<span id="cb192-7"><a href="tech.html#cb192-7"></a><span class="co">## 1.647614 1.536223 0.4964138</span></span></code></pre></div>
<p>В правой части этих выражений стоит один и тот же код, который я скопировал и вставил, а далее заменил названия переменных. Это плохо сразу по двум причинам: дублирование фрагментов программы и возрастание вероятности опечаток в скопированой копии. Улучшить код можно, введя функцию вычисления расстояний:</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="tech.html#cb193-1"></a>distance =<span class="st"> </span><span class="cf">function</span>(x1, y1, x2, y2) {</span>
<span id="cb193-2"><a href="tech.html#cb193-2"></a>  <span class="kw">sqrt</span>((x1 <span class="op">-</span><span class="st"> </span>x2) <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>(y1 <span class="op">-</span><span class="st"> </span>y2) <span class="op">^</span><span class="st"> </span><span class="dv">2</span>)</span>
<span id="cb193-3"><a href="tech.html#cb193-3"></a>}</span>
<span id="cb193-4"><a href="tech.html#cb193-4"></a></span>
<span id="cb193-5"><a href="tech.html#cb193-5"></a>d12 =<span class="st"> </span><span class="kw">distance</span>(x[<span class="dv">1</span>], y[<span class="dv">1</span>], x[<span class="dv">2</span>], y[<span class="dv">2</span>])</span>
<span id="cb193-6"><a href="tech.html#cb193-6"></a>d23 =<span class="st"> </span><span class="kw">distance</span>(x[<span class="dv">2</span>], y[<span class="dv">2</span>], x[<span class="dv">3</span>], y[<span class="dv">3</span>])</span>
<span id="cb193-7"><a href="tech.html#cb193-7"></a>d31 =<span class="st"> </span><span class="kw">distance</span>(x[<span class="dv">3</span>], y[<span class="dv">3</span>], x[<span class="dv">4</span>], y[<span class="dv">4</span>])</span>
<span id="cb193-8"><a href="tech.html#cb193-8"></a><span class="kw">cat</span>(d12, d23, d31)</span>
<span id="cb193-9"><a href="tech.html#cb193-9"></a><span class="co">## 1.647614 1.536223 0.4964138</span></span></code></pre></div>
<p>Функция всегда возвращает один объект: значение, вектор, список и т.д. Например, мы можем сделать функцию следующего уровня, рассчитывающая сразу все расстояния для множества точек:</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="tech.html#cb194-1"></a>distances =<span class="st"> </span><span class="cf">function</span>(x, y) {</span>
<span id="cb194-2"><a href="tech.html#cb194-2"></a>  n =<span class="st"> </span><span class="kw">length</span>(x)</span>
<span id="cb194-3"><a href="tech.html#cb194-3"></a>  <span class="kw">distance</span>(x[<span class="dv">1</span><span class="op">:</span>(n<span class="dv">-1</span>)], y[<span class="dv">1</span><span class="op">:</span>(n<span class="dv">-1</span>)], x[<span class="dv">2</span><span class="op">:</span>n], y[<span class="dv">2</span><span class="op">:</span>n])</span>
<span id="cb194-4"><a href="tech.html#cb194-4"></a>}</span>
<span id="cb194-5"><a href="tech.html#cb194-5"></a></span>
<span id="cb194-6"><a href="tech.html#cb194-6"></a><span class="kw">distances</span>(x, y)</span>
<span id="cb194-7"><a href="tech.html#cb194-7"></a><span class="co">## [1] 1.6476145 1.5362229 0.4964138</span></span></code></pre></div>
<p>Можно пойти еще дальше, и сделать функцию, выполняющую вычисление длины линии, заданной координатами:</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="tech.html#cb195-1"></a>line_length =<span class="st"> </span><span class="cf">function</span>(x, y) {</span>
<span id="cb195-2"><a href="tech.html#cb195-2"></a>  <span class="kw">sum</span>(<span class="kw">distances</span>(x, y))</span>
<span id="cb195-3"><a href="tech.html#cb195-3"></a>}</span>
<span id="cb195-4"><a href="tech.html#cb195-4"></a></span>
<span id="cb195-5"><a href="tech.html#cb195-5"></a><span class="kw">line_length</span>(x, y)</span>
<span id="cb195-6"><a href="tech.html#cb195-6"></a><span class="co">## [1] 3.680251</span></span></code></pre></div>
<p>Обратите внимание на то, как мы используем одну ранее написанную функцию при создании другой функции! Это весьма распространенная практика: одна и та же функция может быть как самостоятельно полезной (вызываться непосредственно в программе полтьзователя), так и применяться для решения задач внутри других функций. При этом иногда даже относительно простые фрагменты кода имеет смысл оформлять в виде функций, так как это может улучшить читаемость программы и пояснить смысл выполняемых операций. Так, например, <code>line_length(x, y)</code> в более явном виде обозначает операцию вычисления длины по координатам, нежели <code>sum(distances(x, y))</code>. В то же время, здесь важно не переусердствовать и оформлять короткие фрагменты кода в виде функций только если они будут применяться вами неоднократно.</p>
<p>Если вам нужно вернуть из функции несколько объектов, имеющих разный тип или смысл, заключите их в список и дайте каждому элементу списка “говорящее” имя. Например, помимо периметра, мы можем вернуть также извилистость линии (отношение длины линии к длине отрезка, соединяющего ее первую и последнюю точку):</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="tech.html#cb196-1"></a>line_params =<span class="st"> </span><span class="cf">function</span>(x, y) {</span>
<span id="cb196-2"><a href="tech.html#cb196-2"></a>  n =<span class="st"> </span><span class="kw">length</span>(x)</span>
<span id="cb196-3"><a href="tech.html#cb196-3"></a>  </span>
<span id="cb196-4"><a href="tech.html#cb196-4"></a>  l =<span class="st"> </span><span class="kw">line_length</span>(x, y)</span>
<span id="cb196-5"><a href="tech.html#cb196-5"></a>  s =<span class="st"> </span>l <span class="op">/</span><span class="st"> </span><span class="kw">distance</span>(x[<span class="dv">1</span>], y[<span class="dv">1</span>], x[n], y[n]) </span>
<span id="cb196-6"><a href="tech.html#cb196-6"></a>  </span>
<span id="cb196-7"><a href="tech.html#cb196-7"></a>  <span class="kw">list</span>(<span class="dt">length =</span> l, <span class="dt">sinuosity =</span> s)</span>
<span id="cb196-8"><a href="tech.html#cb196-8"></a>}</span>
<span id="cb196-9"><a href="tech.html#cb196-9"></a></span>
<span id="cb196-10"><a href="tech.html#cb196-10"></a>result =<span class="st"> </span><span class="kw">line_params</span>(x, y)</span>
<span id="cb196-11"><a href="tech.html#cb196-11"></a>result<span class="op">$</span>length</span>
<span id="cb196-12"><a href="tech.html#cb196-12"></a><span class="co">## [1] 3.680251</span></span>
<span id="cb196-13"><a href="tech.html#cb196-13"></a>result<span class="op">$</span>sinuosity</span>
<span id="cb196-14"><a href="tech.html#cb196-14"></a><span class="co">## [1] 12.99222</span></span></code></pre></div>
</div>
<div id="tech-fun-functionals" class="section level3">
<h3><span class="header-section-number">4.1.2</span> Функционалы</h3>
<p>Данные (в том числе географические) практически всегда носят множественный характер и организованы в определенные структуры (см. главу 2). Эта особенность данных выдвигает логичное желание иметь процедуры, которые можно применять к полному набору данных, а не к его отдельным компонентам. Это и есть процедуры векторизованных вычислений.</p>
<p>Предположим, вам необходимо что-то вычислить для каждой строки таблицы, при этом порядок вычисления зависит от содержимого ячеек данной строки. Вы можете организовать подобные вычисления с помощью циклов, однако в <strong>R</strong> существуют специальные функции семейста <code>apply</code>, которые позволяют решать подобные задачи более элегантно и с высокой скоростью:</p>
<table>
<colgroup>
<col width="16%" />
<col width="83%" />
</colgroup>
<thead>
<tr class="header">
<th>Функция</th>
<th>Назначение</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>apply()</code></td>
<td>применить функцию ко всем строкам или столбцам матрицы</td>
</tr>
<tr class="even">
<td><code>lapply()</code></td>
<td>применить функцию к каждому компоненту вектора или списка и получить результат также в виде списка (<em>l — list</em>)</td>
</tr>
<tr class="odd">
<td><code>sapply()</code></td>
<td>применить функцию к каждому компоненту вектора или списка и получить результат в виде вектора (<em>s — simplify</em>)</td>
</tr>
<tr class="even">
<td><code>vapply()</code></td>
<td>аналогична vapply, но требует явного задания типа данных возвращаемого вектора, за счет чего работает быстрее (<em>v — velocity</em>)</td>
</tr>
<tr class="odd">
<td><code>mapply()</code></td>
<td>применить функцию к каждому компоненту нескольких векторов или списков и вернуть результат в виде списка (<em>m — multivariate</em>)</td>
</tr>
<tr class="even">
<td><code>rapply()</code></td>
<td>применить функцию рекурсивно ко всем элементам переданного списка и вернуть результат в аналогичной структур (<em>r — recursive</em>)</td>
</tr>
<tr class="odd">
<td><code>tapply()</code></td>
<td>применить функцию ко всем компонентам вектора или списка, сгруппировав их по значению переданного фактора</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Функции семейства <code>apply</code>, принимающие на вход списки, могут работать и с фреймами данных. В этом случае фрейм внутри функции будет преобразован с помощью функции <code>as.list()</code> в список, элементами которого являются столбцы (переменные) входного фрейма данных. Данные при этом не потеряются, их типы тоже не изменятся.</p>
</blockquote>
<p>Базовая функция <code>apply()</code> имеет следующие аргументы:</p>
<ul>
<li><code>X</code> — массив любой размерности (включая вектор)</li>
<li><code>MARGIN</code> — измерения по которым необходимо вести вычисления. Для матрицы <code>1</code> означает строку, <code>2</code> означает столбец, <code>c(1, 2)</code> будет означать, что вычисления производятся по всем комбинациям строк и столбцов</li>
<li><code>FUN</code> — функция, которая будет применяться к каждому элементу указанных измерений</li>
<li><code>...</code> — список аргументов, которые надо передать в функцию <code>FUN</code> (в этом случае массив должен передаваться обязательно в первый аргумент)</li>
</ul>
<p>Другие функции семейства <code>apply</code> в приложении к фреймам данных будут работать со столбцами (переменными), интерпретируя их как элементы списка. Наиболее часто из них используются <code>lapply()</code>, <code>sapply()</code> и <code>vapply()</code>. В отличие от <code>apply()</code>, они уже не принимаеют номера измерений и работают только с элементами переданного списка.</p>
<p>Рассмотрим применение функций данного семейства на примере анализа основных социально-экономических характеристик столиц субъектов Северо-Западного округа за 2015 год:</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="tech.html#cb197-1"></a><span class="co"># Функционалы</span></span>
<span id="cb197-2"><a href="tech.html#cb197-2"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb197-3"><a href="tech.html#cb197-3"></a><span class="co">## ── Attaching packages ──────────────────</span></span>
<span id="cb197-4"><a href="tech.html#cb197-4"></a><span class="co">## ✓ ggplot2 3.2.1     ✓ stringr 1.4.0</span></span>
<span id="cb197-5"><a href="tech.html#cb197-5"></a><span class="co">## ✓ purrr   0.3.3     ✓ forcats 0.4.0</span></span>
<span id="cb197-6"><a href="tech.html#cb197-6"></a><span class="co">## ── Conflicts ── tidyverse_conflicts() ──</span></span>
<span id="cb197-7"><a href="tech.html#cb197-7"></a><span class="co">## x dplyr::filter() masks stats::filter()</span></span>
<span id="cb197-8"><a href="tech.html#cb197-8"></a><span class="co">## x dplyr::lag()    masks stats::lag()</span></span>
<span id="cb197-9"><a href="tech.html#cb197-9"></a><span class="kw">library</span>(readxl)</span>
<span id="cb197-10"><a href="tech.html#cb197-10"></a></span>
<span id="cb197-11"><a href="tech.html#cb197-11"></a>(<span class="dt">df =</span> <span class="kw">read_excel</span>(<span class="st">&quot;data/sevzap.xlsx&quot;</span>, <span class="dt">col_types =</span> <span class="kw">c</span>(<span class="st">&#39;text&#39;</span>, <span class="kw">rep</span>(<span class="st">&#39;numeric&#39;</span>, <span class="dv">17</span>))))</span>
<span id="cb197-12"><a href="tech.html#cb197-12"></a><span class="co">## # A tibble: 10 x 18</span></span>
<span id="cb197-13"><a href="tech.html#cb197-13"></a><span class="co">##    city     pop birth death  labor salary livspace doctors  hosp assets business</span></span>
<span id="cb197-14"><a href="tech.html#cb197-14"></a><span class="co">##    &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb197-15"><a href="tech.html#cb197-15"></a><span class="co">##  1 Петр…  277.   13    12.3   72.3 36268.     24.4    75      17 2.47e5    15856</span></span>
<span id="cb197-16"><a href="tech.html#cb197-16"></a><span class="co">##  2 Сыкт…  259.   14.5  10.4   84.1 39790      22.8    79.5    17 2.17e5    10068</span></span>
<span id="cb197-17"><a href="tech.html#cb197-17"></a><span class="co">##  3 Арха…  358.   11.8  11.6   97.9 40303.     22.7    82.3    19 2.79e5    13016</span></span>
<span id="cb197-18"><a href="tech.html#cb197-18"></a><span class="co">##  4 Нарь…   24.5  18.1   7.6   12.7 69884.     23.6    65.2     2 1.05e5      704</span></span>
<span id="cb197-19"><a href="tech.html#cb197-19"></a><span class="co">##  5 Воло…  313.   16.2  11.4   91   31483      24.7    60.9    18 8.27e5    21931</span></span>
<span id="cb197-20"><a href="tech.html#cb197-20"></a><span class="co">##  6 Кали…  460.   13.3  13.4  126.  34142      27.7    69.8    25 3.27e5    38013</span></span>
<span id="cb197-21"><a href="tech.html#cb197-21"></a><span class="co">##  7 Мурм…  302.   12.4  11.9   96.9 53240.     23.8    68.8    15 7.24e5    16041</span></span>
<span id="cb197-22"><a href="tech.html#cb197-22"></a><span class="co">##  8 Вели…  222.   13.8  13.8   74.1 32377.     24.1    78.9    14 1.59e5     9583</span></span>
<span id="cb197-23"><a href="tech.html#cb197-23"></a><span class="co">##  9 Псков  208.   13.2  13.7   59.6 27405.     25      59      13 1.31e5     8752</span></span>
<span id="cb197-24"><a href="tech.html#cb197-24"></a><span class="co">## 10 Санк… 5226.   13.6  11.9 2055.  44187      23.6    73.8   112 4.10e6   374999</span></span>
<span id="cb197-25"><a href="tech.html#cb197-25"></a><span class="co">## # … with 7 more variables: minerals &lt;dbl&gt;, manufact &lt;dbl&gt;, engaswat &lt;dbl&gt;,</span></span>
<span id="cb197-26"><a href="tech.html#cb197-26"></a><span class="co">## #   construct &lt;dbl&gt;, apart &lt;dbl&gt;, retail &lt;dbl&gt;, invest &lt;dbl&gt;</span></span></code></pre></div>
<p>В данной таблице каждый столбец представляет независимую переменную со своими единицами измерения, поэтому ее необходимо оставить в “широкой” форме, не преобразуя в длинную. Используя <code>apply</code>, можно быстро получить максимальные значения каждой переменной:</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="tech.html#cb198-1"></a><span class="kw">apply</span>(df[<span class="op">-</span><span class="dv">1</span>], <span class="dv">2</span>, max)</span>
<span id="cb198-2"><a href="tech.html#cb198-2"></a><span class="co">##       pop     birth     death     labor    salary  livspace   doctors      hosp </span></span>
<span id="cb198-3"><a href="tech.html#cb198-3"></a><span class="co">##    5225.7      18.1      13.8    2055.3   69883.5      27.7      82.3     112.0 </span></span>
<span id="cb198-4"><a href="tech.html#cb198-4"></a><span class="co">##    assets  business  minerals  manufact  engaswat construct     apart    retail </span></span>
<span id="cb198-5"><a href="tech.html#cb198-5"></a><span class="co">## 4102243.8  374999.0        NA 1978634.0  173292.0  397229.0    3031.0 1144607.0 </span></span>
<span id="cb198-6"><a href="tech.html#cb198-6"></a><span class="co">##    invest </span></span>
<span id="cb198-7"><a href="tech.html#cb198-7"></a><span class="co">##  521293.0</span></span></code></pre></div>
<p>Что равносильно вызову sapply:</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="tech.html#cb199-1"></a><span class="kw">sapply</span>(df[<span class="op">-</span><span class="dv">1</span>], max)</span>
<span id="cb199-2"><a href="tech.html#cb199-2"></a><span class="co">##       pop     birth     death     labor    salary  livspace   doctors      hosp </span></span>
<span id="cb199-3"><a href="tech.html#cb199-3"></a><span class="co">##    5225.7      18.1      13.8    2055.3   69883.5      27.7      82.3     112.0 </span></span>
<span id="cb199-4"><a href="tech.html#cb199-4"></a><span class="co">##    assets  business  minerals  manufact  engaswat construct     apart    retail </span></span>
<span id="cb199-5"><a href="tech.html#cb199-5"></a><span class="co">## 4102243.8  374999.0        NA 1978634.0  173292.0  397229.0    3031.0 1144607.0 </span></span>
<span id="cb199-6"><a href="tech.html#cb199-6"></a><span class="co">##    invest </span></span>
<span id="cb199-7"><a href="tech.html#cb199-7"></a><span class="co">##  521293.0</span></span></code></pre></div>
<p>В качестве функции можно использовать не только стандартные, но и пользовательские функции. Например, нам может быть интересно не максимальное значение показателя, а его отношение к среднему значению среди всех городов. Здесь уже одной функцией не обойдешься, так как нужно каждый столбец поделить на среднее значение по нему. Для этого определим небольшую пользовательскую функцию непосредственно при вызове <code>sapply()</code>:</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="tech.html#cb200-1"></a>(<span class="dt">normalized =</span> <span class="kw">sapply</span>(df[<span class="op">-</span><span class="dv">1</span>], <span class="cf">function</span>(X) { <span class="kw">round</span>(X <span class="op">/</span><span class="st"> </span><span class="kw">mean</span>(X, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dv">2</span>) }))</span>
<span id="cb200-2"><a href="tech.html#cb200-2"></a><span class="co">##        pop birth death labor salary livspace doctors hosp assets business</span></span>
<span id="cb200-3"><a href="tech.html#cb200-3"></a><span class="co">##  [1,] 0.36  0.93  1.04  0.26   0.89     1.01    1.05 0.67   0.35     0.31</span></span>
<span id="cb200-4"><a href="tech.html#cb200-4"></a><span class="co">##  [2,] 0.34  1.04  0.88  0.30   0.97     0.94    1.11 0.67   0.30     0.20</span></span>
<span id="cb200-5"><a href="tech.html#cb200-5"></a><span class="co">##  [3,] 0.47  0.84  0.98  0.35   0.99     0.94    1.15 0.75   0.39     0.26</span></span>
<span id="cb200-6"><a href="tech.html#cb200-6"></a><span class="co">##  [4,] 0.03  1.29  0.64  0.05   1.71     0.97    0.91 0.08   0.15     0.01</span></span>
<span id="cb200-7"><a href="tech.html#cb200-7"></a><span class="co">##  [5,] 0.41  1.16  0.97  0.33   0.77     1.02    0.85 0.71   1.16     0.43</span></span>
<span id="cb200-8"><a href="tech.html#cb200-8"></a><span class="co">##  [6,] 0.60  0.95  1.14  0.46   0.83     1.14    0.98 0.99   0.46     0.75</span></span>
<span id="cb200-9"><a href="tech.html#cb200-9"></a><span class="co">##  [7,] 0.39  0.89  1.01  0.35   1.30     0.98    0.96 0.60   1.02     0.32</span></span>
<span id="cb200-10"><a href="tech.html#cb200-10"></a><span class="co">##  [8,] 0.29  0.99  1.17  0.27   0.79     0.99    1.11 0.56   0.22     0.19</span></span>
<span id="cb200-11"><a href="tech.html#cb200-11"></a><span class="co">##  [9,] 0.27  0.94  1.16  0.22   0.67     1.03    0.83 0.52   0.18     0.17</span></span>
<span id="cb200-12"><a href="tech.html#cb200-12"></a><span class="co">## [10,] 6.83  0.97  1.01  7.42   1.08     0.97    1.03 4.44   5.76     7.37</span></span>
<span id="cb200-13"><a href="tech.html#cb200-13"></a><span class="co">##       minerals manufact engaswat construct apart retail invest</span></span>
<span id="cb200-14"><a href="tech.html#cb200-14"></a><span class="co">##  [1,]     0.06     0.05     0.52      0.13  0.45   0.23   0.11</span></span>
<span id="cb200-15"><a href="tech.html#cb200-15"></a><span class="co">##  [2,]     0.00     0.28     0.43      0.09  0.31   0.21   0.14</span></span>
<span id="cb200-16"><a href="tech.html#cb200-16"></a><span class="co">##  [3,]     0.00     0.06     0.49      0.09  0.17   0.17   0.15</span></span>
<span id="cb200-17"><a href="tech.html#cb200-17"></a><span class="co">##  [4,]     4.12     0.05     0.03      0.08  0.05   0.02   0.52</span></span>
<span id="cb200-18"><a href="tech.html#cb200-18"></a><span class="co">##  [5,]       NA     0.15     0.63      0.09  0.52   0.23   0.13</span></span>
<span id="cb200-19"><a href="tech.html#cb200-19"></a><span class="co">##  [6,]     0.82     0.83     0.68      0.28  1.24   0.38   0.53</span></span>
<span id="cb200-20"><a href="tech.html#cb200-20"></a><span class="co">##  [7,]       NA     0.23     0.42      0.07  0.02   0.29   0.75</span></span>
<span id="cb200-21"><a href="tech.html#cb200-21"></a><span class="co">##  [8,]       NA     0.42     0.45      0.08  0.32   0.17   0.30</span></span>
<span id="cb200-22"><a href="tech.html#cb200-22"></a><span class="co">##  [9,]       NA     0.08     0.22      0.04  0.27   0.17   0.10</span></span>
<span id="cb200-23"><a href="tech.html#cb200-23"></a><span class="co">## [10,]     1.00     7.87     6.13      9.05  6.65   8.13   7.28</span></span></code></pre></div>
<p>Полученный объект является матрицей. Таким образом, можно видеть, что функционалы бывают полезны не только для агрегирования таблиц, но и для преобразования данных, когда структура таблицы остается прежней.</p>
<p>В приведенном выше коде мы сознательно исключили первый столбец, поскольку он является текстовым. Можно сделать более мощную и универсальную функцию, которая будет нормировать все числовые столбцы таблицы, а текстовые оставлять в оригинале. Для этого проверку типа данных надо внести внутрь функции. Поскольку код функции при этом вырастает, целесообразно определить ее заранее. Поскольку в этом случае часть векторов будет символьной, а не числовой, необходимо применять функцию <code>lapply()</code>, которая вернет список из векторов, а не матрицу и таким образом сохранит типы каждого столбца:</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="tech.html#cb201-1"></a>normalize =<span class="st"> </span><span class="cf">function</span>(X) {</span>
<span id="cb201-2"><a href="tech.html#cb201-2"></a>  <span class="cf">if</span> (<span class="kw">is.numeric</span>(X)) </span>
<span id="cb201-3"><a href="tech.html#cb201-3"></a>    <span class="kw">round</span>(X <span class="op">/</span><span class="st"> </span><span class="kw">mean</span>(X, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dv">2</span>) </span>
<span id="cb201-4"><a href="tech.html#cb201-4"></a>  <span class="cf">else</span> X</span>
<span id="cb201-5"><a href="tech.html#cb201-5"></a>}</span>
<span id="cb201-6"><a href="tech.html#cb201-6"></a></span>
<span id="cb201-7"><a href="tech.html#cb201-7"></a>(<span class="dt">normalized_df =</span> df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">lapply</span>(normalize) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_tibble</span>())</span>
<span id="cb201-8"><a href="tech.html#cb201-8"></a><span class="co">## # A tibble: 10 x 18</span></span>
<span id="cb201-9"><a href="tech.html#cb201-9"></a><span class="co">##    city    pop birth death labor salary livspace doctors  hosp assets business</span></span>
<span id="cb201-10"><a href="tech.html#cb201-10"></a><span class="co">##    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb201-11"><a href="tech.html#cb201-11"></a><span class="co">##  1 Петр… 0.36   0.93  1.04  0.26   0.89     1.01    1.05  0.67   0.35     0.31</span></span>
<span id="cb201-12"><a href="tech.html#cb201-12"></a><span class="co">##  2 Сыкт… 0.34   1.04  0.88  0.3    0.97     0.94    1.11  0.67   0.3      0.2 </span></span>
<span id="cb201-13"><a href="tech.html#cb201-13"></a><span class="co">##  3 Арха… 0.47   0.84  0.98  0.35   0.99     0.94    1.15  0.75   0.39     0.26</span></span>
<span id="cb201-14"><a href="tech.html#cb201-14"></a><span class="co">##  4 Нарь… 0.03   1.29  0.64  0.05   1.71     0.97    0.91  0.08   0.15     0.01</span></span>
<span id="cb201-15"><a href="tech.html#cb201-15"></a><span class="co">##  5 Воло… 0.41   1.16  0.97  0.33   0.77     1.02    0.85  0.71   1.16     0.43</span></span>
<span id="cb201-16"><a href="tech.html#cb201-16"></a><span class="co">##  6 Кали… 0.6    0.95  1.14  0.46   0.83     1.14    0.98  0.99   0.46     0.75</span></span>
<span id="cb201-17"><a href="tech.html#cb201-17"></a><span class="co">##  7 Мурм… 0.39   0.89  1.01  0.35   1.3      0.98    0.96  0.6    1.02     0.32</span></span>
<span id="cb201-18"><a href="tech.html#cb201-18"></a><span class="co">##  8 Вели… 0.290  0.99  1.17  0.27   0.79     0.99    1.11  0.56   0.22     0.19</span></span>
<span id="cb201-19"><a href="tech.html#cb201-19"></a><span class="co">##  9 Псков 0.27   0.94  1.16  0.22   0.67     1.03    0.83  0.52   0.18     0.17</span></span>
<span id="cb201-20"><a href="tech.html#cb201-20"></a><span class="co">## 10 Санк… 6.83   0.97  1.01  7.42   1.08     0.97    1.03  4.44   5.76     7.37</span></span>
<span id="cb201-21"><a href="tech.html#cb201-21"></a><span class="co">## # … with 7 more variables: minerals &lt;dbl&gt;, manufact &lt;dbl&gt;, engaswat &lt;dbl&gt;,</span></span>
<span id="cb201-22"><a href="tech.html#cb201-22"></a><span class="co">## #   construct &lt;dbl&gt;, apart &lt;dbl&gt;, retail &lt;dbl&gt;, invest &lt;dbl&gt;</span></span></code></pre></div>
<p>В качестве альтернативы функциям <code>apply</code> можно также воспользоваться вычислениями посредством функций семейства <code>map</code> из пакета <code>purrr</code> (еще один пакет из <a href="https://www.tidyverse.org/packages/">tidyverse</a>). Эти функции работают аналогично <code>sapply()</code>:</p>
<ul>
<li><code>map()</code> возвращает список.</li>
<li><code>map_lgl()</code> возвращает вектор логических значений.</li>
<li><code>map_int()</code> возвращает вектор целочисленных значений.</li>
<li><code>map_dbl()</code> возвращает вектор чисел с плавающей точкой.</li>
<li><code>map_chr()</code> возвращает вектор строк.</li>
</ul>
<p>Например, вышеприведенные операции можно осуществить средствами <strong>purrr</strong> вот так:</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="tech.html#cb202-1"></a><span class="kw">map_dbl</span>(df[<span class="op">-</span><span class="dv">1</span>], max)</span>
<span id="cb202-2"><a href="tech.html#cb202-2"></a><span class="co">##       pop     birth     death     labor    salary  livspace   doctors      hosp </span></span>
<span id="cb202-3"><a href="tech.html#cb202-3"></a><span class="co">##    5225.7      18.1      13.8    2055.3   69883.5      27.7      82.3     112.0 </span></span>
<span id="cb202-4"><a href="tech.html#cb202-4"></a><span class="co">##    assets  business  minerals  manufact  engaswat construct     apart    retail </span></span>
<span id="cb202-5"><a href="tech.html#cb202-5"></a><span class="co">## 4102243.8  374999.0        NA 1978634.0  173292.0  397229.0    3031.0 1144607.0 </span></span>
<span id="cb202-6"><a href="tech.html#cb202-6"></a><span class="co">##    invest </span></span>
<span id="cb202-7"><a href="tech.html#cb202-7"></a><span class="co">##  521293.0</span></span>
<span id="cb202-8"><a href="tech.html#cb202-8"></a>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(normalize) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_tibble</span>()</span>
<span id="cb202-9"><a href="tech.html#cb202-9"></a><span class="co">## # A tibble: 10 x 18</span></span>
<span id="cb202-10"><a href="tech.html#cb202-10"></a><span class="co">##    city    pop birth death labor salary livspace doctors  hosp assets business</span></span>
<span id="cb202-11"><a href="tech.html#cb202-11"></a><span class="co">##    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb202-12"><a href="tech.html#cb202-12"></a><span class="co">##  1 Петр… 0.36   0.93  1.04  0.26   0.89     1.01    1.05  0.67   0.35     0.31</span></span>
<span id="cb202-13"><a href="tech.html#cb202-13"></a><span class="co">##  2 Сыкт… 0.34   1.04  0.88  0.3    0.97     0.94    1.11  0.67   0.3      0.2 </span></span>
<span id="cb202-14"><a href="tech.html#cb202-14"></a><span class="co">##  3 Арха… 0.47   0.84  0.98  0.35   0.99     0.94    1.15  0.75   0.39     0.26</span></span>
<span id="cb202-15"><a href="tech.html#cb202-15"></a><span class="co">##  4 Нарь… 0.03   1.29  0.64  0.05   1.71     0.97    0.91  0.08   0.15     0.01</span></span>
<span id="cb202-16"><a href="tech.html#cb202-16"></a><span class="co">##  5 Воло… 0.41   1.16  0.97  0.33   0.77     1.02    0.85  0.71   1.16     0.43</span></span>
<span id="cb202-17"><a href="tech.html#cb202-17"></a><span class="co">##  6 Кали… 0.6    0.95  1.14  0.46   0.83     1.14    0.98  0.99   0.46     0.75</span></span>
<span id="cb202-18"><a href="tech.html#cb202-18"></a><span class="co">##  7 Мурм… 0.39   0.89  1.01  0.35   1.3      0.98    0.96  0.6    1.02     0.32</span></span>
<span id="cb202-19"><a href="tech.html#cb202-19"></a><span class="co">##  8 Вели… 0.290  0.99  1.17  0.27   0.79     0.99    1.11  0.56   0.22     0.19</span></span>
<span id="cb202-20"><a href="tech.html#cb202-20"></a><span class="co">##  9 Псков 0.27   0.94  1.16  0.22   0.67     1.03    0.83  0.52   0.18     0.17</span></span>
<span id="cb202-21"><a href="tech.html#cb202-21"></a><span class="co">## 10 Санк… 6.83   0.97  1.01  7.42   1.08     0.97    1.03  4.44   5.76     7.37</span></span>
<span id="cb202-22"><a href="tech.html#cb202-22"></a><span class="co">## # … with 7 more variables: minerals &lt;dbl&gt;, manufact &lt;dbl&gt;, engaswat &lt;dbl&gt;,</span></span>
<span id="cb202-23"><a href="tech.html#cb202-23"></a><span class="co">## #   construct &lt;dbl&gt;, apart &lt;dbl&gt;, retail &lt;dbl&gt;, invest &lt;dbl&gt;</span></span></code></pre></div>
</div>
</div>
<div id="tech-meta" class="section level2">
<h2><span class="header-section-number">4.2</span> Метапрограммирование</h2>
<p>Метапрограммирование — это техника программирования, при которой программный код может генерировать другой код. Широкая поддержка и интенсивное использование метапрограммирования – одна из удивительных черт <strong>R</strong>, которая ставит его особняком на фоне многих других языков, включая Python. Метапрограммирование позволяет во многих случаях сделать код более компактным и подойти к решению задачи элегантным путем.</p>
<p>Вы уже сталкивались с метапрограммированием, когда работали с функциями <code>dplyr</code>. Например, сравните следующие два способа извлечь столбец из фрейма данных:</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="tech.html#cb203-1"></a>df[<span class="st">&quot;salary&quot;</span>]</span>
<span id="cb203-2"><a href="tech.html#cb203-2"></a><span class="co">## # A tibble: 10 x 1</span></span>
<span id="cb203-3"><a href="tech.html#cb203-3"></a><span class="co">##    salary</span></span>
<span id="cb203-4"><a href="tech.html#cb203-4"></a><span class="co">##     &lt;dbl&gt;</span></span>
<span id="cb203-5"><a href="tech.html#cb203-5"></a><span class="co">##  1 36268.</span></span>
<span id="cb203-6"><a href="tech.html#cb203-6"></a><span class="co">##  2 39790 </span></span>
<span id="cb203-7"><a href="tech.html#cb203-7"></a><span class="co">##  3 40303.</span></span>
<span id="cb203-8"><a href="tech.html#cb203-8"></a><span class="co">##  4 69884.</span></span>
<span id="cb203-9"><a href="tech.html#cb203-9"></a><span class="co">##  5 31483 </span></span>
<span id="cb203-10"><a href="tech.html#cb203-10"></a><span class="co">##  6 34142 </span></span>
<span id="cb203-11"><a href="tech.html#cb203-11"></a><span class="co">##  7 53240.</span></span>
<span id="cb203-12"><a href="tech.html#cb203-12"></a><span class="co">##  8 32377.</span></span>
<span id="cb203-13"><a href="tech.html#cb203-13"></a><span class="co">##  9 27405.</span></span>
<span id="cb203-14"><a href="tech.html#cb203-14"></a><span class="co">## 10 44187</span></span>
<span id="cb203-15"><a href="tech.html#cb203-15"></a></span>
<span id="cb203-16"><a href="tech.html#cb203-16"></a><span class="kw">select</span>(df, salary)</span>
<span id="cb203-17"><a href="tech.html#cb203-17"></a><span class="co">## # A tibble: 10 x 1</span></span>
<span id="cb203-18"><a href="tech.html#cb203-18"></a><span class="co">##    salary</span></span>
<span id="cb203-19"><a href="tech.html#cb203-19"></a><span class="co">##     &lt;dbl&gt;</span></span>
<span id="cb203-20"><a href="tech.html#cb203-20"></a><span class="co">##  1 36268.</span></span>
<span id="cb203-21"><a href="tech.html#cb203-21"></a><span class="co">##  2 39790 </span></span>
<span id="cb203-22"><a href="tech.html#cb203-22"></a><span class="co">##  3 40303.</span></span>
<span id="cb203-23"><a href="tech.html#cb203-23"></a><span class="co">##  4 69884.</span></span>
<span id="cb203-24"><a href="tech.html#cb203-24"></a><span class="co">##  5 31483 </span></span>
<span id="cb203-25"><a href="tech.html#cb203-25"></a><span class="co">##  6 34142 </span></span>
<span id="cb203-26"><a href="tech.html#cb203-26"></a><span class="co">##  7 53240.</span></span>
<span id="cb203-27"><a href="tech.html#cb203-27"></a><span class="co">##  8 32377.</span></span>
<span id="cb203-28"><a href="tech.html#cb203-28"></a><span class="co">##  9 27405.</span></span>
<span id="cb203-29"><a href="tech.html#cb203-29"></a><span class="co">## 10 44187</span></span></code></pre></div>
<p>В обоих случаях мы получили один и тот же результат. В первом случае было указано название столбца в кавычках. Во втором мы передали название столбца без кавычек, точно так же как было передано название фрейма данных. Однако фрейм данных с названием <code>df</code> был создан перед вызовом <code>select</code>. Вас не смущает, что объекта <code>salary</code> в нашем скрипте не существует, а мы его передаем в качестве аргумента функции? Мы ведь не создавали такой переменной в программе. Как же функция догадывается о том, что его надо интерпретировать не как переменную, а как название столбца?</p>
<p>Для начала разберемся с тем, что происходит в программном коде:</p>
<ul>
<li><code>select()</code> представляет собой <strong>вызов</strong> (call) функции</li>
<li><code>df</code> и <code>salary</code> представляют собой <strong>символы</strong>, обозначающие объекты в программе.</li>
<li><code>"salary"</code> представляет собой <strong>константу</strong></li>
</ul>
<p>R — это <em>функциональный</em> язык программирования. Любая программа на R состоит из вызовов функций, которые применяются к символам и константам. Привычные нам арифметические операции на самом деле тоже являются вызовами функций. Это выглядит довольно неожиданно:</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="tech.html#cb204-1"></a>a =<span class="st"> </span><span class="dv">78</span>     <span class="co"># стандартная запись</span></span>
<span id="cb204-2"><a href="tech.html#cb204-2"></a><span class="st">`</span><span class="dt">=</span><span class="st">`</span>(a, <span class="dv">78</span>) <span class="co"># функциональная запись</span></span>
<span id="cb204-3"><a href="tech.html#cb204-3"></a></span>
<span id="cb204-4"><a href="tech.html#cb204-4"></a>a <span class="op">+</span><span class="st"> </span><span class="dv">4</span>     <span class="co"># стандартная запись</span></span>
<span id="cb204-5"><a href="tech.html#cb204-5"></a><span class="co">## [1] 82</span></span>
<span id="cb204-6"><a href="tech.html#cb204-6"></a><span class="st">`</span><span class="dt">+</span><span class="st">`</span>(a, <span class="dv">4</span>) <span class="co"># функциональная запись</span></span>
<span id="cb204-7"><a href="tech.html#cb204-7"></a><span class="co">## [1] 82</span></span>
<span id="cb204-8"><a href="tech.html#cb204-8"></a></span>
<span id="cb204-9"><a href="tech.html#cb204-9"></a>df[<span class="st">&#39;salary&#39;</span>]      <span class="co"># стандартная запись</span></span>
<span id="cb204-10"><a href="tech.html#cb204-10"></a><span class="co">## # A tibble: 10 x 1</span></span>
<span id="cb204-11"><a href="tech.html#cb204-11"></a><span class="co">##    salary</span></span>
<span id="cb204-12"><a href="tech.html#cb204-12"></a><span class="co">##     &lt;dbl&gt;</span></span>
<span id="cb204-13"><a href="tech.html#cb204-13"></a><span class="co">##  1 36268.</span></span>
<span id="cb204-14"><a href="tech.html#cb204-14"></a><span class="co">##  2 39790 </span></span>
<span id="cb204-15"><a href="tech.html#cb204-15"></a><span class="co">##  3 40303.</span></span>
<span id="cb204-16"><a href="tech.html#cb204-16"></a><span class="co">##  4 69884.</span></span>
<span id="cb204-17"><a href="tech.html#cb204-17"></a><span class="co">##  5 31483 </span></span>
<span id="cb204-18"><a href="tech.html#cb204-18"></a><span class="co">##  6 34142 </span></span>
<span id="cb204-19"><a href="tech.html#cb204-19"></a><span class="co">##  7 53240.</span></span>
<span id="cb204-20"><a href="tech.html#cb204-20"></a><span class="co">##  8 32377.</span></span>
<span id="cb204-21"><a href="tech.html#cb204-21"></a><span class="co">##  9 27405.</span></span>
<span id="cb204-22"><a href="tech.html#cb204-22"></a><span class="co">## 10 44187</span></span>
<span id="cb204-23"><a href="tech.html#cb204-23"></a><span class="st">`</span><span class="dt">[</span><span class="st">`</span>(df, <span class="st">&#39;salary&#39;</span>) <span class="co"># функциональная запись</span></span>
<span id="cb204-24"><a href="tech.html#cb204-24"></a><span class="co">## # A tibble: 10 x 1</span></span>
<span id="cb204-25"><a href="tech.html#cb204-25"></a><span class="co">##    salary</span></span>
<span id="cb204-26"><a href="tech.html#cb204-26"></a><span class="co">##     &lt;dbl&gt;</span></span>
<span id="cb204-27"><a href="tech.html#cb204-27"></a><span class="co">##  1 36268.</span></span>
<span id="cb204-28"><a href="tech.html#cb204-28"></a><span class="co">##  2 39790 </span></span>
<span id="cb204-29"><a href="tech.html#cb204-29"></a><span class="co">##  3 40303.</span></span>
<span id="cb204-30"><a href="tech.html#cb204-30"></a><span class="co">##  4 69884.</span></span>
<span id="cb204-31"><a href="tech.html#cb204-31"></a><span class="co">##  5 31483 </span></span>
<span id="cb204-32"><a href="tech.html#cb204-32"></a><span class="co">##  6 34142 </span></span>
<span id="cb204-33"><a href="tech.html#cb204-33"></a><span class="co">##  7 53240.</span></span>
<span id="cb204-34"><a href="tech.html#cb204-34"></a><span class="co">##  8 32377.</span></span>
<span id="cb204-35"><a href="tech.html#cb204-35"></a><span class="co">##  9 27405.</span></span>
<span id="cb204-36"><a href="tech.html#cb204-36"></a><span class="co">## 10 44187</span></span></code></pre></div>
<p>Таким образом, бинарный оператор в R представляет собой <em>вызов функции с двумя аргументами</em>.</p>
<p>Программный код <code>a + 4</code> с точки зрения R является <strong>выражением</strong> <em>(expression)</em>. Выражение может состоять вообще из одного символа, то есть <code>a</code> — это тоже выражение. Когда интерпретатор доходит до выражения <code>a + 4</code>, он выполняет следующее:</p>
<ol style="list-style-type: decimal">
<li><strong>Оценка</strong> <em>(evaluation)</em> выражения <code>a</code>. Результатом оценки является константа <code>78</code></li>
<li><strong>Вызов</strong> <em>(call)</em> функции <code>+</code>, которая складывает константы 78 и 4</li>
</ol>
<p>Не все символы и выражения в программе необходимо оценивать. Некоторые из них необходимо <strong>квотировать</strong>, то есть использовать в качестве <em>имени</em> объекта. Квотацию можно условно рассматривать как простановку кавычек вокруг выражения. Для обозначения квотации в явном виде используются обратные кавычки: <code>`</code> Мы уже сталкивались с квотацией при вызове функции сложения: <code>`+`(a, 4)</code>. В данном случае квотация была нужна чтобы <code>+</code> интерпретировался как <em>имя</em> функции.</p>
<p>Явная квотация бывает необходима, когда объекты R имеют недопустимые имена, например начинаются с цифры или содержат пробелы. Для начала рассмотрим искусственный пример:</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="tech.html#cb205-1"></a><span class="st">`</span><span class="dt">f + 17</span><span class="st">`</span> =<span class="st"> </span><span class="dv">87</span> <span class="co"># создаем объект с именем f + 17</span></span>
<span id="cb205-2"><a href="tech.html#cb205-2"></a>f <span class="op">+</span><span class="st"> </span><span class="dv">17</span> <span class="co"># ошибка: переменной f не существует</span></span>
<span id="cb205-3"><a href="tech.html#cb205-3"></a><span class="co">## [1] 5.5</span></span>
<span id="cb205-4"><a href="tech.html#cb205-4"></a><span class="st">`</span><span class="dt">f + 17</span><span class="st">`</span> <span class="co"># обращаемся к объекту путем явной квотации</span></span>
<span id="cb205-5"><a href="tech.html#cb205-5"></a><span class="co">## [1] 87</span></span></code></pre></div>
<p>Теперь более жизнеспособный пример: данные о населении федеральных округов:</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="tech.html#cb206-1"></a><span class="kw">library</span>(readr)</span>
<span id="cb206-2"><a href="tech.html#cb206-2"></a>(<span class="dt">okruga =</span> <span class="kw">read_csv</span>(<span class="st">&#39;data/okruga.csv&#39;</span>))</span>
<span id="cb206-3"><a href="tech.html#cb206-3"></a><span class="co">## Parsed with column specification:</span></span>
<span id="cb206-4"><a href="tech.html#cb206-4"></a><span class="co">## cols(</span></span>
<span id="cb206-5"><a href="tech.html#cb206-5"></a><span class="co">##   `№` = col_double(),</span></span>
<span id="cb206-6"><a href="tech.html#cb206-6"></a><span class="co">##   Регион = col_character(),</span></span>
<span id="cb206-7"><a href="tech.html#cb206-7"></a><span class="co">##   `2005` = col_double(),</span></span>
<span id="cb206-8"><a href="tech.html#cb206-8"></a><span class="co">##   `2010` = col_double(),</span></span>
<span id="cb206-9"><a href="tech.html#cb206-9"></a><span class="co">##   `2011` = col_double(),</span></span>
<span id="cb206-10"><a href="tech.html#cb206-10"></a><span class="co">##   `2012` = col_double(),</span></span>
<span id="cb206-11"><a href="tech.html#cb206-11"></a><span class="co">##   `2013` = col_double()</span></span>
<span id="cb206-12"><a href="tech.html#cb206-12"></a><span class="co">## )</span></span>
<span id="cb206-13"><a href="tech.html#cb206-13"></a><span class="co">## # A tibble: 8 x 7</span></span>
<span id="cb206-14"><a href="tech.html#cb206-14"></a><span class="co">##     `№` Регион            `2005` `2010` `2011` `2012` `2013`</span></span>
<span id="cb206-15"><a href="tech.html#cb206-15"></a><span class="co">##   &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb206-16"><a href="tech.html#cb206-16"></a><span class="co">## 1     1 Центральный         4341   3761   3613   3651   3570</span></span>
<span id="cb206-17"><a href="tech.html#cb206-17"></a><span class="co">## 2     2 Северо-Западный     3192   3088   2866   2877   2796</span></span>
<span id="cb206-18"><a href="tech.html#cb206-18"></a><span class="co">## 3     3 Южный федеральный   1409   1446   1436   1394   1321</span></span>
<span id="cb206-19"><a href="tech.html#cb206-19"></a><span class="co">## 4     4 Северо-Кавказский    496    390    397    395    374</span></span>
<span id="cb206-20"><a href="tech.html#cb206-20"></a><span class="co">## 5     5 Приволжский         3162   2883   2857   2854   2849</span></span>
<span id="cb206-21"><a href="tech.html#cb206-21"></a><span class="co">## 6     6 Уральский           1681   1860   1834   1665   1624</span></span>
<span id="cb206-22"><a href="tech.html#cb206-22"></a><span class="co">## 7     7 Сибирский           2575   2218   2142   2077   1941</span></span>
<span id="cb206-23"><a href="tech.html#cb206-23"></a><span class="co">## 8     8 Дальневосточный      871    870    821    765    713</span></span></code></pre></div>
<p>Обратите внимание на обратные кавычки вокруг названий столбцов. Они проставлены потому что числа в среде R по умолчанию <em>оцениваются</em>, и не могут использоваться в качестве символов для объектов. Чтобы разрешить это, используется принудительная квотация. Как мы уже знаем, чтобы обратиться к такому объекту, надо использовать обратные кавычки:</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="tech.html#cb207-1"></a>okruga<span class="op">$</span><span class="dv">2010</span>   <span class="co"># ошибка: 2010 - константа, которая оценивается</span></span>
<span id="cb207-2"><a href="tech.html#cb207-2"></a><span class="co">## Error: &lt;text&gt;:1:8: неожиданная числовая константа</span></span>
<span id="cb207-3"><a href="tech.html#cb207-3"></a><span class="co">## 1: okruga$2010</span></span>
<span id="cb207-4"><a href="tech.html#cb207-4"></a><span class="co">##            ^</span></span></code></pre></div>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="tech.html#cb208-1"></a>okruga<span class="op">$</span><span class="st">`</span><span class="dt">2010</span><span class="st">`</span> <span class="co"># правильно: `2010` -- символ, полученный путем квотации</span></span>
<span id="cb208-2"><a href="tech.html#cb208-2"></a><span class="co">## [1] 3761 3088 1446  390 2883 1860 2218  870</span></span></code></pre></div>
<p>Теперь вернемся к примеру с использованием функции <code>select()</code>. Данная функция <em>оценивает</em> первый аргумент (фрейм данных) и <em>квотирует</em> все оставшиеся аргументы, которые отвечают за названия столбцов. Это позволяет избежать использования кавычек и использовать символы для наименования объектов. Чтобы понять, использует ли функция оценку или квотацию ее аргументов, необходимо ознакомиться с ее справкой.</p>
<blockquote>
<p>Когда функция применяет квотацию аргументов, говорят что осуществляется <strong>нестандартная оценка</strong> <em>(NSE – non-standard evaluation)</em>. Если аргументы функции оцениваются, то происходит <strong>стандартная оценка</strong> <em>(SE – standard evaluation)</em></p>
</blockquote>
<p>Иногда бывает необходимо использовать строковые названия столбцов (например, если они записаны у вас в переменные). В таком случае можно использовать функцию <code>select_()</code> (с подчеркиванием в конце), которая будет выполнять оценку ее аргументов вместо квотации:</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="tech.html#cb209-1"></a>f1 =<span class="st"> &#39;salary&#39;</span></span>
<span id="cb209-2"><a href="tech.html#cb209-2"></a>f2 =<span class="st"> &#39;birth&#39;</span></span>
<span id="cb209-3"><a href="tech.html#cb209-3"></a><span class="kw">select_</span>(df, f1, f2)        <span class="co"># ОК</span></span>
<span id="cb209-4"><a href="tech.html#cb209-4"></a><span class="co">## # A tibble: 10 x 2</span></span>
<span id="cb209-5"><a href="tech.html#cb209-5"></a><span class="co">##    salary birth</span></span>
<span id="cb209-6"><a href="tech.html#cb209-6"></a><span class="co">##     &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb209-7"><a href="tech.html#cb209-7"></a><span class="co">##  1 36268.  13  </span></span>
<span id="cb209-8"><a href="tech.html#cb209-8"></a><span class="co">##  2 39790   14.5</span></span>
<span id="cb209-9"><a href="tech.html#cb209-9"></a><span class="co">##  3 40303.  11.8</span></span>
<span id="cb209-10"><a href="tech.html#cb209-10"></a><span class="co">##  4 69884.  18.1</span></span>
<span id="cb209-11"><a href="tech.html#cb209-11"></a><span class="co">##  5 31483   16.2</span></span>
<span id="cb209-12"><a href="tech.html#cb209-12"></a><span class="co">##  6 34142   13.3</span></span>
<span id="cb209-13"><a href="tech.html#cb209-13"></a><span class="co">##  7 53240.  12.4</span></span>
<span id="cb209-14"><a href="tech.html#cb209-14"></a><span class="co">##  8 32377.  13.8</span></span>
<span id="cb209-15"><a href="tech.html#cb209-15"></a><span class="co">##  9 27405.  13.2</span></span>
<span id="cb209-16"><a href="tech.html#cb209-16"></a><span class="co">## 10 44187   13.6</span></span>
<span id="cb209-17"><a href="tech.html#cb209-17"></a><span class="kw">select_</span>(df, salary, birth) <span class="co"># ошибка: функция пыьтается оценить несуществующие объекты salary и birth</span></span>
<span id="cb209-18"><a href="tech.html#cb209-18"></a><span class="co">## Error in compat_lazy_dots(.dots, caller_env(), ...): объект &#39;salary&#39; не найден</span></span></code></pre></div>
<p>Однако кавычки в данном случае усложняют внешний вид программы и затрудняют написание ее текста. Если вы передаете <em>константы</em> в качестве аргументов, они будут работать в обоих случаях:</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="tech.html#cb210-1"></a><span class="kw">select</span>(df, <span class="st">&#39;salary&#39;</span>, <span class="st">&#39;birth&#39;</span>)</span>
<span id="cb210-2"><a href="tech.html#cb210-2"></a><span class="co">## # A tibble: 10 x 2</span></span>
<span id="cb210-3"><a href="tech.html#cb210-3"></a><span class="co">##    salary birth</span></span>
<span id="cb210-4"><a href="tech.html#cb210-4"></a><span class="co">##     &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb210-5"><a href="tech.html#cb210-5"></a><span class="co">##  1 36268.  13  </span></span>
<span id="cb210-6"><a href="tech.html#cb210-6"></a><span class="co">##  2 39790   14.5</span></span>
<span id="cb210-7"><a href="tech.html#cb210-7"></a><span class="co">##  3 40303.  11.8</span></span>
<span id="cb210-8"><a href="tech.html#cb210-8"></a><span class="co">##  4 69884.  18.1</span></span>
<span id="cb210-9"><a href="tech.html#cb210-9"></a><span class="co">##  5 31483   16.2</span></span>
<span id="cb210-10"><a href="tech.html#cb210-10"></a><span class="co">##  6 34142   13.3</span></span>
<span id="cb210-11"><a href="tech.html#cb210-11"></a><span class="co">##  7 53240.  12.4</span></span>
<span id="cb210-12"><a href="tech.html#cb210-12"></a><span class="co">##  8 32377.  13.8</span></span>
<span id="cb210-13"><a href="tech.html#cb210-13"></a><span class="co">##  9 27405.  13.2</span></span>
<span id="cb210-14"><a href="tech.html#cb210-14"></a><span class="co">## 10 44187   13.6</span></span>
<span id="cb210-15"><a href="tech.html#cb210-15"></a><span class="kw">select_</span>(df, <span class="st">&#39;salary&#39;</span>, <span class="st">&#39;birth&#39;</span>) </span>
<span id="cb210-16"><a href="tech.html#cb210-16"></a><span class="co">## # A tibble: 10 x 2</span></span>
<span id="cb210-17"><a href="tech.html#cb210-17"></a><span class="co">##    salary birth</span></span>
<span id="cb210-18"><a href="tech.html#cb210-18"></a><span class="co">##     &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb210-19"><a href="tech.html#cb210-19"></a><span class="co">##  1 36268.  13  </span></span>
<span id="cb210-20"><a href="tech.html#cb210-20"></a><span class="co">##  2 39790   14.5</span></span>
<span id="cb210-21"><a href="tech.html#cb210-21"></a><span class="co">##  3 40303.  11.8</span></span>
<span id="cb210-22"><a href="tech.html#cb210-22"></a><span class="co">##  4 69884.  18.1</span></span>
<span id="cb210-23"><a href="tech.html#cb210-23"></a><span class="co">##  5 31483   16.2</span></span>
<span id="cb210-24"><a href="tech.html#cb210-24"></a><span class="co">##  6 34142   13.3</span></span>
<span id="cb210-25"><a href="tech.html#cb210-25"></a><span class="co">##  7 53240.  12.4</span></span>
<span id="cb210-26"><a href="tech.html#cb210-26"></a><span class="co">##  8 32377.  13.8</span></span>
<span id="cb210-27"><a href="tech.html#cb210-27"></a><span class="co">##  9 27405.  13.2</span></span>
<span id="cb210-28"><a href="tech.html#cb210-28"></a><span class="co">## 10 44187   13.6</span></span></code></pre></div>
<blockquote>
<p>Функции <em>dplyr</em> имеют парные к ним функции с символом подчеркивания на конце, которые производят оценку, а не квотацию аргументов.</p>
</blockquote>
<p>Иногда выражения бывает необходимо создать, а оценивать уже потом. Для этого существуеют <strong>объекты выражений</strong>, которые создаются с помощью функции <code>expression()</code>:</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="tech.html#cb211-1"></a>(<span class="dt">d =</span> <span class="kw">expression</span>(b<span class="op">^</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span><span class="dv">4</span><span class="op">*</span>a)) <span class="co"># создаем выражение</span></span>
<span id="cb211-2"><a href="tech.html#cb211-2"></a><span class="co">## expression(b^2 - 4 * a)</span></span>
<span id="cb211-3"><a href="tech.html#cb211-3"></a>a =<span class="st"> </span><span class="dv">2</span></span>
<span id="cb211-4"><a href="tech.html#cb211-4"></a>b =<span class="st"> </span><span class="dv">7</span></span>
<span id="cb211-5"><a href="tech.html#cb211-5"></a><span class="kw">eval</span>(d) <span class="co"># оцениваем значение выражения</span></span>
<span id="cb211-6"><a href="tech.html#cb211-6"></a><span class="co">## [1] 41</span></span></code></pre></div>
<p>Все символы в объекте выражения по умолчанию <em>квотируются</em> и выражение хранится в статичном виде до тех пор пока не будет произведена его оценка (подстановка значений переменных вместо их символов).</p>
<blockquote>
<p>Выражения используются в <em>формулах</em>, используемых для статистического анализа в R</p>
</blockquote>
</div>
<div id="tech_review" class="section level2">
<h2><span class="header-section-number">4.3</span> Краткий обзор</h2>
</div>
<div id="tech_questions" class="section level2">
<h2><span class="header-section-number">4.4</span> Контрольные вопросы и упражнения</h2>
<div id="tech_questions_questions" class="section level3">
<h3><span class="header-section-number">4.4.1</span> Вопросы</h3>
<ol style="list-style-type: decimal">
<li>Что такое функция?</li>
<li>Какое ключевое слово ипользуется для создания функции?</li>
<li>В каких случаях целесообразно применение функций?</li>
<li>Сколько аргументов может принимать функция?</li>
<li>Можно ли из одной функции вызывать другую функцию?</li>
<li>Как осуществить принудительный выход из функции с возвратом результата?</li>
<li>Что необходимо сделать, если надо передать несколько объектов из функции?</li>
<li>Для чего нужны функционалы семейства <em>apply</em>? В каких задачах они бывают полезны?</li>
<li>Перечислите функции семейства <em>apply</em>, назовите их отличия и сферы применения.</li>
<li>Какая функция семейства <em>apply</em> позволяет обабатывать заданные измерения?</li>
<li>Какой объект первым передается в функцию, подставляемую в параметр <code>FUN</code>, если применяется <em>lapply</em> к фрейму данных?</li>
<li>Назовите аналоги функций <em>apply</em> из пакета <strong>purrr</strong></li>
<li>Что такое метапрограммирование?</li>
<li>Из каких объектов состоят выражения в R?</li>
<li>Что из себя по на самом деле представляют бинарные операторы в R?</li>
<li>Как обратиться к объекту, символ которого не является допустимым именем переменной?</li>
<li>Что такое оценка и квотация выражения? Для чего они используются?</li>
<li>Как понять, будет ли используемая вами функция квотрировать или оценивать ее аргументы?</li>
<li>Как называются функции <strong>dplyr</strong>, осуществляющие оценку, а не квотацию аргументов?</li>
<li>Как создать и оценить объект выражения в R?</li>
</ol>
</div>
<div id="tech_questions_tasks" class="section level3">
<h3><span class="header-section-number">4.4.2</span> Упражнения</h3>
<ol style="list-style-type: decimal">
<li><p>Напишите функцию <code>is_leap(year)</code>, которая определяет, является ли указанный год високосным. Протестируйте ее в вашем скрипте, используя чтение года из консолии</p>
<blockquote>
<p><strong>Подсказка</strong>: високосным считается год, кратный 400, либо кратный 4, но не кратный 100.</p>
</blockquote></li>
<li><p><a href="https://en.wikipedia.org/wiki/Tobler%27s_hiking_function"><strong>Функция Тоблера</strong></a> показывает зависимость скорости пешего маршрута (в км/ч) от угла наклона на местности. Предположим, в вашем распоряжении имеется матрица профиля рельефа, в которой в одном столбце указано расстояние от начала маршрута, а во втором — абсолютная отметка точки. Напишите функцию <code>hiking_time(profile)</code>, которая вычисляет время прохождения маршрута на основе переданной ей матрицы. Используйте для тестирования функции маршрут из 10 точек с шагом в 1 км и случайным разбросом высот в диапазоне от 500 до 1000 метров (равномерное распределение).</p>
<blockquote>
<p><strong>Подсказка:</strong> угол наклона на каждом участке считается постоянным. Для вычисления экспоненты используйте встроенную функцию <code>exp()</code>.</p>
</blockquote></li>
<li><p>Создайте на основе данных по Москве с сайта <a href="http://www.pogodaiklimat.ru/climate/27612.htm">pogodaiklimat</a> таблицу <em>Excel</em> с повторяемостью различных направлений ветра. Не преобразовывая структуру данных, вычислите на ее основе с помощью <code>lapply()</code> преобладающее направление для каждого месяца. Представьте результат как фрейм данных.</p></li>
<li><p>В текущей лекции мы работали с <a href="https://github.com/tsamsonov/r-geo-course/blob/master/data/sevzap.xlsx"><strong>данными</strong></a> по характеристикам центров субъектов СЗФО. Напишите функцию <code>get_extremes(df)</code>, которая определяет названия переменных, по которым каждая строчка фрейма данных (в нашем случае — город) занимает максимальное и минимальное положение относительно среднего значения по всем городам. Например, Петрозаводск имеет максимальный рейтинг по показателю <em>doctors</em> (1.05) — количество врачей на 10000 чел и минимальный по показателю <em>manufact</em> (0.05) — продукции обрабатывающей промышленность (в млн руб). Результирующая таблица должна содержать первое по счету поле, а также поля <em>minvar</em> и <em>maxvar</em>:</p>
<pre><code>Region        minvar    maxvar
Петрозаводск doctors  manufact
...
...</code></pre>
<blockquote>
<p><strong>Подсказка:</strong> для начала вам надо нормировать значения всех переменных с помощью <code>lapply()</code>. Затем нужно определить номер столбца, имеющего максимальное и минимальное значений для каждой строки таблицы. Используйте для этого функции <code>which.min()</code> и <code>which.max()</code> возвращающие индекс максимального и минимального элемента вектора, в комбинации с функцией <code>colnames()</code>, возвращающей названия переменных. Применяйте функцию <code>apply()</code>, которая умеет ходить по строкам.</p>
</blockquote></li>
</ol>
<table>
<tbody>
<tr class="odd">
<td><em>Самсонов Т.Е.</em> <strong>Визуализация и анализ географических данных на языке R.</strong> М.: Географический факультет МГУ, <code>lubridate::year(Sys.Date())</code>. DOI: <a href="https://doi.org/10.5281/zenodo.901911">10.5281/zenodo.901911</a></td>
</tr>
</tbody>
</table>

</div>
</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="tables.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="graphics.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"edit": "https://github.com/tsamsonov/r-geo-course/edit/master/%s"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
