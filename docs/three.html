<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Глава 12 Трехмерные модели | Визуализация и анализ географических данных на языке R</title>
<meta name="author" content="Тимофей Самсонов">
<meta name="description" content="12.1 Предварительные условия Для выполнения кода данной лекции вам понадобятся следующие пакеты: library(sf) library(stars) library(dplyr) library(rayshader)  12.2 Введение Трехмерные модели...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Глава 12 Трехмерные модели | Визуализация и анализ географических данных на языке R">
<meta property="og:type" content="book">
<meta property="og:description" content="12.1 Предварительные условия Для выполнения кода данной лекции вам понадобятся следующие пакеты: library(sf) library(stars) library(dplyr) library(rayshader)  12.2 Введение Трехмерные модели...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Глава 12 Трехмерные модели | Визуализация и анализ географических данных на языке R">
<meta name="twitter:site" content="@timofeysamsonov">
<meta name="twitter:description" content="12.1 Предварительные условия Для выполнения кода данной лекции вам понадобятся следующие пакеты: library(sf) library(stars) library(dplyr) library(rayshader)  12.2 Введение Трехмерные модели...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.19/datatables.js"></script><link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script><script src="libs/plotly-binding-4.10.0/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="default">
<link rel="stylesheet" href="custom.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Визуализация и анализ географических данных на языке R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled"><li><a class="" href="index.html"><span class="header-section-number">Глава 12</span> Трехмерные модели</a></li></ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/tsamsonov/r-geo-course">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="three" class="section level1" number="12">
<h1>
<span class="header-section-number">Глава 12</span> Трехмерные модели<a class="anchor" aria-label="anchor" href="#three"><i class="fas fa-link"></i></a>
</h1>
<div id="mapping3d_prerequisites" class="section level2" number="12.1">
<h2>
<span class="header-section-number">12.1</span> Предварительные условия<a class="anchor" aria-label="anchor" href="#mapping3d_prerequisites"><i class="fas fa-link"></i></a>
</h2>
<p>Для выполнения кода данной лекции вам понадобятся следующие пакеты:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/stars/">stars</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.rayshader.com">rayshader</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="three_intro" class="section level2" number="12.2">
<h2>
<span class="header-section-number">12.2</span> Введение<a class="anchor" aria-label="anchor" href="#three_intro"><i class="fas fa-link"></i></a>
</h2>
<p>Трехмерные модели местности могут использоваться в тех случаях, когда стандартное картографическое изображение недостаточно наглядно. Поскольку и построение трехмерных моделей и взаимодействие с ними сложнее, чем с обычными картами, они распространены не столь повсеместно.</p>
</div>
<div id="three_labels" class="section level2" number="12.3">
<h2>
<span class="header-section-number">12.3</span> Создание трёхмерной сцены<a class="anchor" aria-label="anchor" href="#three_labels"><i class="fas fa-link"></i></a>
</h2>
<div id="three_lighting" class="section level3" number="12.3.1">
<h3>
<span class="header-section-number">12.3.1</span> Освещение цифровой модели рельефа<a class="anchor" aria-label="anchor" href="#three_lighting"><i class="fas fa-link"></i></a>
</h3>
<p>Построение трехмерной модели обычно начинается с создания изображения рельефа. В качестве примера рассмотрим ЦМР на территорию в окрестностях Хибин и Ловозёрских тундр в Мурманской области. Чтобы построить изображение рельефа, для начана надо получить матрицу со значениями цвета RGB, а затем вывести ее на экран посредством <code><a href="https://www.rayshader.com/reference/plot_map.html">plot_map()</a></code>. Градиентная окраска по высоте получается функцией <code><a href="https://www.rayshader.com/reference/height_shade.html">height_shade()</a></code>, аналитическая отмывка — через <code><a href="https://www.rayshader.com/reference/sphere_shade.html">sphere_shade()</a></code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dem</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/stars/reference/read_stars.html">read_stars</a></span><span class="op">(</span><span class="st">'data/dem_khibiny.tif'</span><span class="op">)</span>

<span class="va">elev</span> <span class="op">=</span> <span class="va">dem</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>

<span class="co"># ВАЖНО: в текущей версии rayshader оси матрицы не должны иметь названий </span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">elev</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unname.html">unname</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">elev</span><span class="op">)</span><span class="op">)</span> 

<span class="va">elev</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/height_shade.html">height_shade</a></span><span class="op">(</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/plot_map.html">plot_map</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="12-3DModels_files/figure-html/unnamed-chunk-2-1.png" width="100%"></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">elev</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/sphere_shade.html">sphere_shade</a></span><span class="op">(</span>zscale <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/plot_map.html">plot_map</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="12-3DModels_files/figure-html/unnamed-chunk-2-2.png" width="100%"></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">dem_colors</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"darkolivegreen"</span>, <span class="st">"lightyellow"</span>, <span class="st">"orange"</span>, <span class="st">"firebrick"</span>, <span class="st">"white"</span><span class="op">)</span><span class="op">)</span>

<span class="va">elev</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/height_shade.html">height_shade</a></span><span class="op">(</span>texture <span class="op">=</span> <span class="fu">dem_colors</span><span class="op">(</span><span class="fl">256</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/add_overlay.html">add_overlay</a></span><span class="op">(</span><span class="fu"><a href="https://www.rayshader.com/reference/sphere_shade.html">sphere_shade</a></span><span class="op">(</span><span class="va">elev</span>, texture <span class="op">=</span> <span class="st">'bw'</span>, zscale<span class="op">=</span><span class="fl">10</span><span class="op">)</span>, alphalayer<span class="op">=</span><span class="fl">0.7</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/plot_map.html">plot_map</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="12-3DModels_files/figure-html/unnamed-chunk-2-3.png" width="100%"></div>
<p>Функция <code><a href="https://www.rayshader.com/reference/sphere_shade.html">sphere_shade()</a></code> имеет несколько встроенных палитр, которые позволяют раскрашивать поверхность в зависимости от восвещенности точки поверхности. В частности, она содержит стандартную черно-белую палитру, и четыре отмывки в швейцарском стиле Эдуарда Имгофа. Каждая палитра имеет, по сути, три цвета: фона, света и тени:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">palettes</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'bw'</span>, <span class="st">'desert'</span>, <span class="st">'imhof1'</span>,<span class="st">'imhof2'</span>,<span class="st">'imhof3'</span>,<span class="st">'imhof4'</span>, <span class="st">'unicorn'</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">pal</span> <span class="kw">in</span> <span class="va">palettes</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">elev</span> |&gt; 
    <span class="fu"><a href="https://www.rayshader.com/reference/sphere_shade.html">sphere_shade</a></span><span class="op">(</span>texture <span class="op">=</span> <span class="va">pal</span>, zscale<span class="op">=</span><span class="fl">10</span><span class="op">)</span> |&gt; 
    <span class="fu"><a href="https://www.rayshader.com/reference/plot_map.html">plot_map</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p><img src="12-3DModels_files/figure-html/unnamed-chunk-3-1.png" width="100%"><img src="12-3DModels_files/figure-html/unnamed-chunk-3-2.png" width="100%"><img src="12-3DModels_files/figure-html/unnamed-chunk-3-3.png" width="100%"><img src="12-3DModels_files/figure-html/unnamed-chunk-3-4.png" width="100%"><img src="12-3DModels_files/figure-html/unnamed-chunk-3-5.png" width="100%"><img src="12-3DModels_files/figure-html/unnamed-chunk-3-6.png" width="100%"><img src="12-3DModels_files/figure-html/unnamed-chunk-3-7.png" width="100%"></p>
<p>Добавим принудительно посчитанные тени:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">elev</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/height_shade.html">height_shade</a></span><span class="op">(</span>texture <span class="op">=</span> <span class="fu">dem_colors</span><span class="op">(</span><span class="fl">256</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/add_overlay.html">add_overlay</a></span><span class="op">(</span><span class="fu"><a href="https://www.rayshader.com/reference/sphere_shade.html">sphere_shade</a></span><span class="op">(</span><span class="va">elev</span>, texture <span class="op">=</span> <span class="st">'bw'</span>, zscale<span class="op">=</span><span class="fl">10</span><span class="op">)</span>, alphalayer<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/add_shadow.html">add_shadow</a></span><span class="op">(</span><span class="fu"><a href="https://www.rayshader.com/reference/lamb_shade.html">lamb_shade</a></span><span class="op">(</span><span class="va">elev</span>, zscale <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>, <span class="fl">0.1</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/plot_map.html">plot_map</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="12-3DModels_files/figure-html/unnamed-chunk-4-1.png" width="100%"></div>
<p>Амбиентное овещение позволяет отделить долины от вершин хребтов:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">elev</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/height_shade.html">height_shade</a></span><span class="op">(</span>texture <span class="op">=</span> <span class="fu">dem_colors</span><span class="op">(</span><span class="fl">256</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/add_overlay.html">add_overlay</a></span><span class="op">(</span><span class="fu"><a href="https://www.rayshader.com/reference/sphere_shade.html">sphere_shade</a></span><span class="op">(</span><span class="va">elev</span>, texture <span class="op">=</span> <span class="st">'bw'</span>, zscale<span class="op">=</span><span class="fl">10</span><span class="op">)</span>, alphalayer<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/add_shadow.html">add_shadow</a></span><span class="op">(</span><span class="fu"><a href="https://www.rayshader.com/reference/lamb_shade.html">lamb_shade</a></span><span class="op">(</span><span class="va">elev</span>, zscale <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>, <span class="fl">0.1</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/add_shadow.html">add_shadow</a></span><span class="op">(</span><span class="fu"><a href="https://www.rayshader.com/reference/ambient_shade.html">ambient_shade</a></span><span class="op">(</span><span class="va">elev</span><span class="op">)</span>, <span class="fl">0.1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://www.rayshader.com/reference/plot_map.html">plot_map</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="12-3DModels_files/figure-html/unnamed-chunk-5-1.png" width="100%"></div>
<p>Для построение трехмерной сцены вместо <code><a href="https://www.rayshader.com/reference/plot_map.html">plot_map()</a></code> необходимо использовать <code><a href="https://www.rayshader.com/reference/plot_3d.html">plot_3d()</a></code>. При этом будет открыто интерактивное окно OpenGL, в котором вы сможете вращать созданную сцену:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">elev</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/height_shade.html">height_shade</a></span><span class="op">(</span>texture <span class="op">=</span> <span class="fu">dem_colors</span><span class="op">(</span><span class="fl">256</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/add_overlay.html">add_overlay</a></span><span class="op">(</span><span class="fu"><a href="https://www.rayshader.com/reference/sphere_shade.html">sphere_shade</a></span><span class="op">(</span><span class="va">elev</span>, texture <span class="op">=</span> <span class="st">'bw'</span>, zscale<span class="op">=</span><span class="fl">10</span><span class="op">)</span>, alphalayer<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/add_shadow.html">add_shadow</a></span><span class="op">(</span><span class="fu"><a href="https://www.rayshader.com/reference/lamb_shade.html">lamb_shade</a></span><span class="op">(</span><span class="va">elev</span>, zscale <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>, <span class="fl">0.1</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/add_shadow.html">add_shadow</a></span><span class="op">(</span><span class="fu"><a href="https://www.rayshader.com/reference/ambient_shade.html">ambient_shade</a></span><span class="op">(</span><span class="va">elev</span><span class="op">)</span>, <span class="fl">0.1</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/plot_3d.html">plot_3d</a></span><span class="op">(</span><span class="va">elev</span>, zscale <span class="op">=</span> <span class="fl">20</span>, fov <span class="op">=</span> <span class="fl">0</span>,
          theta <span class="op">=</span> <span class="fl">135</span>, zoom <span class="op">=</span> <span class="fl">0.75</span>, phi <span class="op">=</span> <span class="fl">45</span>, 
          windowsize <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1400</span>, <span class="fl">800</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span>
<span class="fu"><a href="https://www.rayshader.com/reference/render_snapshot.html">render_snapshot</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="12-3DModels_files/figure-html/unnamed-chunk-6-1.png" width="100%"></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">rgl</span><span class="fu">::</span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/rgl.open.html">rgl.close</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div id="three_add" class="section level3" number="12.3.2">
<h3>
<span class="header-section-number">12.3.2</span> Векторные слои<a class="anchor" aria-label="anchor" href="#three_add"><i class="fas fa-link"></i></a>
</h3>
<p>Прочтем векторные данные:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">db</span> <span class="op">=</span> <span class="st">'data/khibiny.gpkg'</span>
<span class="va">rivers</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="va">db</span>, <span class="st">'rivers'</span>, quiet <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="va">lakes</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="va">db</span>, <span class="st">'lakes'</span>, quiet <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">CLASS_ID</span> <span class="op">!=</span> <span class="fl">31300000</span><span class="op">)</span>

<span class="va">roads_all</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="va">db</span>, <span class="st">'roads'</span>, quiet <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="va">roads</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">roads_all</span>, <span class="va">CLASS_ID</span> <span class="op">&lt;=</span> <span class="fl">62131000</span><span class="op">)</span>

<span class="va">rails</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="va">db</span>, <span class="st">'rails'</span>, quiet <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="va">forest</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="va">db</span>, <span class="st">'veg'</span>, quiet <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="va">blocks</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="va">db</span>, <span class="st">'blocks'</span>, quiet <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="va">poppol</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="va">db</span>, <span class="st">'poppol'</span>, quiet <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<p>Добавим их через оверлей объектов:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ext</span> <span class="op">=</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html">extent</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox</a></span><span class="op">(</span><span class="va">dem</span><span class="op">)</span><span class="op">)</span>
<span class="va">elev</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/height_shade.html">height_shade</a></span><span class="op">(</span>texture <span class="op">=</span> <span class="fu">dem_colors</span><span class="op">(</span><span class="fl">256</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/add_overlay.html">add_overlay</a></span><span class="op">(</span><span class="fu"><a href="https://www.rayshader.com/reference/sphere_shade.html">sphere_shade</a></span><span class="op">(</span><span class="va">elev</span>, texture <span class="op">=</span> <span class="st">'bw'</span>, zscale<span class="op">=</span><span class="fl">10</span><span class="op">)</span>, alphalayer<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/add_shadow.html">add_shadow</a></span><span class="op">(</span><span class="fu"><a href="https://www.rayshader.com/reference/lamb_shade.html">lamb_shade</a></span><span class="op">(</span><span class="va">elev</span>, zscale <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>, <span class="fl">0.1</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/add_overlay.html">add_overlay</a></span><span class="op">(</span><span class="fu"><a href="https://www.rayshader.com/reference/generate_line_overlay.html">generate_line_overlay</a></span><span class="op">(</span><span class="va">rivers</span>, linewidth <span class="op">=</span> <span class="fl">2</span>, color<span class="op">=</span><span class="st">"steelblue4"</span>,
                                    extent <span class="op">=</span> <span class="va">ext</span>,
                                    heightmap <span class="op">=</span> <span class="va">elev</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/add_overlay.html">add_overlay</a></span><span class="op">(</span><span class="fu"><a href="https://www.rayshader.com/reference/generate_polygon_overlay.html">generate_polygon_overlay</a></span><span class="op">(</span><span class="va">lakes</span>, linewidth <span class="op">=</span> <span class="fl">1</span>, 
                                       palette <span class="op">=</span> <span class="st">'azure'</span>,
                                       linecolor <span class="op">=</span> <span class="st">'steelblue4'</span>,
                                       extent <span class="op">=</span> <span class="va">ext</span>,
                                       heightmap <span class="op">=</span> <span class="va">elev</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/plot_map.html">plot_map</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="12-3DModels_files/figure-html/unnamed-chunk-8-1.png" width="100%"></div>
<p>Визуализируем в 3D:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">elev</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/height_shade.html">height_shade</a></span><span class="op">(</span>texture <span class="op">=</span> <span class="fu">dem_colors</span><span class="op">(</span><span class="fl">256</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/add_overlay.html">add_overlay</a></span><span class="op">(</span><span class="fu"><a href="https://www.rayshader.com/reference/sphere_shade.html">sphere_shade</a></span><span class="op">(</span><span class="va">elev</span>, texture <span class="op">=</span> <span class="st">'bw'</span>, zscale<span class="op">=</span><span class="fl">10</span><span class="op">)</span>, alphalayer<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/add_shadow.html">add_shadow</a></span><span class="op">(</span><span class="fu"><a href="https://www.rayshader.com/reference/lamb_shade.html">lamb_shade</a></span><span class="op">(</span><span class="va">elev</span>, zscale <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>, <span class="fl">0.1</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/add_overlay.html">add_overlay</a></span><span class="op">(</span><span class="fu"><a href="https://www.rayshader.com/reference/generate_line_overlay.html">generate_line_overlay</a></span><span class="op">(</span><span class="va">rivers</span>, linewidth <span class="op">=</span> <span class="fl">2</span>, color<span class="op">=</span><span class="st">"steelblue4"</span>,
                                    extent <span class="op">=</span> <span class="va">ext</span>,
                                    heightmap <span class="op">=</span> <span class="va">elev</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/add_overlay.html">add_overlay</a></span><span class="op">(</span><span class="fu"><a href="https://www.rayshader.com/reference/generate_polygon_overlay.html">generate_polygon_overlay</a></span><span class="op">(</span><span class="va">lakes</span>, linewidth <span class="op">=</span> <span class="fl">1</span>, 
                                       palette <span class="op">=</span> <span class="st">'azure'</span>,
                                       linecolor <span class="op">=</span> <span class="st">'steelblue4'</span>,
                                       extent <span class="op">=</span> <span class="va">ext</span>,
                                       heightmap <span class="op">=</span> <span class="va">elev</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/plot_3d.html">plot_3d</a></span><span class="op">(</span><span class="va">elev</span>, zscale <span class="op">=</span> <span class="fl">20</span>, fov <span class="op">=</span> <span class="fl">0</span>,
          theta <span class="op">=</span> <span class="fl">135</span>, zoom <span class="op">=</span> <span class="fl">0.75</span>, phi <span class="op">=</span> <span class="fl">45</span>, 
          windowsize <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1400</span>, <span class="fl">800</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span>
<span class="fu"><a href="https://www.rayshader.com/reference/render_snapshot.html">render_snapshot</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="12-3DModels_files/figure-html/unnamed-chunk-9-1.png" width="100%"></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">rgl</span><span class="fu">::</span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/rgl.open.html">rgl.close</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Чтобы приблизить изображение, повернуть, изменить угол наклона и т.д., используйте параметры функции <code><a href="https://www.rayshader.com/reference/plot_3d.html">plot_3d()</a></code>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">elev</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/height_shade.html">height_shade</a></span><span class="op">(</span>texture <span class="op">=</span> <span class="fu">dem_colors</span><span class="op">(</span><span class="fl">256</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/add_overlay.html">add_overlay</a></span><span class="op">(</span><span class="fu"><a href="https://www.rayshader.com/reference/sphere_shade.html">sphere_shade</a></span><span class="op">(</span><span class="va">elev</span>, texture <span class="op">=</span> <span class="st">'bw'</span>, zscale<span class="op">=</span><span class="fl">10</span><span class="op">)</span>, alphalayer<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/add_shadow.html">add_shadow</a></span><span class="op">(</span><span class="fu"><a href="https://www.rayshader.com/reference/lamb_shade.html">lamb_shade</a></span><span class="op">(</span><span class="va">elev</span>, zscale <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>, <span class="fl">0.1</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/add_overlay.html">add_overlay</a></span><span class="op">(</span><span class="fu"><a href="https://www.rayshader.com/reference/generate_line_overlay.html">generate_line_overlay</a></span><span class="op">(</span><span class="va">rivers</span>, linewidth <span class="op">=</span> <span class="fl">2</span>, color<span class="op">=</span><span class="st">"steelblue4"</span>,
                                    extent <span class="op">=</span> <span class="va">ext</span>,
                                    heightmap <span class="op">=</span> <span class="va">elev</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/add_overlay.html">add_overlay</a></span><span class="op">(</span><span class="fu"><a href="https://www.rayshader.com/reference/generate_polygon_overlay.html">generate_polygon_overlay</a></span><span class="op">(</span><span class="va">lakes</span>, linewidth <span class="op">=</span> <span class="fl">1</span>, 
                                       palette <span class="op">=</span> <span class="st">'azure'</span>,
                                       linecolor <span class="op">=</span> <span class="st">'steelblue4'</span>,
                                       extent <span class="op">=</span> <span class="va">ext</span>,
                                       heightmap <span class="op">=</span> <span class="va">elev</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/plot_3d.html">plot_3d</a></span><span class="op">(</span><span class="va">elev</span>, zscale <span class="op">=</span> <span class="fl">50</span>, fov <span class="op">=</span> <span class="fl">0</span>,
          theta <span class="op">=</span> <span class="fl">80</span>, zoom <span class="op">=</span> <span class="fl">0.25</span>, phi <span class="op">=</span> <span class="fl">35</span>, 
          windowsize <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1400</span>, <span class="fl">800</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span>
<span class="fu"><a href="https://www.rayshader.com/reference/render_snapshot.html">render_snapshot</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="12-3DModels_files/figure-html/unnamed-chunk-10-1.png" width="100%"></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">rgl</span><span class="fu">::</span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/rgl.open.html">rgl.close</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Расширим состав визуализируемых объектов:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plt</span> <span class="op">=</span> <span class="va">elev</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/height_shade.html">height_shade</a></span><span class="op">(</span>texture <span class="op">=</span> <span class="fu">dem_colors</span><span class="op">(</span><span class="fl">256</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/add_overlay.html">add_overlay</a></span><span class="op">(</span><span class="fu"><a href="https://www.rayshader.com/reference/sphere_shade.html">sphere_shade</a></span><span class="op">(</span><span class="va">elev</span>, texture <span class="op">=</span> <span class="st">'bw'</span>, zscale<span class="op">=</span><span class="fl">10</span><span class="op">)</span>, alphalayer<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/add_shadow.html">add_shadow</a></span><span class="op">(</span><span class="fu"><a href="https://www.rayshader.com/reference/lamb_shade.html">lamb_shade</a></span><span class="op">(</span><span class="va">elev</span>, zscale <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>, <span class="fl">0.1</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/add_overlay.html">add_overlay</a></span><span class="op">(</span><span class="fu"><a href="https://www.rayshader.com/reference/generate_polygon_overlay.html">generate_polygon_overlay</a></span><span class="op">(</span><span class="va">poppol</span>, linewidth <span class="op">=</span> <span class="fl">1</span>, 
                                     palette <span class="op">=</span> <span class="st">'orange'</span>,
                                     linecolor <span class="op">=</span> <span class="st">'black'</span>,
                                     extent <span class="op">=</span> <span class="va">ext</span>,
                                     heightmap <span class="op">=</span> <span class="va">elev</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/add_overlay.html">add_overlay</a></span><span class="op">(</span><span class="fu"><a href="https://www.rayshader.com/reference/generate_line_overlay.html">generate_line_overlay</a></span><span class="op">(</span><span class="va">rivers</span>, linewidth <span class="op">=</span> <span class="fl">2</span>, color<span class="op">=</span><span class="st">"steelblue4"</span>,
                                    extent <span class="op">=</span> <span class="va">ext</span>,
                                    heightmap <span class="op">=</span> <span class="va">elev</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/add_overlay.html">add_overlay</a></span><span class="op">(</span><span class="fu"><a href="https://www.rayshader.com/reference/generate_polygon_overlay.html">generate_polygon_overlay</a></span><span class="op">(</span><span class="va">lakes</span>, linewidth <span class="op">=</span> <span class="fl">1</span>, 
                                       palette <span class="op">=</span> <span class="st">'azure'</span>,
                                       linecolor <span class="op">=</span> <span class="st">'steelblue4'</span>,
                                       extent <span class="op">=</span> <span class="va">ext</span>,
                                       heightmap <span class="op">=</span> <span class="va">elev</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/add_overlay.html">add_overlay</a></span><span class="op">(</span><span class="fu"><a href="https://www.rayshader.com/reference/generate_line_overlay.html">generate_line_overlay</a></span><span class="op">(</span><span class="va">roads</span>, linewidth <span class="op">=</span> <span class="fl">4</span>, color<span class="op">=</span><span class="st">"black"</span>,
                                    extent <span class="op">=</span> <span class="va">ext</span>,
                                    heightmap <span class="op">=</span> <span class="va">elev</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/add_overlay.html">add_overlay</a></span><span class="op">(</span><span class="fu"><a href="https://www.rayshader.com/reference/generate_line_overlay.html">generate_line_overlay</a></span><span class="op">(</span><span class="va">roads</span>, linewidth <span class="op">=</span> <span class="fl">2</span>, color<span class="op">=</span><span class="st">"lightyellow"</span>,
                                  extent <span class="op">=</span> <span class="va">ext</span>,
                                  heightmap <span class="op">=</span> <span class="va">elev</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/add_overlay.html">add_overlay</a></span><span class="op">(</span><span class="fu"><a href="https://www.rayshader.com/reference/generate_line_overlay.html">generate_line_overlay</a></span><span class="op">(</span><span class="va">rails</span>, linewidth <span class="op">=</span> <span class="fl">3</span>, color<span class="op">=</span><span class="st">"black"</span>,
                                  extent <span class="op">=</span> <span class="va">ext</span>,
                                  heightmap <span class="op">=</span> <span class="va">elev</span><span class="op">)</span><span class="op">)</span> 

<span class="fu"><a href="https://www.rayshader.com/reference/plot_map.html">plot_map</a></span><span class="op">(</span><span class="va">plt</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="12-3DModels_files/figure-html/unnamed-chunk-11-1.png" width="100%"></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="https://www.rayshader.com/reference/plot_3d.html">plot_3d</a></span><span class="op">(</span><span class="va">plt</span>, <span class="va">elev</span>, zscale <span class="op">=</span> <span class="fl">30</span>, fov <span class="op">=</span> <span class="fl">0</span>,
        theta <span class="op">=</span> <span class="op">-</span><span class="fl">45</span>, zoom <span class="op">=</span> <span class="fl">0.25</span>, phi <span class="op">=</span> <span class="fl">30</span>, 
        windowsize <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1400</span>, <span class="fl">800</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span>
<span class="fu"><a href="https://www.rayshader.com/reference/render_snapshot.html">render_snapshot</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="12-3DModels_files/figure-html/unnamed-chunk-11-2.png" width="100%"></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">rgl</span><span class="fu">::</span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/rgl.open.html">rgl.close</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div id="three_labels" class="section level3" number="12.3.3">
<h3>
<span class="header-section-number">12.3.3</span> Подписи<a class="anchor" aria-label="anchor" href="#three_labels"><i class="fas fa-link"></i></a>
</h3>
<p>Для размещения подписей следует использовать функцию <code><a href="https://www.rayshader.com/reference/generate_label_overlay.html">generate_label_overlay()</a></code>:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">popmajor</span> <span class="op">=</span> <span class="va">poppol</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">CLASS_ID</span> <span class="op">&lt;</span> <span class="fl">41300000</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_centroid</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">popminor</span><span class="op">=</span> <span class="va">poppol</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">CLASS_ID</span> <span class="op">==</span> <span class="fl">41300000</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_centroid</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">plt_lbl</span> <span class="op">=</span> <span class="va">plt</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/add_overlay.html">add_overlay</a></span><span class="op">(</span><span class="fu"><a href="https://www.rayshader.com/reference/generate_point_overlay.html">generate_point_overlay</a></span><span class="op">(</span><span class="va">popmajor</span>, size <span class="op">=</span> <span class="fl">8</span>, extent <span class="op">=</span> <span class="va">ext</span>, color <span class="op">=</span> <span class="st">"black"</span>, pch <span class="op">=</span> <span class="fl">19</span>,
                                     heightmap <span class="op">=</span> <span class="va">elev</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/add_overlay.html">add_overlay</a></span><span class="op">(</span><span class="fu"><a href="https://www.rayshader.com/reference/generate_point_overlay.html">generate_point_overlay</a></span><span class="op">(</span><span class="va">popmajor</span>, size <span class="op">=</span> <span class="fl">3</span>, extent <span class="op">=</span> <span class="va">ext</span>, color <span class="op">=</span> <span class="st">"white"</span>, pch <span class="op">=</span> <span class="fl">19</span>,
                                     heightmap <span class="op">=</span> <span class="va">elev</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://www.rayshader.com/reference/add_overlay.html">add_overlay</a></span><span class="op">(</span><span class="fu"><a href="https://www.rayshader.com/reference/generate_label_overlay.html">generate_label_overlay</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="va">popmajor</span>, 
                                     data_label_column <span class="op">=</span> <span class="st">'NAME'</span>,
                                     extent <span class="op">=</span> <span class="va">ext</span>, text_size <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"black"</span>, font<span class="op">=</span><span class="fl">2</span>,
                                     halo_color <span class="op">=</span> <span class="st">"white"</span>, halo_expand <span class="op">=</span> <span class="fl">2</span>, point_size <span class="op">=</span> <span class="fl">0</span>,
                                     seed<span class="op">=</span><span class="fl">1</span>, heightmap <span class="op">=</span> <span class="va">elev</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://www.rayshader.com/reference/plot_map.html">plot_map</a></span><span class="op">(</span><span class="va">plt_lbl</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="12-3DModels_files/figure-html/unnamed-chunk-12-1.png" width="100%"></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="https://www.rayshader.com/reference/plot_3d.html">plot_3d</a></span><span class="op">(</span><span class="va">plt_lbl</span>, <span class="va">elev</span>, zscale <span class="op">=</span> <span class="fl">30</span>, fov <span class="op">=</span> <span class="fl">0</span>,
        theta <span class="op">=</span> <span class="op">-</span><span class="fl">45</span>, zoom <span class="op">=</span> <span class="fl">0.5</span>, phi <span class="op">=</span> <span class="fl">30</span>, 
        windowsize <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1400</span>, <span class="fl">800</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span>
<span class="fu"><a href="https://www.rayshader.com/reference/render_snapshot.html">render_snapshot</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="12-3DModels_files/figure-html/unnamed-chunk-12-2.png" width="100%"></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">rgl</span><span class="fu">::</span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/rgl.open.html">rgl.close</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Как видно, оверлей подписей выглядит не очень в трехмерноме режиме. В этом случае необходимо эти подписи наносить уже после того как трехмерный режим активирован:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://www.rayshader.com/reference/plot_3d.html">plot_3d</a></span><span class="op">(</span><span class="va">plt</span>, <span class="va">elev</span>, zscale <span class="op">=</span> <span class="fl">30</span>, fov <span class="op">=</span> <span class="fl">0</span>,
        theta <span class="op">=</span> <span class="op">-</span><span class="fl">45</span>, zoom <span class="op">=</span> <span class="fl">0.5</span>, phi <span class="op">=</span> <span class="fl">35</span>, 
        windowsize <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1400</span>, <span class="fl">800</span><span class="op">)</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">name</span> <span class="kw">in</span> <span class="va">popmajor</span><span class="op">$</span><span class="va">NAME</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">pop</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">popmajor</span>, <span class="va">NAME</span> <span class="op">==</span> <span class="va">name</span><span class="op">)</span>
  <span class="fu"><a href="https://www.rayshader.com/reference/render_label.html">render_label</a></span><span class="op">(</span><span class="va">elev</span>, lat <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">pop</span><span class="op">)</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, lon <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">pop</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, 
               text <span class="op">=</span> <span class="va">name</span>, altitude <span class="op">=</span> <span class="fl">1000</span>, zscale<span class="op">=</span><span class="fl">30</span>, textsize <span class="op">=</span> <span class="fl">1.75</span>, linewidth <span class="op">=</span> <span class="fl">4</span>,
               extent <span class="op">=</span> <span class="va">ext</span>, textcolor <span class="op">=</span> <span class="st">"turquoise2"</span>, linecolor<span class="op">=</span><span class="st">"turquoise2"</span>,
               relativez <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span>
<span class="fu"><a href="https://www.rayshader.com/reference/render_snapshot.html">render_snapshot</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="12-3DModels_files/figure-html/unnamed-chunk-13-1.png" width="100%"></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">rgl</span><span class="fu">::</span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/rgl.open.html">rgl.close</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="three_animation" class="section level2" number="12.4">
<h2>
<span class="header-section-number">12.4</span> Анимация трёхмерной сцены<a class="anchor" aria-label="anchor" href="#three_animation"><i class="fas fa-link"></i></a>
</h2>
<p>Анимация с помощью пакета <strong>rayshader</strong> осуществляется покадрово. Для этого необходимо задать последовательность параметров камеры, каждый из которых будет определять кадр видеофильма, и определить эти параметры в функции <code><a href="https://www.rayshader.com/reference/render_movie.html">render_movie()</a></code>.</p>
<div id="three_animation_circle" class="section level3" number="12.4.1">
<h3>
<span class="header-section-number">12.4.1</span> Вращение относительно точки<a class="anchor" aria-label="anchor" href="#three_animation_circle"><i class="fas fa-link"></i></a>
</h3>
<p>Наиболее простой спобособ визуализации сцены — вращение относительно фиксированной точки. В этом случае необходимо менять только угол поворота камеры. По умолчанию <code><a href="https://www.rayshader.com/reference/render_movie.html">render_movie()</a></code> создает 12-секундный ролик с частотой 30 кадров в секунду (т.е. 360 кадров всего). Именно такой результат будет получен, если вызывать ее без параметров:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://www.rayshader.com/reference/plot_3d.html">plot_3d</a></span><span class="op">(</span><span class="va">plt</span>, <span class="va">elev</span>, zscale <span class="op">=</span> <span class="fl">30</span>, fov <span class="op">=</span> <span class="fl">0</span>,
        theta <span class="op">=</span> <span class="op">-</span><span class="fl">45</span>, zoom <span class="op">=</span> <span class="fl">0.5</span>, 
        windowsize <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1400</span>, <span class="fl">800</span><span class="op">)</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">name</span> <span class="kw">in</span> <span class="va">popmajor</span><span class="op">$</span><span class="va">NAME</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">pop</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">popmajor</span>, <span class="va">NAME</span> <span class="op">==</span> <span class="va">name</span><span class="op">)</span>
  <span class="fu"><a href="https://www.rayshader.com/reference/render_label.html">render_label</a></span><span class="op">(</span><span class="va">elev</span>, lat <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">pop</span><span class="op">)</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, lon <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">pop</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, 
               text <span class="op">=</span> <span class="va">name</span>, altitude <span class="op">=</span> <span class="fl">1000</span>, zscale<span class="op">=</span><span class="fl">30</span>, textsize <span class="op">=</span> <span class="fl">1.75</span>, linewidth <span class="op">=</span> <span class="fl">4</span>,
               extent <span class="op">=</span> <span class="va">ext</span>, textcolor <span class="op">=</span> <span class="st">"turquoise2"</span>, linecolor<span class="op">=</span><span class="st">"turquoise2"</span>,
               relativez <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://www.rayshader.com/reference/render_movie.html">render_movie</a></span><span class="op">(</span>filename <span class="op">=</span> <span class="st">'images/khibiny_rotate.gif'</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="images/khibiny_rotate.gif" width="100%"></div>
</div>
<div id="three_animation_path" class="section level3" number="12.4.2">
<h3>
<span class="header-section-number">12.4.2</span> Облёт по траектории<a class="anchor" aria-label="anchor" href="#three_animation_path"><i class="fas fa-link"></i></a>
</h3>
</div>
</div>
<div id="questions_tasks_three" class="section level2" number="12.5">
<h2>
<span class="header-section-number">12.5</span> Контрольные вопросы и упражнения<a class="anchor" aria-label="anchor" href="#questions_tasks_three"><i class="fas fa-link"></i></a>
</h2>
<div id="questions_three" class="section level3" number="12.5.1">
<h3>
<span class="header-section-number">12.5.1</span> Вопросы<a class="anchor" aria-label="anchor" href="#questions_three"><i class="fas fa-link"></i></a>
</h3>
</div>
<div id="tasks_three" class="section level3" number="12.5.2">
<h3>
<span class="header-section-number">12.5.2</span> Упражнения<a class="anchor" aria-label="anchor" href="#tasks_three"><i class="fas fa-link"></i></a>
</h3>
<div class="inline-table"><table class="table table-sm"><tbody><tr class="odd">
<td>
<em>Самсонов Т.Е.</em> <strong>Визуализация и анализ географических данных на языке R.</strong> М.: Географический факультет МГУ, <code>lubridate::year(Sys.Date())</code>. DOI: <a href="https://doi.org/10.5281/zenodo.901911">10.5281/zenodo.901911</a>
</td>
</tr></tbody></table></div>
</div>
</div>
</div>



  <div class="chapter-nav">
<div class="empty"></div>
<div class="empty"></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Визуализация и анализ географических данных на языке R</strong>" was written by Тимофей Самсонов. It was last built on 2021-11-08.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
