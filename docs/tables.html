<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Глава 3 Табличные данные | Визуализация и анализ географических данных на языке R</title>
  <meta name="description" content="Курс лекций, посвященных использованию языка программирования R для визуализации и анализа географических данных" />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="Глава 3 Табличные данные | Визуализация и анализ географических данных на языке R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Курс лекций, посвященных использованию языка программирования R для визуализации и анализа географических данных" />
  <meta name="github-repo" content="tsamsonov/r-geo-course" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Глава 3 Табличные данные | Визуализация и анализ географических данных на языке R" />
  
  <meta name="twitter:description" content="Курс лекций, посвященных использованию языка программирования R для визуализации и анализа географических данных" />
  

<meta name="author" content="Тимофей Самсонов" />


<meta name="date" content="2020-02-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-structures.html"/>
<link rel="next" href="tech.html"/>
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets/htmlwidgets.js"></script>
<link href="libs/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding/datatables.js"></script>
<link href="libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk/js/crosstalk.min.js"></script>
<script src="libs/plotly-binding/plotly.js"></script>
<script src="libs/typedarray/typedarray.min.js"></script>
<link href="libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main/plotly-latest.min.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Визуализация и анализ географических данных на языке R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Введение</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#программное-обеспечение"><i class="fa fa-check"></i>Программное обеспечение</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#установка-и-подключение-пакетов"><i class="fa fa-check"></i>Установка и подключение пакетов</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#выполнение-программного-кода"><i class="fa fa-check"></i>Выполнение программного кода</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#установка-рабочей-директории"><i class="fa fa-check"></i>Установка рабочей директории</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#диагностические-функции"><i class="fa fa-check"></i>Диагностические функции</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#получение-справки"><i class="fa fa-check"></i>Получение справки</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#комментарии"><i class="fa fa-check"></i>Комментарии</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#стандарт-оформления-кода-на-r"><i class="fa fa-check"></i>Стандарт оформления кода на R</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#зарезервированные-слова"><i class="fa fa-check"></i>Зарезервированные слова</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#названия-переменных"><i class="fa fa-check"></i>Названия переменных</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#названия-специальных-символов"><i class="fa fa-check"></i>Названия специальных символов</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#ссылка-на-пособие"><i class="fa fa-check"></i>Ссылка на пособие</a></li>
</ul></li>
<li class="part"><span><b>I Основы языка R</b></span></li>
<li class="chapter" data-level="1" data-path="data-types.html"><a href="data-types.html"><i class="fa fa-check"></i><b>1</b> Типы данных, условия, ввод и вывод</a><ul>
<li class="chapter" data-level="1.1" data-path="data-types.html"><a href="data-types.html#data_types"><i class="fa fa-check"></i><b>1.1</b> Типы данных</a><ul>
<li class="chapter" data-level="1.1.1" data-path="data-types.html"><a href="data-types.html#numbers"><i class="fa fa-check"></i><b>1.1.1</b> Числа</a></li>
<li class="chapter" data-level="1.1.2" data-path="data-types.html"><a href="data-types.html#strings"><i class="fa fa-check"></i><b>1.1.2</b> Строки</a></li>
<li class="chapter" data-level="1.1.3" data-path="data-types.html"><a href="data-types.html#dates"><i class="fa fa-check"></i><b>1.1.3</b> Даты</a></li>
<li class="chapter" data-level="1.1.4" data-path="data-types.html"><a href="data-types.html#booleans"><i class="fa fa-check"></i><b>1.1.4</b> Логические</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="data-types.html"><a href="data-types.html#manipulations"><i class="fa fa-check"></i><b>1.2</b> Манипуляции с типами</a><ul>
<li class="chapter" data-level="1.2.1" data-path="data-types.html"><a href="data-types.html#determine_data_type"><i class="fa fa-check"></i><b>1.2.1</b> Определение типа данных</a></li>
<li class="chapter" data-level="1.2.2" data-path="data-types.html"><a href="data-types.html#conversion"><i class="fa fa-check"></i><b>1.2.2</b> Преобразование типов данных</a></li>
<li class="chapter" data-level="1.2.3" data-path="data-types.html"><a href="data-types.html#check_types"><i class="fa fa-check"></i><b>1.2.3</b> Проверка типов данных и пустых значений</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="data-types.html"><a href="data-types.html#read_write_console"><i class="fa fa-check"></i><b>1.3</b> Ввод и вывод данных в консоли</a><ul>
<li class="chapter" data-level="1.3.1" data-path="data-types.html"><a href="data-types.html#read_console"><i class="fa fa-check"></i><b>1.3.1</b> Ввод данных</a></li>
<li class="chapter" data-level="1.3.2" data-path="data-types.html"><a href="data-types.html#write_console"><i class="fa fa-check"></i><b>1.3.2</b> Вывод данных</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="data-types.html"><a href="data-types.html#ifelse"><i class="fa fa-check"></i><b>1.4</b> Условный оператор</a></li>
<li class="chapter" data-level="1.5" data-path="data-types.html"><a href="data-types.html#switch"><i class="fa fa-check"></i><b>1.5</b> Оператор переключения</a></li>
<li class="chapter" data-level="1.6" data-path="data-types.html"><a href="data-types.html#stop"><i class="fa fa-check"></i><b>1.6</b> Прерывание программы</a></li>
<li class="chapter" data-level="1.7" data-path="data-types.html"><a href="data-types.html#basics-detail"><i class="fa fa-check"></i><b>1.7</b> Технические детали</a></li>
<li class="chapter" data-level="1.8" data-path="data-types.html"><a href="data-types.html#review"><i class="fa fa-check"></i><b>1.8</b> Краткий обзор</a></li>
<li class="chapter" data-level="1.9" data-path="data-types.html"><a href="data-types.html#questions_tasks_basics"><i class="fa fa-check"></i><b>1.9</b> Контрольные вопросы и упражнения</a><ul>
<li class="chapter" data-level="1.9.1" data-path="data-types.html"><a href="data-types.html#questions_basics"><i class="fa fa-check"></i><b>1.9.1</b> Вопросы</a></li>
<li class="chapter" data-level="1.9.2" data-path="data-types.html"><a href="data-types.html#tasks_basic"><i class="fa fa-check"></i><b>1.9.2</b> Упражнения</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-structures.html"><a href="data-structures.html"><i class="fa fa-check"></i><b>2</b> Структуры данных и циклы</a><ul>
<li class="chapter" data-level="2.1" data-path="data-structures.html"><a href="data-structures.html#data_structures_homo"><i class="fa fa-check"></i><b>2.1</b> Однородные структуры данных</a><ul>
<li class="chapter" data-level="2.1.1" data-path="data-structures.html"><a href="data-structures.html#vectors"><i class="fa fa-check"></i><b>2.1.1</b> Векторы</a></li>
<li class="chapter" data-level="2.1.2" data-path="data-structures.html"><a href="data-structures.html#matrices"><i class="fa fa-check"></i><b>2.1.2</b> Матрицы</a></li>
<li class="chapter" data-level="2.1.3" data-path="data-structures.html"><a href="data-structures.html#arrays"><i class="fa fa-check"></i><b>2.1.3</b> Массивы</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="data-structures.html"><a href="data-structures.html#heterogeneous"><i class="fa fa-check"></i><b>2.2</b> Разнородные структуры данных</a><ul>
<li class="chapter" data-level="2.2.1" data-path="data-structures.html"><a href="data-structures.html#data_frames"><i class="fa fa-check"></i><b>2.2.1</b> Фреймы данных</a></li>
<li class="chapter" data-level="2.2.2" data-path="data-structures.html"><a href="data-structures.html#lists"><i class="fa fa-check"></i><b>2.2.2</b> Списки</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="data-structures.html"><a href="data-structures.html#factors"><i class="fa fa-check"></i><b>2.3</b> Факторы</a></li>
<li class="chapter" data-level="2.4" data-path="data-structures.html"><a href="data-structures.html#vector_desc"><i class="fa fa-check"></i><b>2.4</b> Описание структуры данных</a></li>
<li class="chapter" data-level="2.5" data-path="data-structures.html"><a href="data-structures.html#cycles"><i class="fa fa-check"></i><b>2.5</b> Циклы</a></li>
<li class="chapter" data-level="2.6" data-path="data-structures.html"><a href="data-structures.html#structures-detail"><i class="fa fa-check"></i><b>2.6</b> Технические детали</a></li>
<li class="chapter" data-level="2.7" data-path="data-structures.html"><a href="data-structures.html#review_structures"><i class="fa fa-check"></i><b>2.7</b> Краткий обзор</a></li>
<li class="chapter" data-level="2.8" data-path="data-structures.html"><a href="data-structures.html#questions_tasks_vectors"><i class="fa fa-check"></i><b>2.8</b> Контрольные вопросы и упражнения</a><ul>
<li class="chapter" data-level="2.8.1" data-path="data-structures.html"><a href="data-structures.html#questions_vectors"><i class="fa fa-check"></i><b>2.8.1</b> Вопросы</a></li>
<li class="chapter" data-level="2.8.2" data-path="data-structures.html"><a href="data-structures.html#tasks_vectors"><i class="fa fa-check"></i><b>2.8.2</b> Упражнения</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="tables.html"><a href="tables.html"><i class="fa fa-check"></i><b>3</b> Табличные данные</a><ul>
<li class="chapter" data-level="3.1" data-path="tables.html"><a href="tables.html#tables_prerequisites"><i class="fa fa-check"></i><b>3.1</b> Предварительные требования</a></li>
<li class="chapter" data-level="3.2" data-path="tables.html"><a href="tables.html#tables_datastructures"><i class="fa fa-check"></i><b>3.2</b> Структуры данных</a></li>
<li class="chapter" data-level="3.3" data-path="tables.html"><a href="tables.html#tables_reading"><i class="fa fa-check"></i><b>3.3</b> Чтение</a><ul>
<li class="chapter" data-level="3.3.1" data-path="tables.html"><a href="tables.html#tables_reading_inner"><i class="fa fa-check"></i><b>3.3.1</b> Встроенные данные</a></li>
<li class="chapter" data-level="3.3.2" data-path="tables.html"><a href="tables.html#tables_reading_text"><i class="fa fa-check"></i><b>3.3.2</b> Текстовые таблицы</a></li>
<li class="chapter" data-level="3.3.3" data-path="tables.html"><a href="tables.html#tables_reading_excel"><i class="fa fa-check"></i><b>3.3.3</b> Таблицы Microsoft Excel</a></li>
<li class="chapter" data-level="3.3.4" data-path="tables.html"><a href="tables.html#tables_reading_params"><i class="fa fa-check"></i><b>3.3.4</b> Параметры</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="tables.html"><a href="tables.html#tables_view"><i class="fa fa-check"></i><b>3.4</b> Просмотр</a></li>
<li class="chapter" data-level="3.5" data-path="tables.html"><a href="tables.html#tables_elements"><i class="fa fa-check"></i><b>3.5</b> Столбцы, строки и ячейки</a><ul>
<li class="chapter" data-level="3.5.1" data-path="tables.html"><a href="tables.html#tables_elements_names"><i class="fa fa-check"></i><b>3.5.1</b> Названия</a></li>
<li class="chapter" data-level="3.5.2" data-path="tables.html"><a href="tables.html#tables_elements_columns"><i class="fa fa-check"></i><b>3.5.2</b> Обращение к столбцам</a></li>
<li class="chapter" data-level="3.5.3" data-path="tables.html"><a href="tables.html#tables_elements_rows"><i class="fa fa-check"></i><b>3.5.3</b> Обращение к строкам</a></li>
<li class="chapter" data-level="3.5.4" data-path="tables.html"><a href="tables.html#tables_elements_cells"><i class="fa fa-check"></i><b>3.5.4</b> Обращение к ячейкам</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="tables.html"><a href="tables.html#tables_manipuilations"><i class="fa fa-check"></i><b>3.6</b> Преобразования</a><ul>
<li class="chapter" data-level="3.6.1" data-path="tables.html"><a href="tables.html#tables_manipiulations_grammar"><i class="fa fa-check"></i><b>3.6.1</b> Грамматика манипуляций</a></li>
<li class="chapter" data-level="3.6.2" data-path="tables.html"><a href="tables.html#tables_manipiulations_pipeline"><i class="fa fa-check"></i><b>3.6.2</b> Конвейер манипуляций</a></li>
<li class="chapter" data-level="3.6.3" data-path="tables.html"><a href="tables.html#tables_tidy"><i class="fa fa-check"></i><b>3.6.3</b> Преобразование структуры</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="tables.html"><a href="tables.html#tables_join"><i class="fa fa-check"></i><b>3.7</b> Соединение</a></li>
<li class="chapter" data-level="3.8" data-path="tables.html"><a href="tables.html#tables_write"><i class="fa fa-check"></i><b>3.8</b> Запись</a></li>
<li class="chapter" data-level="3.9" data-path="tables.html"><a href="tables.html#tables_rules"><i class="fa fa-check"></i><b>3.9</b> Рекомендации по подготовке таблиц для чтения в R</a></li>
<li class="chapter" data-level="3.10" data-path="tables.html"><a href="tables.html#tables_review"><i class="fa fa-check"></i><b>3.10</b> Краткий обзор</a></li>
<li class="chapter" data-level="3.11" data-path="tables.html"><a href="tables.html#tables_questions"><i class="fa fa-check"></i><b>3.11</b> Контрольные вопросы и упражнения</a><ul>
<li class="chapter" data-level="3.11.1" data-path="tables.html"><a href="tables.html#tables_questions_questions"><i class="fa fa-check"></i><b>3.11.1</b> Вопросы</a></li>
<li class="chapter" data-level="3.11.2" data-path="tables.html"><a href="tables.html#tables_questions_tasks"><i class="fa fa-check"></i><b>3.11.2</b> Упражнения</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="tech.html"><a href="tech.html"><i class="fa fa-check"></i><b>4</b> Техники программирования</a><ul>
<li class="chapter" data-level="4.1" data-path="tech.html"><a href="tech.html#tech-fun"><i class="fa fa-check"></i><b>4.1</b> Функциональное программирование</a><ul>
<li class="chapter" data-level="4.1.1" data-path="tech.html"><a href="tech.html#tech-fun-functions"><i class="fa fa-check"></i><b>4.1.1</b> Функции</a></li>
<li class="chapter" data-level="4.1.2" data-path="tech.html"><a href="tech.html#tech-fun-functionals"><i class="fa fa-check"></i><b>4.1.2</b> Функционалы</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="tech.html"><a href="tech.html#tech-meta"><i class="fa fa-check"></i><b>4.2</b> Метапрограммирование</a></li>
<li class="chapter" data-level="4.3" data-path="tech.html"><a href="tech.html#tech_review"><i class="fa fa-check"></i><b>4.3</b> Краткий обзор</a></li>
<li class="chapter" data-level="4.4" data-path="tech.html"><a href="tech.html#tech_questions"><i class="fa fa-check"></i><b>4.4</b> Контрольные вопросы и упражнения</a><ul>
<li class="chapter" data-level="4.4.1" data-path="tech.html"><a href="tech.html#tech_questions_questions"><i class="fa fa-check"></i><b>4.4.1</b> Вопросы</a></li>
<li class="chapter" data-level="4.4.2" data-path="tech.html"><a href="tech.html#tech_questions_tasks"><i class="fa fa-check"></i><b>4.4.2</b> Упражнения</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Графика и статистика</b></span></li>
<li class="chapter" data-level="5" data-path="graphics.html"><a href="graphics.html"><i class="fa fa-check"></i><b>5</b> Базовая графика</a><ul>
<li class="chapter" data-level="5.1" data-path="graphics.html"><a href="graphics.html#yfxcharts"><i class="fa fa-check"></i><b>5.1</b> Стандартные графики</a><ul>
<li class="chapter" data-level="5.1.1" data-path="graphics.html"><a href="graphics.html#scatterplots"><i class="fa fa-check"></i><b>5.1.1</b> Диаграммы рассеяния</a></li>
<li class="chapter" data-level="5.1.2" data-path="graphics.html"><a href="graphics.html#linear_graphs"><i class="fa fa-check"></i><b>5.1.2</b> Линейные графики</a></li>
<li class="chapter" data-level="5.1.3" data-path="graphics.html"><a href="graphics.html#graph_combining"><i class="fa fa-check"></i><b>5.1.3</b> Совмещение графиков</a></li>
<li class="chapter" data-level="5.1.4" data-path="graphics.html"><a href="graphics.html#func_parameters"><i class="fa fa-check"></i><b>5.1.4</b> Функциональные параметры</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="graphics.html"><a href="graphics.html#histograms"><i class="fa fa-check"></i><b>5.2</b> Гистограммы</a></li>
<li class="chapter" data-level="5.3" data-path="graphics.html"><a href="graphics.html#barplots"><i class="fa fa-check"></i><b>5.3</b> Столбчатые графики</a></li>
<li class="chapter" data-level="5.4" data-path="graphics.html"><a href="graphics.html#piecharts"><i class="fa fa-check"></i><b>5.4</b> Круговые (секторные) диаграммы</a></li>
<li class="chapter" data-level="5.5" data-path="graphics.html"><a href="graphics.html#colors"><i class="fa fa-check"></i><b>5.5</b> Цвет и прозрачность</a></li>
<li class="chapter" data-level="5.6" data-path="graphics.html"><a href="graphics.html#disp_settings"><i class="fa fa-check"></i><b>5.6</b> Настройки отображения</a><ul>
<li class="chapter" data-level="5.6.1" data-path="graphics.html"><a href="graphics.html#graph_params"><i class="fa fa-check"></i><b>5.6.1</b> Графические параметры</a></li>
<li class="chapter" data-level="5.6.2" data-path="graphics.html"><a href="graphics.html#axes"><i class="fa fa-check"></i><b>5.6.2</b> Разметка осей, рамка, сетка координат и произвольные линии</a></li>
<li class="chapter" data-level="5.6.3" data-path="graphics.html"><a href="graphics.html#annotations"><i class="fa fa-check"></i><b>5.6.3</b> Аннотации данных (текст на графике)</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="graphics.html"><a href="graphics.html#legend"><i class="fa fa-check"></i><b>5.7</b> Легенда</a></li>
<li class="chapter" data-level="5.8" data-path="graphics.html"><a href="graphics.html#questions_tasks_graphics"><i class="fa fa-check"></i><b>5.8</b> Контрольные вопросы и упражнения</a><ul>
<li class="chapter" data-level="5.8.1" data-path="graphics.html"><a href="graphics.html#questions_graphics"><i class="fa fa-check"></i><b>5.8.1</b> Вопросы</a></li>
<li class="chapter" data-level="5.8.2" data-path="graphics.html"><a href="graphics.html#tasks_graphics"><i class="fa fa-check"></i><b>5.8.2</b> Упражнения</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="advgraphics.html"><a href="advgraphics.html"><i class="fa fa-check"></i><b>6</b> Продвинутая графика</a><ul>
<li class="chapter" data-level="6.1" data-path="advgraphics.html"><a href="advgraphics.html#advgraphics_prerequisites"><i class="fa fa-check"></i><b>6.1</b> Предварительные требования</a></li>
<li class="chapter" data-level="6.2" data-path="advgraphics.html"><a href="advgraphics.html#advgraphics_eurostat"><i class="fa fa-check"></i><b>6.2</b> Загрузка данных Евростата</a></li>
<li class="chapter" data-level="6.3" data-path="advgraphics.html"><a href="advgraphics.html#advgraphics_nasapower"><i class="fa fa-check"></i><b>6.3</b> Загрузка данных NASA POWER</a></li>
<li class="chapter" data-level="6.4" data-path="advgraphics.html"><a href="advgraphics.html#advgraphics_template"><i class="fa fa-check"></i><b>6.4</b> Базовый шаблон ggplot</a></li>
<li class="chapter" data-level="6.5" data-path="advgraphics.html"><a href="advgraphics.html#advgraphics_geoms"><i class="fa fa-check"></i><b>6.5</b> Геометрические типы и преобразования</a></li>
<li class="chapter" data-level="6.6" data-path="advgraphics.html"><a href="advgraphics.html#advgraphics_aes"><i class="fa fa-check"></i><b>6.6</b> Графические переменные и группировки</a></li>
<li class="chapter" data-level="6.7" data-path="advgraphics.html"><a href="advgraphics.html#advgraphics_coords"><i class="fa fa-check"></i><b>6.7</b> Системы координат</a></li>
<li class="chapter" data-level="6.8" data-path="advgraphics.html"><a href="advgraphics.html#advgraphics_titles"><i class="fa fa-check"></i><b>6.8</b> Названия осей и легенды</a></li>
<li class="chapter" data-level="6.9" data-path="advgraphics.html"><a href="advgraphics.html#advgraphics_axes"><i class="fa fa-check"></i><b>6.9</b> Разметка осей</a></li>
<li class="chapter" data-level="6.10" data-path="advgraphics.html"><a href="advgraphics.html#advgraphics_labels"><i class="fa fa-check"></i><b>6.10</b> Подписи и аннотации</a></li>
<li class="chapter" data-level="6.11" data-path="advgraphics.html"><a href="advgraphics.html#advgraphics_facets"><i class="fa fa-check"></i><b>6.11</b> Фасеты</a></li>
<li class="chapter" data-level="6.12" data-path="advgraphics.html"><a href="advgraphics.html#advgraphics_themes"><i class="fa fa-check"></i><b>6.12</b> Темы</a></li>
<li class="chapter" data-level="6.13" data-path="advgraphics.html"><a href="advgraphics.html#questions_tasks_advgraphics"><i class="fa fa-check"></i><b>6.13</b> Контрольные вопросы и упражнения</a><ul>
<li class="chapter" data-level="6.13.1" data-path="advgraphics.html"><a href="advgraphics.html#questions_advgraphics"><i class="fa fa-check"></i><b>6.13.1</b> Вопросы</a></li>
<li class="chapter" data-level="6.13.2" data-path="advgraphics.html"><a href="advgraphics.html#tasks_advgraphics"><i class="fa fa-check"></i><b>6.13.2</b> Упражнения</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="stat-analysis.html"><a href="stat-analysis.html"><i class="fa fa-check"></i><b>7</b> Основы статистики</a><ul>
<li class="chapter" data-level="7.1" data-path="stat-analysis.html"><a href="stat-analysis.html#stat_analysis_prerequisites"><i class="fa fa-check"></i><b>7.1</b> Предварительные требования</a></li>
<li class="chapter" data-level="7.2" data-path="stat-analysis.html"><a href="stat-analysis.html#stat_analysis_intro"><i class="fa fa-check"></i><b>7.2</b> Введение</a><ul>
<li class="chapter" data-level="7.2.1" data-path="stat-analysis.html"><a href="stat-analysis.html#stat_analysis_intro_sources"><i class="fa fa-check"></i><b>7.2.1</b> Источники данных</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="stat-analysis.html"><a href="stat-analysis.html#stat_analysis_one"><i class="fa fa-check"></i><b>7.3</b> Одна переменная</a><ul>
<li class="chapter" data-level="7.3.1" data-path="stat-analysis.html"><a href="stat-analysis.html#stat_analysis_one_distr"><i class="fa fa-check"></i><b>7.3.1</b> Оценка распределения</a></li>
<li class="chapter" data-level="7.3.2" data-path="stat-analysis.html"><a href="stat-analysis.html#stat_analysis_one_summary"><i class="fa fa-check"></i><b>7.3.2</b> Описательные статистики</a></li>
<li class="chapter" data-level="7.3.3" data-path="stat-analysis.html"><a href="stat-analysis.html#stat_analysis_one_tests"><i class="fa fa-check"></i><b>7.3.3</b> Статистические тесты</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="stat-analysis.html"><a href="stat-analysis.html#stat_analysis_two"><i class="fa fa-check"></i><b>7.4</b> Две переменных</a><ul>
<li class="chapter" data-level="7.4.1" data-path="stat-analysis.html"><a href="stat-analysis.html#stat_analysis_two_distr"><i class="fa fa-check"></i><b>7.4.1</b> Оценка распределения</a></li>
<li class="chapter" data-level="7.4.2" data-path="stat-analysis.html"><a href="stat-analysis.html#stat_analysis_two_distr_correg"><i class="fa fa-check"></i><b>7.4.2</b> Корреляция и регрессия</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="stat-analysis.html"><a href="stat-analysis.html#questions_tasks_stat_analysis"><i class="fa fa-check"></i><b>7.5</b> Контрольные вопросы и упражнения</a><ul>
<li class="chapter" data-level="7.5.1" data-path="stat-analysis.html"><a href="stat-analysis.html#questions_stat_analysis"><i class="fa fa-check"></i><b>7.5.1</b> Вопросы</a></li>
<li class="chapter" data-level="7.5.2" data-path="stat-analysis.html"><a href="stat-analysis.html#tasks_stat_analysis"><i class="fa fa-check"></i><b>7.5.2</b> Упражнения</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="circular.html"><a href="circular.html"><i class="fa fa-check"></i><b>8</b> Дирекционные и временные данные</a><ul>
<li class="chapter" data-level="8.1" data-path="circular.html"><a href="circular.html#circular_prerequisites"><i class="fa fa-check"></i><b>8.1</b> Предварительные требования</a></li>
<li class="chapter" data-level="8.2" data-path="circular.html"><a href="circular.html#circular_circ"><i class="fa fa-check"></i><b>8.2</b> Статистика направлений</a><ul>
<li class="chapter" data-level="8.2.1" data-path="circular.html"><a href="circular.html#circular_circ_theory"><i class="fa fa-check"></i><b>8.2.1</b> Теория</a></li>
<li class="chapter" data-level="8.2.2" data-path="circular.html"><a href="circular.html#circular_circ_vis"><i class="fa fa-check"></i><b>8.2.2</b> Практика</a></li>
<li class="chapter" data-level="8.2.3" data-path="circular.html"><a href="circular.html#circular_tests"><i class="fa fa-check"></i><b>8.2.3</b> Статистические тесты</a></li>
<li class="chapter" data-level="8.2.4" data-path="circular.html"><a href="circular.html#circular_correlation"><i class="fa fa-check"></i><b>8.2.4</b> Корреляция и регрессия</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="circular.html"><a href="circular.html#circular_time"><i class="fa fa-check"></i><b>8.3</b> Временные ряды</a><ul>
<li class="chapter" data-level="8.3.1" data-path="circular.html"><a href="circular.html#circular_time_lubridate"><i class="fa fa-check"></i><b>8.3.1</b> Создание и преобразование дат и времени</a></li>
<li class="chapter" data-level="8.3.2" data-path="circular.html"><a href="circular.html#circular_time_complete"><i class="fa fa-check"></i><b>8.3.2</b> Восстановление пропусков и проверка корректности дат</a></li>
<li class="chapter" data-level="8.3.3" data-path="circular.html"><a href="circular.html#circular_time_interp"><i class="fa fa-check"></i><b>8.3.3</b> Интерполяция по времени</a></li>
<li class="chapter" data-level="8.3.4" data-path="circular.html"><a href="circular.html#circular_time_tests"><i class="fa fa-check"></i><b>8.3.4</b> Статистики</a></li>
<li class="chapter" data-level="8.3.5" data-path="circular.html"><a href="circular.html#circular_time_animation"><i class="fa fa-check"></i><b>8.3.5</b> Анимация</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="circular.html"><a href="circular.html#questions_tasks_circular"><i class="fa fa-check"></i><b>8.4</b> Контрольные вопросы и упражнения</a><ul>
<li class="chapter" data-level="8.4.1" data-path="circular.html"><a href="circular.html#questions_circular"><i class="fa fa-check"></i><b>8.4.1</b> Вопросы</a></li>
<li class="chapter" data-level="8.4.2" data-path="circular.html"><a href="circular.html#tasks_circular"><i class="fa fa-check"></i><b>8.4.2</b> Упражнения</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Пространственные данные</b></span></li>
<li class="chapter" data-level="9" data-path="spatial-data.html"><a href="spatial-data.html"><i class="fa fa-check"></i><b>9</b> Пространственные данные</a><ul>
<li class="chapter" data-level="9.1" data-path="circular.html"><a href="circular.html#circular_prerequisites"><i class="fa fa-check"></i><b>9.1</b> Предварительные требования</a></li>
<li class="chapter" data-level="9.2" data-path="spatial-data.html"><a href="spatial-data.html#spatial_models"><i class="fa fa-check"></i><b>9.2</b> Модели пространственных данных</a><ul>
<li class="chapter" data-level="9.2.1" data-path="spatial-data.html"><a href="spatial-data.html#simple_features"><i class="fa fa-check"></i><b>9.2.1</b> Векторные данные</a></li>
<li class="chapter" data-level="9.2.2" data-path="spatial-data.html"><a href="spatial-data.html#raster_data"><i class="fa fa-check"></i><b>9.2.2</b> Растровые данные</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="spatial-data.html"><a href="spatial-data.html#spatref"><i class="fa fa-check"></i><b>9.3</b> Пространственная привязка</a><ul>
<li class="chapter" data-level="9.3.1" data-path="spatial-data.html"><a href="spatial-data.html#spatref_components"><i class="fa fa-check"></i><b>9.3.1</b> Компоненты пространственной привязки</a></li>
<li class="chapter" data-level="9.3.2" data-path="spatial-data.html"><a href="spatial-data.html#spatref_formats"><i class="fa fa-check"></i><b>9.3.2</b> Форматы описания пространственной привязки</a></li>
<li class="chapter" data-level="9.3.3" data-path="spatial-data.html"><a href="spatial-data.html#spatref_transform"><i class="fa fa-check"></i><b>9.3.3</b> Преобразование координат</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="spatial-data.html"><a href="spatial-data.html#vector_data_r"><i class="fa fa-check"></i><b>9.4</b> Векторные данные</a><ul>
<li class="chapter" data-level="9.4.1" data-path="spatial-data.html"><a href="spatial-data.html#vector_data_packages"><i class="fa fa-check"></i><b>9.4.1</b> Базовые библиотеки</a></li>
<li class="chapter" data-level="9.4.2" data-path="spatial-data.html"><a href="spatial-data.html#vector_data_reading"><i class="fa fa-check"></i><b>9.4.2</b> Чтение</a></li>
<li class="chapter" data-level="9.4.3" data-path="spatial-data.html"><a href="spatial-data.html#sf_structure"><i class="fa fa-check"></i><b>9.4.3</b> Внутренняя структура</a></li>
<li class="chapter" data-level="9.4.4" data-path="spatial-data.html"><a href="spatial-data.html#sf_plotting"><i class="fa fa-check"></i><b>9.4.4</b> Визуализация</a></li>
<li class="chapter" data-level="9.4.5" data-path="spatial-data.html"><a href="spatial-data.html#sf_crs"><i class="fa fa-check"></i><b>9.4.5</b> Системы координат и проекции</a></li>
<li class="chapter" data-level="9.4.6" data-path="spatial-data.html"><a href="spatial-data.html#sf_attrs"><i class="fa fa-check"></i><b>9.4.6</b> Атрибутивные операции</a></li>
<li class="chapter" data-level="9.4.7" data-path="spatial-data.html"><a href="spatial-data.html#sf_spat_selection"><i class="fa fa-check"></i><b>9.4.7</b> Пространственные операции</a></li>
<li class="chapter" data-level="9.4.8" data-path="spatial-data.html"><a href="spatial-data.html#sf_creation"><i class="fa fa-check"></i><b>9.4.8</b> Создание пространственных объектов</a></li>
<li class="chapter" data-level="9.4.9" data-path="spatial-data.html"><a href="spatial-data.html#sf_geom_attrs"><i class="fa fa-check"></i><b>9.4.9</b> Геометрические атрибуты</a></li>
<li class="chapter" data-level="9.4.10" data-path="spatial-data.html"><a href="spatial-data.html#sf_export"><i class="fa fa-check"></i><b>9.4.10</b> Экспорт</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="spatial-data.html"><a href="spatial-data.html#raster_data_r"><i class="fa fa-check"></i><b>9.5</b> Растровые данные</a><ul>
<li class="chapter" data-level="9.5.1" data-path="spatial-data.html"><a href="spatial-data.html#raster_read"><i class="fa fa-check"></i><b>9.5.1</b> Чтение</a></li>
<li class="chapter" data-level="9.5.2" data-path="spatial-data.html"><a href="spatial-data.html#raster_viz"><i class="fa fa-check"></i><b>9.5.2</b> Визуализация</a></li>
<li class="chapter" data-level="9.5.3" data-path="spatial-data.html"><a href="spatial-data.html#raster_proj"><i class="fa fa-check"></i><b>9.5.3</b> Системы координат и проекции</a></li>
<li class="chapter" data-level="9.5.4" data-path="spatial-data.html"><a href="spatial-data.html#raster_values"><i class="fa fa-check"></i><b>9.5.4</b> Операции со значениями</a></li>
<li class="chapter" data-level="9.5.5" data-path="spatial-data.html"><a href="spatial-data.html#raster_export"><i class="fa fa-check"></i><b>9.5.5</b> Экспорт</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="spatial-data.html"><a href="spatial-data.html#spatial_ggplot2"><i class="fa fa-check"></i><b>9.6</b> Визуализация средствами ggplot2</a></li>
<li class="chapter" data-level="9.7" data-path="spatial-data.html"><a href="spatial-data.html#spatial_interactive"><i class="fa fa-check"></i><b>9.7</b> Интерактивные карты</a></li>
<li class="chapter" data-level="9.8" data-path="spatial-data.html"><a href="spatial-data.html#questions_tasks_spatial"><i class="fa fa-check"></i><b>9.8</b> Контрольные вопросы и упражнения</a><ul>
<li class="chapter" data-level="9.8.1" data-path="spatial-data.html"><a href="spatial-data.html#questions_spatial"><i class="fa fa-check"></i><b>9.8.1</b> Вопросы</a></li>
<li class="chapter" data-level="9.8.2" data-path="spatial-data.html"><a href="spatial-data.html#tasks_spatial"><i class="fa fa-check"></i><b>9.8.2</b> Упражнения</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html"><i class="fa fa-check"></i><b>10</b> Тематические карты</a><ul>
<li class="chapter" data-level="" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#предварительные-условия"><i class="fa fa-check"></i>Предварительные условия</a></li>
<li class="chapter" data-level="10.1" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#thematic_mapping_intro"><i class="fa fa-check"></i><b>10.1</b> Введение</a><ul>
<li class="chapter" data-level="10.1.1" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#thematic_mapping_intro_ne"><i class="fa fa-check"></i><b>10.1.1</b> Данные Natural Earth</a></li>
<li class="chapter" data-level="10.1.2" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#thematic_mapping_intro_wc"><i class="fa fa-check"></i><b>10.1.2</b> Данные WorldClim</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#thematic_mapping_tmap"><i class="fa fa-check"></i><b>10.2</b> Способы изображения</a><ul>
<li class="chapter" data-level="10.2.1" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#thematic_mapping_vectors"><i class="fa fa-check"></i><b>10.2.1</b> Векторные данные</a></li>
<li class="chapter" data-level="10.2.2" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#thematic_mapping_rasters"><i class="fa fa-check"></i><b>10.2.2</b> Растровые данные</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#thematic_color_scales"><i class="fa fa-check"></i><b>10.3</b> Цветовые шкалы</a></li>
<li class="chapter" data-level="10.4" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#thematic_mapping_class"><i class="fa fa-check"></i><b>10.4</b> Классификация</a><ul>
<li class="chapter" data-level="10.4.1" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#thematic_mapping_class_methods"><i class="fa fa-check"></i><b>10.4.1</b> Методы классификации</a></li>
<li class="chapter" data-level="10.4.2" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#thematic_mapping_class_application"><i class="fa fa-check"></i><b>10.4.2</b> Применение на картах</a></li>
<li class="chapter" data-level="10.4.3" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#thematic_mapping_class_application"><i class="fa fa-check"></i><b>10.4.3</b> Классификация при отображении</a></li>
<li class="chapter" data-level="10.4.4" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#thematic_mapping_na"><i class="fa fa-check"></i><b>10.4.4</b> Пропущенные данные</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#thematic_mapping_layouts"><i class="fa fa-check"></i><b>10.5</b> Компоновка</a></li>
<li class="chapter" data-level="10.6" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#thematic_mapping_facets"><i class="fa fa-check"></i><b>10.6</b> Фасеты и серии карт</a></li>
<li class="chapter" data-level="10.7" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#thematic_mapping_animations"><i class="fa fa-check"></i><b>10.7</b> Картографические анимации</a></li>
<li class="chapter" data-level="10.8" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#thematic_mapping_interactive"><i class="fa fa-check"></i><b>10.8</b> Интерактивные карты</a></li>
<li class="chapter" data-level="10.9" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#questions_tasks_tmap"><i class="fa fa-check"></i><b>10.9</b> Контрольные вопросы и упражнения</a><ul>
<li class="chapter" data-level="10.9.1" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#questions_tmap"><i class="fa fa-check"></i><b>10.9.1</b> Вопросы</a></li>
<li class="chapter" data-level="10.9.2" data-path="thematic-mapping-new.html"><a href="thematic-mapping-new.html#tasks_tmap"><i class="fa fa-check"></i><b>10.9.2</b> Упражнения</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="vector-analysis.html"><a href="vector-analysis.html"><i class="fa fa-check"></i><b>11</b> Векторный и сетевой анализ</a><ul>
<li class="chapter" data-level="11.1" data-path="vector-analysis.html"><a href="vector-analysis.html#spatial_queries"><i class="fa fa-check"></i><b>11.1</b> Пространственные запросы</a><ul>
<li class="chapter" data-level="11.1.1" data-path="vector-analysis.html"><a href="vector-analysis.html#context_objects"><i class="fa fa-check"></i><b>11.1.1</b> Контекстные и целевые объекты</a></li>
<li class="chapter" data-level="11.1.2" data-path="vector-analysis.html"><a href="vector-analysis.html#zones"><i class="fa fa-check"></i><b>11.1.2</b> Зоны окружения объектов</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="vector-analysis.html"><a href="vector-analysis.html#use_case"><i class="fa fa-check"></i><b>11.2</b> Постановка задач и изучение данных</a></li>
<li class="chapter" data-level="11.3" data-path="vector-analysis.html"><a href="vector-analysis.html#distance_analysis"><i class="fa fa-check"></i><b>11.3</b> Анализ расстояний</a></li>
<li class="chapter" data-level="11.4" data-path="vector-analysis.html"><a href="vector-analysis.html#topology_analysis"><i class="fa fa-check"></i><b>11.4</b> Анализ взаимного положения (топологический)</a></li>
<li class="chapter" data-level="11.5" data-path="vector-analysis.html"><a href="vector-analysis.html#absolute_zones"><i class="fa fa-check"></i><b>11.5</b> Анализ абсолютных зон окружения</a></li>
<li class="chapter" data-level="11.6" data-path="vector-analysis.html"><a href="vector-analysis.html#conc_zones"><i class="fa fa-check"></i><b>11.6</b> Анализ конкурентных зон окружения</a></li>
<li class="chapter" data-level="11.7" data-path="vector-analysis.html"><a href="vector-analysis.html#transport_zones"><i class="fa fa-check"></i><b>11.7</b> Анализ зон транспортной доступности</a></li>
<li class="chapter" data-level="11.8" data-path="vector-analysis.html"><a href="vector-analysis.html#routes"><i class="fa fa-check"></i><b>11.8</b> Построение маршрутов и матриц времени движения</a></li>
<li class="chapter" data-level="11.9" data-path="vector-analysis.html"><a href="vector-analysis.html#qtasks_vector_analysis"><i class="fa fa-check"></i><b>11.9</b> Контрольные вопросы и упражнения</a><ul>
<li class="chapter" data-level="11.9.1" data-path="vector-analysis.html"><a href="vector-analysis.html#questions_vector_analysis"><i class="fa fa-check"></i><b>11.9.1</b> Вопросы</a></li>
<li class="chapter" data-level="11.9.2" data-path="vector-analysis.html"><a href="vector-analysis.html#tasks_vector_analysis"><i class="fa fa-check"></i><b>11.9.2</b> Упражнения</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="raster-analysis.html"><a href="raster-analysis.html"><i class="fa fa-check"></i><b>12</b> Растровый анализ</a><ul>
<li class="chapter" data-level="" data-path="raster-analysis.html"><a href="raster-analysis.html#предварительные-условия-1"><i class="fa fa-check"></i>Предварительные условия</a></li>
<li class="chapter" data-level="12.1" data-path="raster-analysis.html"><a href="raster-analysis.html#raster_intro"><i class="fa fa-check"></i><b>12.1</b> Введение</a></li>
<li class="chapter" data-level="12.2" data-path="raster-analysis.html"><a href="raster-analysis.html#растровая-алгебра"><i class="fa fa-check"></i><b>12.2</b> Растровая алгебра</a><ul>
<li class="chapter" data-level="12.2.1" data-path="raster-analysis.html"><a href="raster-analysis.html#raster_local"><i class="fa fa-check"></i><b>12.2.1</b> Локальные операции</a></li>
<li class="chapter" data-level="12.2.2" data-path="raster-analysis.html"><a href="raster-analysis.html#raster_focal"><i class="fa fa-check"></i><b>12.2.2</b> Фокальные операции</a></li>
<li class="chapter" data-level="12.2.3" data-path="raster-analysis.html"><a href="raster-analysis.html#raster_zonal"><i class="fa fa-check"></i><b>12.2.3</b> Зональные операции</a></li>
<li class="chapter" data-level="12.2.4" data-path="raster-analysis.html"><a href="raster-analysis.html#raster_global"><i class="fa fa-check"></i><b>12.2.4</b> Глобальные операции</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="raster-analysis.html"><a href="raster-analysis.html#raster_extract"><i class="fa fa-check"></i><b>12.3</b> Извлечение данных</a></li>
<li class="chapter" data-level="12.4" data-path="raster-analysis.html"><a href="raster-analysis.html#questions_tasks_raster"><i class="fa fa-check"></i><b>12.4</b> Контрольные вопросы и упражнения</a><ul>
<li class="chapter" data-level="12.4.1" data-path="raster-analysis.html"><a href="raster-analysis.html#questions_raster"><i class="fa fa-check"></i><b>12.4.1</b> Вопросы</a></li>
<li class="chapter" data-level="12.4.2" data-path="raster-analysis.html"><a href="raster-analysis.html#tasks_raster"><i class="fa fa-check"></i><b>12.4.2</b> Упражнения</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Пространственная статистика</b></span></li>
<li class="chapter" data-level="13" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html"><i class="fa fa-check"></i><b>13</b> Моделирование геополей</a><ul>
<li class="chapter" data-level="13.1" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#interpolation_intro"><i class="fa fa-check"></i><b>13.1</b> Введение</a></li>
<li class="chapter" data-level="13.2" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#interpolation_grid"><i class="fa fa-check"></i><b>13.2</b> Построение сетки</a></li>
<li class="chapter" data-level="13.3" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#interpolation_methods"><i class="fa fa-check"></i><b>13.3</b> Интерполяционные методы</a><ul>
<li class="chapter" data-level="13.3.1" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#interpolation_nn"><i class="fa fa-check"></i><b>13.3.1</b> Метод ближайшего соседа (nearest neighbour)</a></li>
<li class="chapter" data-level="13.3.2" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#interpolation_tin"><i class="fa fa-check"></i><b>13.3.2</b> Интерполяция на основе триангуляции</a></li>
<li class="chapter" data-level="13.3.3" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#interpolation_idw"><i class="fa fa-check"></i><b>13.3.3</b> Метод обратно взвешенных расстояний (IDW)</a></li>
<li class="chapter" data-level="13.3.4" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#interpolation_rbf"><i class="fa fa-check"></i><b>13.3.4</b> Метод радиальных базисных функций (РБФ)</a></li>
<li class="chapter" data-level="13.3.5" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#interpolation_bspline"><i class="fa fa-check"></i><b>13.3.5</b> Метод иерархических базисных сплайнов (B-сплайнов)</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#approximation_methods"><i class="fa fa-check"></i><b>13.4</b> Аппроксимационные методы</a><ul>
<li class="chapter" data-level="13.4.1" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#approximation_global"><i class="fa fa-check"></i><b>13.4.1</b> Глобальный тренд</a></li>
<li class="chapter" data-level="13.4.2" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#approximation_local"><i class="fa fa-check"></i><b>13.4.2</b> Локальный тренд</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#areal_interpolation"><i class="fa fa-check"></i><b>13.5</b> Интерполяция по ареалам</a></li>
<li class="chapter" data-level="13.6" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#interp_review"><i class="fa fa-check"></i><b>13.6</b> Краткий обзор</a></li>
<li class="chapter" data-level="13.7" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#questions_tasks_interp"><i class="fa fa-check"></i><b>13.7</b> Контрольные вопросы и упражнения</a><ul>
<li class="chapter" data-level="13.7.1" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#questions_interp"><i class="fa fa-check"></i><b>13.7.1</b> Вопросы</a></li>
<li class="chapter" data-level="13.7.2" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#tasks_interp"><i class="fa fa-check"></i><b>13.7.2</b> Упражнения</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="kriging.html"><a href="kriging.html"><i class="fa fa-check"></i><b>14</b> Геостатистика</a><ul>
<li class="chapter" data-level="14.1" data-path="kriging.html"><a href="kriging.html#введение-1"><i class="fa fa-check"></i><b>14.1</b> Введение</a></li>
<li class="chapter" data-level="14.2" data-path="kriging.html"><a href="kriging.html#базовые-понятия-и-элементы-геостатистики"><i class="fa fa-check"></i><b>14.2</b> Базовые понятия и элементы геостатистики</a><ul>
<li class="chapter" data-level="14.2.1" data-path="kriging.html"><a href="kriging.html#базовые-понятия"><i class="fa fa-check"></i><b>14.2.1</b> Базовые понятия</a></li>
<li class="chapter" data-level="14.2.2" data-path="kriging.html"><a href="kriging.html#случайный-процесс-в-пространстве-и-его-моменты"><i class="fa fa-check"></i><b>14.2.2</b> Случайный процесс в пространстве и его моменты</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="kriging.html"><a href="kriging.html#стационарность-и-эргодичность"><i class="fa fa-check"></i><b>14.3</b> Стационарность и эргодичность</a><ul>
<li class="chapter" data-level="14.3.1" data-path="kriging.html"><a href="kriging.html#стационарность"><i class="fa fa-check"></i><b>14.3.1</b> Стационарность</a></li>
<li class="chapter" data-level="14.3.2" data-path="kriging.html"><a href="kriging.html#эргодичность"><i class="fa fa-check"></i><b>14.3.2</b> Эргодичность</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="kriging.html"><a href="kriging.html#геостатистическое-оценивание"><i class="fa fa-check"></i><b>14.4</b> Геостатистическое оценивание</a><ul>
<li class="chapter" data-level="14.4.1" data-path="kriging.html"><a href="kriging.html#простой-кригинг"><i class="fa fa-check"></i><b>14.4.1</b> Простой кригинг</a></li>
<li class="chapter" data-level="14.4.2" data-path="kriging.html"><a href="kriging.html#дисперсия-простого-кригинга"><i class="fa fa-check"></i><b>14.4.2</b> Дисперсия простого кригинга</a></li>
<li class="chapter" data-level="14.4.3" data-path="kriging.html"><a href="kriging.html#стационарность-приращений"><i class="fa fa-check"></i><b>14.4.3</b> Стационарность приращений</a></li>
<li class="chapter" data-level="14.4.4" data-path="kriging.html"><a href="kriging.html#положительная-определенность"><i class="fa fa-check"></i><b>14.4.4</b> Положительная определенность</a></li>
<li class="chapter" data-level="14.4.5" data-path="kriging.html"><a href="kriging.html#допустимые-линейные-комбинации"><i class="fa fa-check"></i><b>14.4.5</b> Допустимые линейные комбинации</a></li>
<li class="chapter" data-level="14.4.6" data-path="kriging.html"><a href="kriging.html#условная-положительная-определенность"><i class="fa fa-check"></i><b>14.4.6</b> Условная положительная определенность</a></li>
<li class="chapter" data-level="14.4.7" data-path="kriging.html"><a href="kriging.html#переход-от-ковариации-к-вариограмме"><i class="fa fa-check"></i><b>14.4.7</b> Переход от ковариации к вариограмме</a></li>
<li class="chapter" data-level="14.4.8" data-path="kriging.html"><a href="kriging.html#обычный-кригинг"><i class="fa fa-check"></i><b>14.4.8</b> Обычный кригинг</a></li>
<li class="chapter" data-level="14.4.9" data-path="kriging.html"><a href="kriging.html#дисперсия-обычного-кригинга"><i class="fa fa-check"></i><b>14.4.9</b> Дисперсия обычного кригинга</a></li>
<li class="chapter" data-level="14.4.10" data-path="kriging.html"><a href="kriging.html#универсальный-кригинг"><i class="fa fa-check"></i><b>14.4.10</b> Универсальный кригинг</a></li>
<li class="chapter" data-level="14.4.11" data-path="kriging.html"><a href="kriging.html#дисперсия-универсального-кригинга"><i class="fa fa-check"></i><b>14.4.11</b> Дисперсия универсального кригинга</a></li>
<li class="chapter" data-level="14.4.12" data-path="kriging.html"><a href="kriging.html#кросс-валидация"><i class="fa fa-check"></i><b>14.4.12</b> Кросс-валидация</a></li>
<li class="chapter" data-level="14.4.13" data-path="kriging.html"><a href="kriging.html#вариограмма"><i class="fa fa-check"></i><b>14.4.13</b> Вариограмма</a></li>
<li class="chapter" data-level="14.4.14" data-path="kriging.html"><a href="kriging.html#сферическая-модель"><i class="fa fa-check"></i><b>14.4.14</b> Сферическая модель</a></li>
<li class="chapter" data-level="14.4.15" data-path="kriging.html"><a href="kriging.html#экспоненциальная-модель"><i class="fa fa-check"></i><b>14.4.15</b> Экспоненциальная модель</a></li>
<li class="chapter" data-level="14.4.16" data-path="kriging.html"><a href="kriging.html#гауссова-модель"><i class="fa fa-check"></i><b>14.4.16</b> Гауссова модель</a></li>
<li class="chapter" data-level="14.4.17" data-path="kriging.html"><a href="kriging.html#степенная-модель"><i class="fa fa-check"></i><b>14.4.17</b> Степенная модель</a></li>
<li class="chapter" data-level="14.4.18" data-path="kriging.html"><a href="kriging.html#эффект-самородка-модель-наггет"><i class="fa fa-check"></i><b>14.4.18</b> Эффект самородка (модель наггет)</a></li>
<li class="chapter" data-level="14.4.19" data-path="kriging.html"><a href="kriging.html#диаграмма-рассеяния-с-лагом"><i class="fa fa-check"></i><b>14.4.19</b> Диаграмма рассеяния с лагом</a></li>
<li class="chapter" data-level="14.4.20" data-path="kriging.html"><a href="kriging.html#вариограммное-облако"><i class="fa fa-check"></i><b>14.4.20</b> Вариограммное облако</a></li>
<li class="chapter" data-level="14.4.21" data-path="kriging.html"><a href="kriging.html#эмпирическая-вариограмма"><i class="fa fa-check"></i><b>14.4.21</b> Эмпирическая вариограмма</a></li>
<li class="chapter" data-level="14.4.22" data-path="kriging.html"><a href="kriging.html#вариокарта"><i class="fa fa-check"></i><b>14.4.22</b> Вариокарта</a></li>
<li class="chapter" data-level="14.4.23" data-path="kriging.html"><a href="kriging.html#приближение-теоретической-модели"><i class="fa fa-check"></i><b>14.4.23</b> Приближение теоретической модели</a></li>
<li class="chapter" data-level="14.4.24" data-path="kriging.html"><a href="kriging.html#обычный-кригинг-1"><i class="fa fa-check"></i><b>14.4.24</b> Обычный кригинг</a></li>
<li class="chapter" data-level="14.4.25" data-path="kriging.html"><a href="kriging.html#обычный-кригинг-2"><i class="fa fa-check"></i><b>14.4.25</b> Обычный кригинг</a></li>
<li class="chapter" data-level="14.4.26" data-path="kriging.html"><a href="kriging.html#оценка-и-дисперсия-кригинга"><i class="fa fa-check"></i><b>14.4.26</b> Оценка и дисперсия кригинга</a></li>
<li class="chapter" data-level="14.4.27" data-path="kriging.html"><a href="kriging.html#кросс-валидация-1"><i class="fa fa-check"></i><b>14.4.27</b> Кросс-валидация</a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path="kriging.html"><a href="kriging.html#geostat_review"><i class="fa fa-check"></i><b>14.5</b> Краткий обзор</a></li>
<li class="chapter" data-level="14.6" data-path="kriging.html"><a href="kriging.html#geostat_qt"><i class="fa fa-check"></i><b>14.6</b> Контрольные вопросы и упражнения</a><ul>
<li class="chapter" data-level="14.6.1" data-path="kriging.html"><a href="kriging.html#geostat_q"><i class="fa fa-check"></i><b>14.6.1</b> Вопросы</a></li>
<li class="chapter" data-level="14.6.2" data-path="kriging.html"><a href="kriging.html#geostat_t"><i class="fa fa-check"></i><b>14.6.2</b> Упражнения</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="autocorrelation.html"><a href="autocorrelation.html"><i class="fa fa-check"></i><b>15</b> Пространственная регрессия</a><ul>
<li class="chapter" data-level="15.1" data-path="autocorrelation.html"><a href="autocorrelation.html#autocorrelation_intro"><i class="fa fa-check"></i><b>15.1</b> Введение</a></li>
<li class="chapter" data-level="15.2" data-path="autocorrelation.html"><a href="autocorrelation.html#линейная-регрессия"><i class="fa fa-check"></i><b>15.2</b> Линейная регрессия</a></li>
<li class="chapter" data-level="15.3" data-path="autocorrelation.html"><a href="autocorrelation.html#пространственная-регрессия"><i class="fa fa-check"></i><b>15.3</b> Пространственная регрессия</a></li>
<li class="chapter" data-level="15.4" data-path="autocorrelation.html"><a href="autocorrelation.html#практический-анализ"><i class="fa fa-check"></i><b>15.4</b> Практический анализ</a></li>
<li class="chapter" data-level="15.5" data-path="autocorrelation.html"><a href="autocorrelation.html#autocorrelation_neighbors"><i class="fa fa-check"></i><b>15.5</b> Пространственное соседство</a><ul>
<li class="chapter" data-level="15.5.1" data-path="autocorrelation.html"><a href="autocorrelation.html#autocorrelation_neighbors_contguity"><i class="fa fa-check"></i><b>15.5.1</b> Соседи по смежности</a></li>
<li class="chapter" data-level="15.5.2" data-path="autocorrelation.html"><a href="autocorrelation.html#autocorrelation_neighbors_graph"><i class="fa fa-check"></i><b>15.5.2</b> Соседи по графу</a></li>
<li class="chapter" data-level="15.5.3" data-path="autocorrelation.html"><a href="autocorrelation.html#autocorrelation_neighbors_metrics"><i class="fa fa-check"></i><b>15.5.3</b> Соседи по метрике</a></li>
</ul></li>
<li class="chapter" data-level="15.6" data-path="autocorrelation.html"><a href="autocorrelation.html#autocorrelation_weights"><i class="fa fa-check"></i><b>15.6</b> Пространственные веса</a></li>
<li class="chapter" data-level="15.7" data-path="autocorrelation.html"><a href="autocorrelation.html#autocorrelation_measures"><i class="fa fa-check"></i><b>15.7</b> Пространственная автокорреляция</a><ul>
<li class="chapter" data-level="15.7.1" data-path="autocorrelation.html"><a href="autocorrelation.html#autocorrelation_moran"><i class="fa fa-check"></i><b>15.7.1</b> Индекс Морана (Moran’s I)</a></li>
<li class="chapter" data-level="15.7.2" data-path="autocorrelation.html"><a href="autocorrelation.html#autocorrelation_permutation"><i class="fa fa-check"></i><b>15.7.2</b> Перестановочный тест Морана</a></li>
<li class="chapter" data-level="15.7.3" data-path="autocorrelation.html"><a href="autocorrelation.html#autocorrelation_moranscatter"><i class="fa fa-check"></i><b>15.7.3</b> Диаграмма рассеяния Морана</a></li>
<li class="chapter" data-level="15.7.4" data-path="autocorrelation.html"><a href="autocorrelation.html#autocorrelation_autoregression"><i class="fa fa-check"></i><b>15.7.4</b> Пространственная авторегрессия</a></li>
</ul></li>
<li class="chapter" data-level="15.8" data-path="autocorrelation.html"><a href="autocorrelation.html#autocorrelation_gwr"><i class="fa fa-check"></i><b>15.8</b> Географически взвешенная регрессия (GWR)</a><ul>
<li class="chapter" data-level="15.8.1" data-path="autocorrelation.html"><a href="autocorrelation.html#весовые-функции"><i class="fa fa-check"></i><b>15.8.1</b> Весовые функции</a></li>
<li class="chapter" data-level="15.8.2" data-path="autocorrelation.html"><a href="autocorrelation.html#практический-анализ-1"><i class="fa fa-check"></i><b>15.8.2</b> Практический анализ</a></li>
</ul></li>
<li class="chapter" data-level="15.9" data-path="autocorrelation.html"><a href="autocorrelation.html#spreg_review"><i class="fa fa-check"></i><b>15.9</b> Краткий обзор</a></li>
<li class="chapter" data-level="15.10" data-path="autocorrelation.html"><a href="autocorrelation.html#questions_tasks_spreg"><i class="fa fa-check"></i><b>15.10</b> Контрольные вопросы и упражнения</a><ul>
<li class="chapter" data-level="15.10.1" data-path="autocorrelation.html"><a href="autocorrelation.html#questions_spreg"><i class="fa fa-check"></i><b>15.10.1</b> Вопросы</a></li>
<li class="chapter" data-level="15.10.2" data-path="autocorrelation.html"><a href="autocorrelation.html#tasks_spreg"><i class="fa fa-check"></i><b>15.10.2</b> Упражнения</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="point-patterns.html"><a href="point-patterns.html"><i class="fa fa-check"></i><b>16</b> Точечные процессы</a><ul>
<li class="chapter" data-level="16.1" data-path="point-patterns.html"><a href="point-patterns.html#точечный-паттерн"><i class="fa fa-check"></i><b>16.1</b> Точечный паттерн</a></li>
<li class="chapter" data-level="16.2" data-path="point-patterns.html"><a href="point-patterns.html#точечные-процессы"><i class="fa fa-check"></i><b>16.2</b> Точечные процессы</a><ul>
<li class="chapter" data-level="16.2.1" data-path="point-patterns.html"><a href="point-patterns.html#равномерно-случайные-точки"><i class="fa fa-check"></i><b>16.2.1</b> Равномерно случайные точки</a></li>
<li class="chapter" data-level="16.2.2" data-path="point-patterns.html"><a href="point-patterns.html#биномиальный-точечный-процесс"><i class="fa fa-check"></i><b>16.2.2</b> Биномиальный точечный процесс</a></li>
<li class="chapter" data-level="16.2.3" data-path="point-patterns.html"><a href="point-patterns.html#пуассоновский-процесс"><i class="fa fa-check"></i><b>16.2.3</b> Пуассоновский процесс</a></li>
<li class="chapter" data-level="16.2.4" data-path="point-patterns.html"><a href="point-patterns.html#неоднородный-пуассоновский-процесс"><i class="fa fa-check"></i><b>16.2.4</b> Неоднородный пуассоновский процесс</a></li>
<li class="chapter" data-level="16.2.5" data-path="point-patterns.html"><a href="point-patterns.html#процесс-кокса-cox-process"><i class="fa fa-check"></i><b>16.2.5</b> Процесс Кокса (Cox process)</a></li>
<li class="chapter" data-level="16.2.6" data-path="point-patterns.html"><a href="point-patterns.html#кластерные-процессы"><i class="fa fa-check"></i><b>16.2.6</b> Кластерные процессы</a></li>
<li class="chapter" data-level="16.2.7" data-path="point-patterns.html"><a href="point-patterns.html#регулярные-процессы"><i class="fa fa-check"></i><b>16.2.7</b> Регулярные процессы</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="point-patterns.html"><a href="point-patterns.html#диагностика"><i class="fa fa-check"></i><b>16.3</b> Диагностика</a><ul>
<li class="chapter" data-level="16.3.1" data-path="point-patterns.html"><a href="point-patterns.html#анализ-интенсивности"><i class="fa fa-check"></i><b>16.3.1</b> Анализ интенсивности</a></li>
<li class="chapter" data-level="16.3.2" data-path="point-patterns.html"><a href="point-patterns.html#анализ-зависимости"><i class="fa fa-check"></i><b>16.3.2</b> Анализ зависимости</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="point-patterns.html"><a href="point-patterns.html#моделирование"><i class="fa fa-check"></i><b>16.4</b> Моделирование</a></li>
<li class="chapter" data-level="16.5" data-path="point-patterns.html"><a href="point-patterns.html#point_review"><i class="fa fa-check"></i><b>16.5</b> Краткий обзор</a></li>
<li class="chapter" data-level="16.6" data-path="point-patterns.html"><a href="point-patterns.html#questions_tasks_patterns"><i class="fa fa-check"></i><b>16.6</b> Контрольные вопросы и упражнения</a><ul>
<li class="chapter" data-level="16.6.1" data-path="point-patterns.html"><a href="point-patterns.html#questions_patterns"><i class="fa fa-check"></i><b>16.6.1</b> Вопросы</a></li>
<li class="chapter" data-level="16.6.2" data-path="point-patterns.html"><a href="point-patterns.html#tasks_patterns"><i class="fa fa-check"></i><b>16.6.2</b> Упражнения</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Решение проблем</b></span></li>
<li class="chapter" data-level="A" data-path="package-troubles.html"><a href="package-troubles.html"><i class="fa fa-check"></i><b>A</b> Установка пакетов</a><ul>
<li class="chapter" data-level="A.1" data-path="package-troubles.html"><a href="package-troubles.html#package-troubles-standard"><i class="fa fa-check"></i><b>A.1</b> Недоступен стандартный каталог</a></li>
<li class="chapter" data-level="A.2" data-path="package-troubles.html"><a href="package-troubles.html#package-troubles-copy"><i class="fa fa-check"></i><b>A.2</b> Устанавливается, но не копируется</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://istina.msu.ru/profile/tsamsonov/" target="blank">Тимофей Самсонов</a></li>
<li><a href="https://doi.org/10.5281/zenodo.901911"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.901911.svg" title="DOI"></a><li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Визуализация и анализ географических данных на языке R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="tables" class="section level1">
<h1><span class="header-section-number">Глава 3</span> Табличные данные</h1>
<div id="tables_prerequisites" class="section level2">
<h2><span class="header-section-number">3.1</span> Предварительные требования</h2>
<p>Для работы по теме текущей лекции вам понадобятся пакеты из <strong>tidyverse</strong>, а также <strong>writexl</strong>. Установите их, используя следующую команду:</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="tables.html#cb145-1"></a><span class="kw">install.packages</span>(<span class="st">&#39;tidyverse&#39;</span>)</span>
<span id="cb145-2"><a href="tables.html#cb145-2"></a><span class="kw">install.packages</span>(<span class="st">&#39;writexl&#39;</span>)</span></code></pre></div>
<blockquote>
<p>Внимание: установка пакетов выполняется один раз из консоли. Вызов функции <code>install.packages()</code> не должен присутствовать в ваших скриптах</p>
</blockquote>
<p><a href="https://www.tidyverse.org"><strong>tidyverse</strong></a> – это не самостоятельный пакет, а набор пакетов R, которые позволяют автоматизировать решение рутинных задач по обработке данных (то, что принято называть <em>data science</em>). В комплект <strong>tidyverse</strong> входят следующие пакеты:</p>
<table>
<thead>
<tr class="header">
<th>Пакет</th>
<th>Назначение</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>tibble</strong></td>
<td>Усовершенствованный вариант фрейма данных</td>
</tr>
<tr class="even">
<td><strong>dplyr</strong></td>
<td>Грамматика манипуляций над табличными данными</td>
</tr>
<tr class="odd">
<td><strong>tidyr</strong></td>
<td>Приведение таблиц в аккуратный вид, удобный для обработки</td>
</tr>
<tr class="even">
<td><strong>readr</strong></td>
<td>Чтение табличных данных из текстовых файлов</td>
</tr>
<tr class="odd">
<td><strong>readxl</strong></td>
<td>Чтение табличных данных из файлов Microsoft Excel</td>
</tr>
<tr class="even">
<td><strong>haven</strong></td>
<td>Чтение табличных данных из файлов SPSS, Stata и SAS</td>
</tr>
<tr class="odd">
<td><strong>purrr</strong></td>
<td>Функциональное программирование</td>
</tr>
<tr class="even">
<td><strong>stringr</strong></td>
<td>Работа со строками</td>
</tr>
<tr class="odd">
<td><strong>forcats</strong></td>
<td>Автоматизация работы с факторами</td>
</tr>
<tr class="even">
<td><strong>ggplot2</strong></td>
<td>Построение графиков на основе правил грамматики</td>
</tr>
</tbody>
</table>
<p>Вы можете подключать эти пакеты по одному, или сделать их все доступными в текущей сессии <strong>R</strong>, используя команду <code>library(tidyverse)</code>. В текущей лекции мы будем подключать их по мере необходмости, чтобы акцентировать внимание на принадлежности функций к соответствующим пакетам.</p>
<blockquote>
<p><strong>Вы можете вызвать функцию из любого пакета, не подключая его целиком в текущую сессию R.</strong> Это бывает особенно полезно, когда вы редко используете функции из пакета. В этом случае вызов функции будет выглядеть как <code>package::function()</code>, где <code>package</code> – название пакета, а <code>function</code> - название функции. Подобный синтаксис бывает особенно удобным, когда <em>в разных пакетах имеются функции с одинаковым именем</em>, и при вызове R использует не ту, которая нужна (по умолчанию будет использована функция из пакета, который был подключен <em>позже</em>).</p>
</blockquote>
</div>
<div id="tables_datastructures" class="section level2">
<h2><span class="header-section-number">3.2</span> Структуры данных</h2>
<p>Стандартным средством представления табличных данных в R являются <strong>фреймы данных</strong> (<code>data.frame</code>), кратко рассмотренные в предыдущей лекции. В современных пакетах типа <strong>tidyverse</strong> используется разновидность фрейма данных, которая называется <strong>тиббл</strong> (<code>tibble</code>).</p>
<p>Создать тиббл можно напрямую, либо путем конвертации фрейма данных:</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="tables.html#cb146-1"></a><span class="kw">library</span>(tibble)</span>
<span id="cb146-2"><a href="tables.html#cb146-2"></a><span class="kw">tibble</span>(</span>
<span id="cb146-3"><a href="tables.html#cb146-3"></a>  <span class="dt">a =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, </span>
<span id="cb146-4"><a href="tables.html#cb146-4"></a>  <span class="dt">b =</span> <span class="dv">1</span>, </span>
<span id="cb146-5"><a href="tables.html#cb146-5"></a>  <span class="dt">c =</span> <span class="dv">-1</span><span class="op">:</span><span class="dv">1</span></span>
<span id="cb146-6"><a href="tables.html#cb146-6"></a>)</span>
<span id="cb146-7"><a href="tables.html#cb146-7"></a><span class="co">## # A tibble: 3 x 3</span></span>
<span id="cb146-8"><a href="tables.html#cb146-8"></a><span class="co">##       a     b     c</span></span>
<span id="cb146-9"><a href="tables.html#cb146-9"></a><span class="co">##   &lt;int&gt; &lt;dbl&gt; &lt;int&gt;</span></span>
<span id="cb146-10"><a href="tables.html#cb146-10"></a><span class="co">## 1     1     1    -1</span></span>
<span id="cb146-11"><a href="tables.html#cb146-11"></a><span class="co">## 2     2     1     0</span></span>
<span id="cb146-12"><a href="tables.html#cb146-12"></a><span class="co">## 3     3     1     1</span></span>
<span id="cb146-13"><a href="tables.html#cb146-13"></a>dfr =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">a =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">b =</span> <span class="dv">1</span>,  <span class="dt">c =</span> <span class="dv">-1</span><span class="op">:</span><span class="dv">1</span>)</span>
<span id="cb146-14"><a href="tables.html#cb146-14"></a><span class="kw">as_tibble</span>(dfr)</span>
<span id="cb146-15"><a href="tables.html#cb146-15"></a><span class="co">## # A tibble: 3 x 3</span></span>
<span id="cb146-16"><a href="tables.html#cb146-16"></a><span class="co">##       a     b     c</span></span>
<span id="cb146-17"><a href="tables.html#cb146-17"></a><span class="co">##   &lt;int&gt; &lt;dbl&gt; &lt;int&gt;</span></span>
<span id="cb146-18"><a href="tables.html#cb146-18"></a><span class="co">## 1     1     1    -1</span></span>
<span id="cb146-19"><a href="tables.html#cb146-19"></a><span class="co">## 2     2     1     0</span></span>
<span id="cb146-20"><a href="tables.html#cb146-20"></a><span class="co">## 3     3     1     1</span></span></code></pre></div>
<p>Тиббл является расширением класса фрейма данных, то есть любая операция, применимая к фрейму, применима и к тибблу. Однако, тиббл поддерживает дополнительные возможности, которые оказываются очень удобны в анализе:</p>
<ul>
<li>При выводе в консоль тиббл печатает только те столбцы, которые помещаются на экран, и только первые 10 строк (что позволяет избежать переполнения консоли при печати больших таблиц)</li>
<li>Тибблы поддерживают имена столбцов, которые недопустимы в фреймах данных (например, начинающиеся с цифры). Так называть столбцы, вообще говоря, неправильно, но это позволяет сохранить именно те названия, которые даны в исходных файлах. Например, географические таблицы часто содержат данные за разные года, и столбцы названы по этим годам.</li>
<li>Тибблы поддерживают внутренние группировки данных. Установив группировку по одной или нескольким переменным, можно эффективным и компактным путем считать агрегирующие статистики по группам измерений.</li>
<li>Тибблы можно создавать вручную не только по столбцам, но и по строкам.</li>
</ul>
<p>Для реализации последней возможности можно использовать функцию <code>tribble()</code> (переводится как <em>transposed tibble</em> — транспонированный тиббл), указав имена столбцов с помощью тильды (<code>~</code>):</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="tables.html#cb147-1"></a><span class="kw">tribble</span>(</span>
<span id="cb147-2"><a href="tables.html#cb147-2"></a>  <span class="op">~</span>a, <span class="op">~</span>b, <span class="op">~</span>c,</span>
<span id="cb147-3"><a href="tables.html#cb147-3"></a>   <span class="dv">1</span>,  <span class="dv">1</span>, <span class="dv">-1</span>,</span>
<span id="cb147-4"><a href="tables.html#cb147-4"></a>   <span class="dv">2</span>,  <span class="dv">1</span>,  <span class="dv">0</span>,</span>
<span id="cb147-5"><a href="tables.html#cb147-5"></a>   <span class="dv">3</span>,  <span class="dv">1</span>,  <span class="dv">1</span></span>
<span id="cb147-6"><a href="tables.html#cb147-6"></a>)</span>
<span id="cb147-7"><a href="tables.html#cb147-7"></a><span class="co">## # A tibble: 3 x 3</span></span>
<span id="cb147-8"><a href="tables.html#cb147-8"></a><span class="co">##       a     b     c</span></span>
<span id="cb147-9"><a href="tables.html#cb147-9"></a><span class="co">##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb147-10"><a href="tables.html#cb147-10"></a><span class="co">## 1     1     1    -1</span></span>
<span id="cb147-11"><a href="tables.html#cb147-11"></a><span class="co">## 2     2     1     0</span></span>
<span id="cb147-12"><a href="tables.html#cb147-12"></a><span class="co">## 3     3     1     1</span></span></code></pre></div>
<blockquote>
<p>В данной и последующих лекциях понятия мы будем использовать понятия таблица, фрейм данных и тиббл как взаимозаменяемые.</p>
</blockquote>
</div>
<div id="tables_reading" class="section level2">
<h2><span class="header-section-number">3.3</span> Чтение</h2>
<p>Существует множество способов получить набор табличных данных в текущей сессии R. Эти способы варьируются от загрузки данных из пакета до извлечения таблиц из текстовых документов и веб-страниц. В настоящей главе мы рассмотрим наиболее распространенные способы, нацеленные на работу с готовыми таблицами.</p>
<div id="tables_reading_inner" class="section level3">
<h3><span class="header-section-number">3.3.1</span> Встроенные данные</h3>
<p>Пакеты R часто содержат тестовые наборы данных. Эти данные, как правило, предназначены для ознакомления с возможностями пакета. Чтобы узнать, какие данные есть в пакете, вы можете вызвать функцию <code>data(package = 'packagename')</code>, где <code>packagename</code> — это имя интересующего вас пакета. Например, посмотрим, какие данные есть в пакете <code>dplyr</code>, который мы далее будем использовать для манипуляций с таблицами:</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="tables.html#cb148-1"></a><span class="kw">data</span>(<span class="dt">package =</span> <span class="st">&#39;dplyr&#39;</span>)</span></code></pre></div>
<div class="figure">
<img src="images/data_dplyr.png" alt="" />
<p class="caption"><em>Данные, доступные в пакете dplyr</em></p>
</div>
<p>На рисунке можно видеть перечень наборов данных и их краткие описания. Для загрузки набора данных передайте его название в качестве первого параметра функции <code>data()</code>. Ну-ка, что там с персонажами из <em>Star Wars</em>:</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="tables.html#cb149-1"></a><span class="kw">data</span>(starwars, <span class="dt">package =</span> <span class="st">&#39;dplyr&#39;</span>)</span>
<span id="cb149-2"><a href="tables.html#cb149-2"></a>starwars</span>
<span id="cb149-3"><a href="tables.html#cb149-3"></a><span class="co">## # A tibble: 87 x 13</span></span>
<span id="cb149-4"><a href="tables.html#cb149-4"></a><span class="co">##    name  height  mass hair_color skin_color eye_color birth_year gender</span></span>
<span id="cb149-5"><a href="tables.html#cb149-5"></a><span class="co">##    &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; </span></span>
<span id="cb149-6"><a href="tables.html#cb149-6"></a><span class="co">##  1 Luke…    172    77 blond      fair       blue            19   male  </span></span>
<span id="cb149-7"><a href="tables.html#cb149-7"></a><span class="co">##  2 C-3PO    167    75 &lt;NA&gt;       gold       yellow         112   &lt;NA&gt;  </span></span>
<span id="cb149-8"><a href="tables.html#cb149-8"></a><span class="co">##  3 R2-D2     96    32 &lt;NA&gt;       white, bl… red             33   &lt;NA&gt;  </span></span>
<span id="cb149-9"><a href="tables.html#cb149-9"></a><span class="co">##  4 Dart…    202   136 none       white      yellow          41.9 male  </span></span>
<span id="cb149-10"><a href="tables.html#cb149-10"></a><span class="co">##  5 Leia…    150    49 brown      light      brown           19   female</span></span>
<span id="cb149-11"><a href="tables.html#cb149-11"></a><span class="co">##  6 Owen…    178   120 brown, gr… light      blue            52   male  </span></span>
<span id="cb149-12"><a href="tables.html#cb149-12"></a><span class="co">##  7 Beru…    165    75 brown      light      blue            47   female</span></span>
<span id="cb149-13"><a href="tables.html#cb149-13"></a><span class="co">##  8 R5-D4     97    32 &lt;NA&gt;       white, red red             NA   &lt;NA&gt;  </span></span>
<span id="cb149-14"><a href="tables.html#cb149-14"></a><span class="co">##  9 Bigg…    183    84 black      light      brown           24   male  </span></span>
<span id="cb149-15"><a href="tables.html#cb149-15"></a><span class="co">## 10 Obi-…    182    77 auburn, w… fair       blue-gray       57   male  </span></span>
<span id="cb149-16"><a href="tables.html#cb149-16"></a><span class="co">## # … with 77 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,</span></span>
<span id="cb149-17"><a href="tables.html#cb149-17"></a><span class="co">## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</span></span></code></pre></div>
<blockquote>
<p>Обратите внимание, что после подключения набора данных он становится доступным в текущей сесси R именно с тем именем, с которым он сохранен в пакете</p>
</blockquote>
<p>Если вызвать функцию <code>data()</code> без параметров, будет выведен список данных со всех пакетов, которые подключены в текущей сессии R:</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="tables.html#cb150-1"></a><span class="kw">data</span>()</span></code></pre></div>
<div class="figure">
<img src="images/data.png" alt="" />
<p class="caption"><em>Данные, доступные в текущей сессии R</em></p>
</div>
<p>По умолчанию в RStudio всегда подключен пакет <em>datasets</em>, который устанавливается вместе с базовым дистрибутивом R. Если пакет подключен в текущую сессию, то можно получить набор данных по его имени, не указывая название пакета. Например, в пакете <em>datasets</em> есть набор данных <code>quakes</code> о землетрясениях на о. Фиджи:</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="tables.html#cb151-1"></a><span class="kw">data</span>(quakes)</span>
<span id="cb151-2"><a href="tables.html#cb151-2"></a><span class="kw">head</span>(quakes) <span class="co"># просмотрим макушку таблицы</span></span>
<span id="cb151-3"><a href="tables.html#cb151-3"></a><span class="co">##      lat   long depth mag stations</span></span>
<span id="cb151-4"><a href="tables.html#cb151-4"></a><span class="co">## 1 -20.42 181.62   562 4.8       41</span></span>
<span id="cb151-5"><a href="tables.html#cb151-5"></a><span class="co">## 2 -20.62 181.03   650 4.2       15</span></span>
<span id="cb151-6"><a href="tables.html#cb151-6"></a><span class="co">## 3 -26.00 184.10    42 5.4       43</span></span>
<span id="cb151-7"><a href="tables.html#cb151-7"></a><span class="co">## 4 -17.97 181.66   626 4.1       19</span></span>
<span id="cb151-8"><a href="tables.html#cb151-8"></a><span class="co">## 5 -20.42 181.96   649 4.0       11</span></span>
<span id="cb151-9"><a href="tables.html#cb151-9"></a><span class="co">## 6 -19.68 184.31   195 4.0       12</span></span></code></pre></div>
<p>Таким образом, если вы используйете пакет <code>dplyr</code> в своей программе, данные о героях Звездных Войн можно загрузить не указывая пакет, т.к. он был ранее подключен через функцию <code>library()</code>:</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="tables.html#cb152-1"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb152-2"><a href="tables.html#cb152-2"></a><span class="co">## </span></span>
<span id="cb152-3"><a href="tables.html#cb152-3"></a><span class="co">## Attaching package: &#39;dplyr&#39;</span></span>
<span id="cb152-4"><a href="tables.html#cb152-4"></a><span class="co">## The following objects are masked from &#39;package:stats&#39;:</span></span>
<span id="cb152-5"><a href="tables.html#cb152-5"></a><span class="co">## </span></span>
<span id="cb152-6"><a href="tables.html#cb152-6"></a><span class="co">##     filter, lag</span></span>
<span id="cb152-7"><a href="tables.html#cb152-7"></a><span class="co">## The following objects are masked from &#39;package:base&#39;:</span></span>
<span id="cb152-8"><a href="tables.html#cb152-8"></a><span class="co">## </span></span>
<span id="cb152-9"><a href="tables.html#cb152-9"></a><span class="co">##     intersect, setdiff, setequal, union</span></span>
<span id="cb152-10"><a href="tables.html#cb152-10"></a><span class="kw">data</span>(starwars)</span></code></pre></div>
</div>
<div id="tables_reading_text" class="section level3">
<h3><span class="header-section-number">3.3.2</span> Текстовые таблицы</h3>
<p>Текстовые таблицы бывают, как правило, двух типов: с разделителем (CSV) и с фиксированной шириной столбца.</p>
<div id="tables_reading_text_csv" class="section level4">
<h4><span class="header-section-number">3.3.2.1</span> Файлы с разделителем</h4>
<p><strong>CSV (Comma-separated value)</strong> — общее название для формата представления таблиц в виде текстовых файлов, организованных по следующему принципу:</p>
<ol style="list-style-type: decimal">
<li>Каждая строка в файле соответствует строке в таблице.</li>
<li>Ячейки отделяются друг от друга символом-разделителем.</li>
<li>Если ячейка пустая, то между соседними разделителями не должно быть никаких символов.</li>
</ol>
<p>Стандартным разделителем ячеек является запятая (<code>,</code>), а десятичным разделителем — точка (<code>.</code>). Однако это не является строгим правилом. Например, в ряде локалей (например, русской) запятая используется в качестве десятичного разделителя, поэтому колонки часто разделяют точкой с запятой (<code>;</code>).</p>
<p>Формат CSV никак не оговаривает наличие заголовочной строки с названиями столбцов в начале файла — она может как отсутствовать, так и присутствовать. Поэтому при чтении таблиц из файлов необходимо информировать программу о наличии заголовка путем указания соответствующего параметра.</p>
<blockquote>
<p>Любая функция, используемая вами для чтения файлов, вне зависимости от пакета, который вы используете, как правило, содержит параметры, с помощью которых можно задать символы, отвечающие за десятичный разделитель и разделитель столбцов, а также наличие или отсутствие строки-заголовка и кодировку файла. Если таблица читается некорректно, ознакомьтесь со справкой к функции и при необходимости замените стандартные значения этих параметров на те, что соответствуют формату вашей таблицы.</p>
</blockquote>
<p>Например, вот так выглядит текстовая таблица в формате CSV с данными по численности населения в Федеральных округах Российской Федерации за 2005 и 2010-2013 гг. (по данным Росстата):</p>
<pre><code>N,Region,Year05,Year10,Year11,Year12,Year13
1,Центральный,4341,3761,3613,3651,3570
2,Северо-Западный,3192,3088,2866,2877,2796
3,Южный федеральный,1409,1446,1436,1394,1321
4,Северо-Кавказский,496,390,397,395,374
5,Приволжский,3162,2883,2857,2854,2849
6,Уральский,1681,1860,1834,1665,1624
7,Сибирский,2575,2218,2142,2077,1941
8,Дальневосточный,871,870,821,765,713</code></pre>
<p>Таблицы в формате <strong>CSV</strong> можно прочесть как с помощью стандартных средств языка R, так и с помощью пакета <code>readr</code>, который входит в набор пакетов <em>tidyverse</em>. Мы будем использовать последние, а стандартные средства языка оставим на самостоятельное изучение.</p>
<p>Для чтения таблиц с разделителем в readr имеется несколько функций:</p>
<ul>
<li><code>read_csv()</code> читает файлы с разделителем запятой</li>
<li><code>read_csv2()</code> читайт файоы с разделителем точкой-с-запятой (может быть особенно актуально для русских файлов)</li>
<li><code>read_tsv()</code> читает файлы с разделителем табуляцией или пробелом</li>
<li><code>read_delim()</code> читает файлы с произвольным разделителем (указывается в качестве параметра)</li>
</ul>
<p>Вышеуказанный файл сохранен с разделителем запятой, поэтому мы можем прочесть его посредством первой функции из списка:</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="tables.html#cb154-1"></a><span class="kw">library</span>(readr)</span>
<span id="cb154-2"><a href="tables.html#cb154-2"></a>(<span class="dt">okruga =</span> <span class="kw">read_csv</span>(<span class="st">&#39;data/okruga.csv&#39;</span>))</span>
<span id="cb154-3"><a href="tables.html#cb154-3"></a><span class="co">## Parsed with column specification:</span></span>
<span id="cb154-4"><a href="tables.html#cb154-4"></a><span class="co">## cols(</span></span>
<span id="cb154-5"><a href="tables.html#cb154-5"></a><span class="co">##   `№` = col_double(),</span></span>
<span id="cb154-6"><a href="tables.html#cb154-6"></a><span class="co">##   Регион = col_character(),</span></span>
<span id="cb154-7"><a href="tables.html#cb154-7"></a><span class="co">##   `2005` = col_double(),</span></span>
<span id="cb154-8"><a href="tables.html#cb154-8"></a><span class="co">##   `2010` = col_double(),</span></span>
<span id="cb154-9"><a href="tables.html#cb154-9"></a><span class="co">##   `2011` = col_double(),</span></span>
<span id="cb154-10"><a href="tables.html#cb154-10"></a><span class="co">##   `2012` = col_double(),</span></span>
<span id="cb154-11"><a href="tables.html#cb154-11"></a><span class="co">##   `2013` = col_double()</span></span>
<span id="cb154-12"><a href="tables.html#cb154-12"></a><span class="co">## )</span></span>
<span id="cb154-13"><a href="tables.html#cb154-13"></a><span class="co">## # A tibble: 8 x 7</span></span>
<span id="cb154-14"><a href="tables.html#cb154-14"></a><span class="co">##     `№` Регион            `2005` `2010` `2011` `2012` `2013`</span></span>
<span id="cb154-15"><a href="tables.html#cb154-15"></a><span class="co">##   &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb154-16"><a href="tables.html#cb154-16"></a><span class="co">## 1     1 Центральный         4341   3761   3613   3651   3570</span></span>
<span id="cb154-17"><a href="tables.html#cb154-17"></a><span class="co">## 2     2 Северо-Западный     3192   3088   2866   2877   2796</span></span>
<span id="cb154-18"><a href="tables.html#cb154-18"></a><span class="co">## 3     3 Южный федеральный   1409   1446   1436   1394   1321</span></span>
<span id="cb154-19"><a href="tables.html#cb154-19"></a><span class="co">## 4     4 Северо-Кавказский    496    390    397    395    374</span></span>
<span id="cb154-20"><a href="tables.html#cb154-20"></a><span class="co">## 5     5 Приволжский         3162   2883   2857   2854   2849</span></span>
<span id="cb154-21"><a href="tables.html#cb154-21"></a><span class="co">## 6     6 Уральский           1681   1860   1834   1665   1624</span></span>
<span id="cb154-22"><a href="tables.html#cb154-22"></a><span class="co">## 7     7 Сибирский           2575   2218   2142   2077   1941</span></span>
<span id="cb154-23"><a href="tables.html#cb154-23"></a><span class="co">## 8     8 Дальневосточный      871    870    821    765    713</span></span></code></pre></div>
<p>Как видно, функции пакета <code>readr</code> выдают диагностическую информацию о том, к какому типу были приведены столбцы таблицы при чтении. Помимо этого, первая строка была использована в качестве заголовочной.</p>
</div>
<div id="tables-reading-text-fwf" class="section level4">
<h4><span class="header-section-number">3.3.2.2</span> Файлы с фиксированной шириной столбца</h4>
<p>В файлах с фиксированной шириной на каждый столбец резервируется определенное количество символов. При этом данные выравниваются по правому краю, а короткие строки отбиваются слева пробелами. Такой формат часто используется в численных моделях (например, метеорологических) для представления входных данных или результатов расчетов. Например, файл ниже содержит данные об энергии ветра (<span class="math inline">\(Вт/м^2\)</span>) на высотах 50 и 110 м по точкам вдоль побережья Черного моря<!-- TODO: Дать ссылку на статью -->:</p>
<pre><code>           1   43.500000       28.000000       111.05298       178.41447    
           2   43.500000       28.500000       187.38620       301.05331    
           3   44.000000       28.500000       168.82031       271.22421    
           4   44.500000       28.500000       157.22586       252.59746    
           5   44.500000       29.000000       189.46452       304.39597    
           6   45.000000       29.000000       170.40709       273.77536    
           7   45.000000       29.500000       198.92389       319.58777    
           8   45.500000       29.500000       188.64406       303.07242    
           9   46.000000       30.000000       180.10541       289.35379    
          10   46.000000       30.500000       207.91818       334.03564</code></pre>
<p>Для чтения таких файлов в <strong>readr</strong> есть функции:</p>
<ul>
<li><code>read_fwf()</code> читает файлы с фиксированной шириной столбца, позволяя задавать ширины столбцов (через <code>fwf_widths()</code>) или начальные позиции каждого столбца (через <code>fwf_positions()</code>)</li>
<li><code>read_table()</code> читает наиболее распространенный вариант файла с фиксированной шириной столбца, в котором колонки разделены пробелами. Позиции столбцов определяются автоматически, что очень удобно.</li>
</ul>
<p>Прочитаем вышеприведенный файл с данными о ветровой энергии:</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="tables.html#cb156-1"></a>(<span class="dt">wenergy =</span> <span class="kw">read_table</span>(<span class="st">&#39;data/wind_energy.txt&#39;</span>, <span class="dt">col_names =</span> <span class="kw">c</span>(<span class="st">&#39;id&#39;</span>, <span class="st">&#39;lat&#39;</span>, <span class="st">&#39;lon&#39;</span>, <span class="st">&#39;energy50&#39;</span>, <span class="st">&#39;energy110&#39;</span>)))</span>
<span id="cb156-2"><a href="tables.html#cb156-2"></a><span class="co">## Parsed with column specification:</span></span>
<span id="cb156-3"><a href="tables.html#cb156-3"></a><span class="co">## cols(</span></span>
<span id="cb156-4"><a href="tables.html#cb156-4"></a><span class="co">##   id = col_double(),</span></span>
<span id="cb156-5"><a href="tables.html#cb156-5"></a><span class="co">##   lat = col_double(),</span></span>
<span id="cb156-6"><a href="tables.html#cb156-6"></a><span class="co">##   lon = col_double(),</span></span>
<span id="cb156-7"><a href="tables.html#cb156-7"></a><span class="co">##   energy50 = col_double(),</span></span>
<span id="cb156-8"><a href="tables.html#cb156-8"></a><span class="co">##   energy110 = col_double()</span></span>
<span id="cb156-9"><a href="tables.html#cb156-9"></a><span class="co">## )</span></span>
<span id="cb156-10"><a href="tables.html#cb156-10"></a><span class="co">## # A tibble: 92 x 5</span></span>
<span id="cb156-11"><a href="tables.html#cb156-11"></a><span class="co">##       id   lat   lon energy50 energy110</span></span>
<span id="cb156-12"><a href="tables.html#cb156-12"></a><span class="co">##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb156-13"><a href="tables.html#cb156-13"></a><span class="co">##  1     1  43.5  28       111.      178.</span></span>
<span id="cb156-14"><a href="tables.html#cb156-14"></a><span class="co">##  2     2  43.5  28.5     187.      301.</span></span>
<span id="cb156-15"><a href="tables.html#cb156-15"></a><span class="co">##  3     3  44    28.5     169.      271.</span></span>
<span id="cb156-16"><a href="tables.html#cb156-16"></a><span class="co">##  4     4  44.5  28.5     157.      253.</span></span>
<span id="cb156-17"><a href="tables.html#cb156-17"></a><span class="co">##  5     5  44.5  29       189.      304.</span></span>
<span id="cb156-18"><a href="tables.html#cb156-18"></a><span class="co">##  6     6  45    29       170.      274.</span></span>
<span id="cb156-19"><a href="tables.html#cb156-19"></a><span class="co">##  7     7  45    29.5     199.      320.</span></span>
<span id="cb156-20"><a href="tables.html#cb156-20"></a><span class="co">##  8     8  45.5  29.5     189.      303.</span></span>
<span id="cb156-21"><a href="tables.html#cb156-21"></a><span class="co">##  9     9  46    30       180.      289.</span></span>
<span id="cb156-22"><a href="tables.html#cb156-22"></a><span class="co">## 10    10  46    30.5     208.      334.</span></span>
<span id="cb156-23"><a href="tables.html#cb156-23"></a><span class="co">## # … with 82 more rows</span></span></code></pre></div>
</div>
</div>
<div id="tables_reading_excel" class="section level3">
<h3><span class="header-section-number">3.3.3</span> Таблицы Microsoft Excel</h3>
<p>Для чтения таблиц Microsoft Excel, так же как и для текcтовых файлов, существуют множество пакетов, таких как <a href="https://cran.r-project.org/web/packages/xlsx/index.html">xlsx</a>, <a href="https://cran.r-project.org/web/packages/openxlsx/index.html">openxlsx</a> и <a href="https://cran.r-project.org/web/packages/readxl/index.html">readxl</a>.</p>
<p>D настоящем курсе мы будем пользоваться пакетом <strong>readxl</strong>, поскольку он не имеет внешних зависимостей, а его функции концептуально идентичны функциям пакета <strong>readr</strong>. Прочтем данные о лесовосстановлении (в тысяч га), полученные из регионального ежегодника Росстата за 2017 год. Эта таблица содержит колонку с названием субъекта и еще 8 колонок с данными по годам. Поскольку в таблице есть пропущенные значения, необходимо определить типы столбцов (в противном случае они могут быть определены как текстовые):</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="tables.html#cb157-1"></a><span class="kw">library</span>(readxl)</span>
<span id="cb157-2"><a href="tables.html#cb157-2"></a>(<span class="dt">reforest =</span> <span class="kw">read_excel</span>(<span class="st">&#39;data/reforest.xlsx&#39;</span>, </span>
<span id="cb157-3"><a href="tables.html#cb157-3"></a>                       <span class="dt">col_types =</span> <span class="kw">c</span>(<span class="st">&#39;text&#39;</span>, <span class="kw">rep</span>(<span class="st">&#39;numeric&#39;</span>, <span class="dv">8</span>))))</span>
<span id="cb157-4"><a href="tables.html#cb157-4"></a><span class="co">## # A tibble: 89 x 9</span></span>
<span id="cb157-5"><a href="tables.html#cb157-5"></a><span class="co">##    Region                `2005` `2010` `2011` `2012` `2013` `2014` `2015` `2016`</span></span>
<span id="cb157-6"><a href="tables.html#cb157-6"></a><span class="co">##    &lt;chr&gt;                  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb157-7"><a href="tables.html#cb157-7"></a><span class="co">##  1 Российская Федерация   812.   812.   860    842.   872.   863    803.   840. </span></span>
<span id="cb157-8"><a href="tables.html#cb157-8"></a><span class="co">##  2 Центральный федераль…   52.6   62.7   60.9   60.3   70.9   71.2   72.6   77  </span></span>
<span id="cb157-9"><a href="tables.html#cb157-9"></a><span class="co">##  3 Белгородская область     0.4    0.1    0.3    0.3    0.4    0.4    0.2    0.2</span></span>
<span id="cb157-10"><a href="tables.html#cb157-10"></a><span class="co">##  4 Брянская область         2.9    2.8    3      3.2    3.5    3.3    3.1    3  </span></span>
<span id="cb157-11"><a href="tables.html#cb157-11"></a><span class="co">##  5 Владимирская область     4.4    5.3    5.7    6      7.1    5.9    6      4.9</span></span>
<span id="cb157-12"><a href="tables.html#cb157-12"></a><span class="co">##  6 Воронежская область      1.1    1.1    1.8    3      2.7    2.7    2.6    2.3</span></span>
<span id="cb157-13"><a href="tables.html#cb157-13"></a><span class="co">##  7 Ивановская область       2.1    1.6    2.2    3.1    4      4.8    4.6    4.2</span></span>
<span id="cb157-14"><a href="tables.html#cb157-14"></a><span class="co">##  8 Калужская область        2.2    2.3    2.3    2.5    2.4    3.1    3.2    3.2</span></span>
<span id="cb157-15"><a href="tables.html#cb157-15"></a><span class="co">##  9 Костромская область     10     25.2   11     11.8   15.3   13.6   15.1   16.4</span></span>
<span id="cb157-16"><a href="tables.html#cb157-16"></a><span class="co">## 10 Курская область          0.5    0.3    0.4    0.6    0.6    0.6    0.5    0.4</span></span>
<span id="cb157-17"><a href="tables.html#cb157-17"></a><span class="co">## # … with 79 more rows</span></span></code></pre></div>
</div>
<div id="tables_reading_params" class="section level3">
<h3><span class="header-section-number">3.3.4</span> Параметры</h3>
<p>Функции пакетов <code>readr</code> и <code>readxl</code> имеют идентичный набор параметров, позволяющих управлять процедурой чтения данных (многоточие используется вместо перечисления параметров):</p>
<ul>
<li><code>skip = n</code> позволяет пропустить первые n строк таблицы (например, если в них содержатся какие-то комментарии)</li>
<li><code>col_names = FALSE</code> позволяет не интерпретировать первую строку как заголовочную (вместо этого она будет читаться как строка с данными)</li>
<li><code>col_names = c(...)</code> позволяет задать имена столбцов (удобно, если в файле они длинные)</li>
<li><code>col_types = cols(...)</code> позволяет задать типы столбцов (необходимо, если функция неправильно определяет их сама)</li>
<li><code>na = '-'</code> позволяет указать символ, который используется для указания пропущенных значений (в данном случае указан прочерк-дефис)</li>
<li><code>locale = locale(...)</code> управляет локалью (в том числе позволяет указать кодировку файла)</li>
</ul>
<blockquote>
<p><strong>Стандартной кодировкой для представления текста</strong> в UNIX-подобных системах (<em>Ubuntu</em>, <em>macOS</em> и т.д.) является <strong>UTF-8 (Unicode)</strong>, в русскоязычных версиях <em>Windows</em> — <strong>CP1251 (Windows-1251)</strong>. Текстовый файл <strong>CSV</strong>, созданный в разных операционных системах, будет по умолчанию сохраняться в соответствующей кодировке, если вы не указали ее явным образом. Если при загрузке таблицы в <strong>R</strong> вы видите вместо текста нечитаемые символы — <em>кракозябры</em> — то, скорее всего, вы читаете файл не в той кодировке, в которой он был сохранен. Если вы не знаете, что такое кодировка и Юникод, то вам <a href="https://ru.wikipedia.org/wiki/Набор_символов">сюда</a></p>
</blockquote>
<p>По умолчанию файлы читаются в той кодировке, которая соответствует операционной системе, на которой запущен R. Если файл создан в другой кодировке, придется указать ее при чтении. Например, вы пользуетесь macOS (UTF-8), а ваш коллега — Windows (CP1251), то для чтения созданного им файла вам, скорее всего, понадобится указать что-то вроде <code>locale = locale(encoding = 'CP1251')</code></p>
</div>
</div>
<div id="tables_view" class="section level2">
<h2><span class="header-section-number">3.4</span> Просмотр</h2>
<p>Для просмотра фрейма данных в консоли <strong>RStudio</strong> вы можете использовать несколько опций. Пусть наш фрейм данных называется <code>reforest</code>. Тогда:</p>
<ol style="list-style-type: decimal">
<li><code>print(reforest)</code> — выводит фрейм в консоль целиком (можно написать просто <code>tab</code> в консоли).</li>
<li><code>head(reforest, n)</code> — отбирает первые <span class="math inline">\(n\)</span> строк фрейма</li>
<li><code>tail(reforest, n)</code> — отбирает последние <span class="math inline">\(n\)</span> строк фрейма</li>
</ol>
<p>По умолчанию для функций <code>head()</code> и <code>tail()</code> <span class="math inline">\(n=6\)</span>. Обычно этот параметр опускают, поскольку нужно просмотреть только первые несколько строк и шести вполне достаточно. Если вы напечатаете в консоли <code>head(reforest)</code> или <code>tail(reforest)</code>, то для выбранных строк будет вызвана функция <code>print()</code>, аналогично выводу всего фрейма:</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="tables.html#cb158-1"></a><span class="co"># ПРОСМОТР ТАБЛИЦЫ</span></span>
<span id="cb158-2"><a href="tables.html#cb158-2"></a><span class="kw">print</span>(reforest)</span>
<span id="cb158-3"><a href="tables.html#cb158-3"></a><span class="co">## # A tibble: 89 x 9</span></span>
<span id="cb158-4"><a href="tables.html#cb158-4"></a><span class="co">##    Region                `2005` `2010` `2011` `2012` `2013` `2014` `2015` `2016`</span></span>
<span id="cb158-5"><a href="tables.html#cb158-5"></a><span class="co">##    &lt;chr&gt;                  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb158-6"><a href="tables.html#cb158-6"></a><span class="co">##  1 Российская Федерация   812.   812.   860    842.   872.   863    803.   840. </span></span>
<span id="cb158-7"><a href="tables.html#cb158-7"></a><span class="co">##  2 Центральный федераль…   52.6   62.7   60.9   60.3   70.9   71.2   72.6   77  </span></span>
<span id="cb158-8"><a href="tables.html#cb158-8"></a><span class="co">##  3 Белгородская область     0.4    0.1    0.3    0.3    0.4    0.4    0.2    0.2</span></span>
<span id="cb158-9"><a href="tables.html#cb158-9"></a><span class="co">##  4 Брянская область         2.9    2.8    3      3.2    3.5    3.3    3.1    3  </span></span>
<span id="cb158-10"><a href="tables.html#cb158-10"></a><span class="co">##  5 Владимирская область     4.4    5.3    5.7    6      7.1    5.9    6      4.9</span></span>
<span id="cb158-11"><a href="tables.html#cb158-11"></a><span class="co">##  6 Воронежская область      1.1    1.1    1.8    3      2.7    2.7    2.6    2.3</span></span>
<span id="cb158-12"><a href="tables.html#cb158-12"></a><span class="co">##  7 Ивановская область       2.1    1.6    2.2    3.1    4      4.8    4.6    4.2</span></span>
<span id="cb158-13"><a href="tables.html#cb158-13"></a><span class="co">##  8 Калужская область        2.2    2.3    2.3    2.5    2.4    3.1    3.2    3.2</span></span>
<span id="cb158-14"><a href="tables.html#cb158-14"></a><span class="co">##  9 Костромская область     10     25.2   11     11.8   15.3   13.6   15.1   16.4</span></span>
<span id="cb158-15"><a href="tables.html#cb158-15"></a><span class="co">## 10 Курская область          0.5    0.3    0.4    0.6    0.6    0.6    0.5    0.4</span></span>
<span id="cb158-16"><a href="tables.html#cb158-16"></a><span class="co">## # … with 79 more rows</span></span>
<span id="cb158-17"><a href="tables.html#cb158-17"></a><span class="kw">head</span>(reforest)</span>
<span id="cb158-18"><a href="tables.html#cb158-18"></a><span class="co">## # A tibble: 6 x 9</span></span>
<span id="cb158-19"><a href="tables.html#cb158-19"></a><span class="co">##   Region                 `2005` `2010` `2011` `2012` `2013` `2014` `2015` `2016`</span></span>
<span id="cb158-20"><a href="tables.html#cb158-20"></a><span class="co">##   &lt;chr&gt;                   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb158-21"><a href="tables.html#cb158-21"></a><span class="co">## 1 Российская Федерация    812.   812.   860    842.   872.   863    803.   840. </span></span>
<span id="cb158-22"><a href="tables.html#cb158-22"></a><span class="co">## 2 Центральный федеральн…   52.6   62.7   60.9   60.3   70.9   71.2   72.6   77  </span></span>
<span id="cb158-23"><a href="tables.html#cb158-23"></a><span class="co">## 3 Белгородская область      0.4    0.1    0.3    0.3    0.4    0.4    0.2    0.2</span></span>
<span id="cb158-24"><a href="tables.html#cb158-24"></a><span class="co">## 4 Брянская область          2.9    2.8    3      3.2    3.5    3.3    3.1    3  </span></span>
<span id="cb158-25"><a href="tables.html#cb158-25"></a><span class="co">## 5 Владимирская область      4.4    5.3    5.7    6      7.1    5.9    6      4.9</span></span>
<span id="cb158-26"><a href="tables.html#cb158-26"></a><span class="co">## 6 Воронежская область       1.1    1.1    1.8    3      2.7    2.7    2.6    2.3</span></span>
<span id="cb158-27"><a href="tables.html#cb158-27"></a><span class="kw">tail</span>(reforest)</span>
<span id="cb158-28"><a href="tables.html#cb158-28"></a><span class="co">## # A tibble: 6 x 9</span></span>
<span id="cb158-29"><a href="tables.html#cb158-29"></a><span class="co">##   Region                 `2005` `2010` `2011` `2012` `2013` `2014` `2015` `2016`</span></span>
<span id="cb158-30"><a href="tables.html#cb158-30"></a><span class="co">##   &lt;chr&gt;                   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb158-31"><a href="tables.html#cb158-31"></a><span class="co">## 1 Хабаровский край        107.    70.2   68.7   67.2   58.4   50.5   59.6   60.3</span></span>
<span id="cb158-32"><a href="tables.html#cb158-32"></a><span class="co">## 2 Амурская область         33.3   29.8   32.2   33.6   35.5   37.7   28.5   27.7</span></span>
<span id="cb158-33"><a href="tables.html#cb158-33"></a><span class="co">## 3 Магаданская область       2.7    2.6    2.6    2.8    3      2.5    0.4   NA  </span></span>
<span id="cb158-34"><a href="tables.html#cb158-34"></a><span class="co">## 4 Сахалинская область      13.1   12.7   12.5    4.6    4.7    4.9    4.7    4.1</span></span>
<span id="cb158-35"><a href="tables.html#cb158-35"></a><span class="co">## 5 Еврейская автономная …    2.9   NA      2.6    2.5    2.3   NA     NA      2.4</span></span>
<span id="cb158-36"><a href="tables.html#cb158-36"></a><span class="co">## 6 Чукотский автономный …    0.3   NA     NA     NA     NA     NA     NA     NA</span></span></code></pre></div>
<p><code>RStudio</code> предоставляет графический интерфейс для просмотра таблиц, в котором таблицу можно сортировать и фильтровать. Чтобы его активировать, надо вызвать функцию <code>View()</code>:</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="tables.html#cb159-1"></a><span class="kw">View</span>(tab)</span></code></pre></div>
<p>Поскольку функции <code>head()</code> и <code>tail()</code> возвращают строки с хвоста или начала фрейма данных, их можно и подать на вход функции <code>View()</code>:</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="tables.html#cb160-1"></a><span class="kw">View</span>(<span class="kw">head</span>(reforest, <span class="dv">3</span>))</span></code></pre></div>
<blockquote>
<p><strong>Как правило, не следует оставлять вызовы функции <code>View()</code> в тексте законченной программы.</strong> Это приведет к тому, что при запуске будут открываться новые вкладки с просмотром таблиц, что может раздражать пользователя (в том числе и вас самих). Используйте <code>View()</code> для вывода окончательного результата в конце программы или при отладке программы. Все вызовы <code>View()</code> в программе можно легко закомментировать или раскомментировать, выполнив поиск с заменой <code>'View('</code> на <code>'# View('</code> и наоборот.</p>
</blockquote>
</div>
<div id="tables_elements" class="section level2">
<h2><span class="header-section-number">3.5</span> Столбцы, строки и ячейки</h2>
<div id="tables_elements_names" class="section level3">
<h3><span class="header-section-number">3.5.1</span> Названия</h3>
<p>Столбцы, строки и ячейк представляют собой основные структурные элементы фрейма данных или тиббла. Перед тем как мы поднимемся на уровень выше и рассмотрим обобщенные операции преобразования таблиц, необходимо посмотреть, как извлекать структурные элементы таблиц.</p>
<p>Столбцы и строки таблицы имеют названия, которые можно читать и записывать с помощью функций <code>colnames()</code> и <code>rownames()</code>:</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="tables.html#cb161-1"></a><span class="co"># Чтение названий столбцов и строк</span></span>
<span id="cb161-2"><a href="tables.html#cb161-2"></a><span class="kw">colnames</span>(okruga)</span>
<span id="cb161-3"><a href="tables.html#cb161-3"></a><span class="co">## [1] &quot;№&quot;      &quot;Регион&quot; &quot;2005&quot;   &quot;2010&quot;   &quot;2011&quot;   &quot;2012&quot;   &quot;2013&quot;</span></span>
<span id="cb161-4"><a href="tables.html#cb161-4"></a><span class="kw">rownames</span>(okruga)</span>
<span id="cb161-5"><a href="tables.html#cb161-5"></a><span class="co">## [1] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; &quot;5&quot; &quot;6&quot; &quot;7&quot; &quot;8&quot;</span></span>
<span id="cb161-6"><a href="tables.html#cb161-6"></a></span>
<span id="cb161-7"><a href="tables.html#cb161-7"></a><span class="co"># Замена названий столбцов и строк</span></span>
<span id="cb161-8"><a href="tables.html#cb161-8"></a><span class="kw">colnames</span>(okruga) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;N&quot;</span>, <span class="st">&quot;Region&quot;</span>, <span class="st">&quot;Year05&quot;</span>, <span class="st">&quot;Year10&quot;</span>, <span class="st">&quot;Year11&quot;</span>, <span class="st">&quot;Year12&quot;</span>, <span class="st">&quot;Year13&quot;</span>)</span>
<span id="cb161-9"><a href="tables.html#cb161-9"></a><span class="kw">print</span>(okruga)</span>
<span id="cb161-10"><a href="tables.html#cb161-10"></a><span class="co">## # A tibble: 8 x 7</span></span>
<span id="cb161-11"><a href="tables.html#cb161-11"></a><span class="co">##       N Region            Year05 Year10 Year11 Year12 Year13</span></span>
<span id="cb161-12"><a href="tables.html#cb161-12"></a><span class="co">##   &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb161-13"><a href="tables.html#cb161-13"></a><span class="co">## 1     1 Центральный         4341   3761   3613   3651   3570</span></span>
<span id="cb161-14"><a href="tables.html#cb161-14"></a><span class="co">## 2     2 Северо-Западный     3192   3088   2866   2877   2796</span></span>
<span id="cb161-15"><a href="tables.html#cb161-15"></a><span class="co">## 3     3 Южный федеральный   1409   1446   1436   1394   1321</span></span>
<span id="cb161-16"><a href="tables.html#cb161-16"></a><span class="co">## 4     4 Северо-Кавказский    496    390    397    395    374</span></span>
<span id="cb161-17"><a href="tables.html#cb161-17"></a><span class="co">## 5     5 Приволжский         3162   2883   2857   2854   2849</span></span>
<span id="cb161-18"><a href="tables.html#cb161-18"></a><span class="co">## 6     6 Уральский           1681   1860   1834   1665   1624</span></span>
<span id="cb161-19"><a href="tables.html#cb161-19"></a><span class="co">## 7     7 Сибирский           2575   2218   2142   2077   1941</span></span>
<span id="cb161-20"><a href="tables.html#cb161-20"></a><span class="co">## 8     8 Дальневосточный      871    870    821    765    713</span></span></code></pre></div>
<p>Названия строк редко заменяются, поскольку с точки зрения реляционной алгебры большого смысла они не имеют.</p>
</div>
<div id="tables_elements_columns" class="section level3">
<h3><span class="header-section-number">3.5.2</span> Обращение к столбцам</h3>
<p>К столбцу можно обращаться по номеру и названию (с помощью оператора <code>$</code> или в кавычках внутри скобок). Если вы указываете в квадратных скобках номер без запятой, он трактуется именно как номер столбца, а не строки. Тип возвращаемого значения зависит от синтаксиса:</p>
<ul>
<li>обращение через <code>$</code> возвращает вектор;</li>
<li>обращение в скобках с запятой к одному столбцу возвращает вектор;</li>
<li>обращение в скобках с запятой к нескольким столбцам возвращает фрейм данных;</li>
<li>обращение в скобках без запятой возвращает фрейм данных.</li>
</ul>
<p>Несколько примеров:</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="tables.html#cb162-1"></a><span class="co"># Один столбец - результат зависит от запятой</span></span>
<span id="cb162-2"><a href="tables.html#cb162-2"></a>okruga<span class="op">$</span>Year05      <span class="co"># столбец в виде вектора</span></span>
<span id="cb162-3"><a href="tables.html#cb162-3"></a>okruga[, <span class="st">&quot;Year05&quot;</span>] <span class="co"># столбец в виде вектора</span></span>
<span id="cb162-4"><a href="tables.html#cb162-4"></a>okruga[, <span class="dv">2</span>]        <span class="co"># столбец в виде вектора</span></span>
<span id="cb162-5"><a href="tables.html#cb162-5"></a></span>
<span id="cb162-6"><a href="tables.html#cb162-6"></a>okruga[<span class="st">&quot;Year05&quot;</span>] <span class="co"># столбец в виде фрейма данных/тиббла</span></span>
<span id="cb162-7"><a href="tables.html#cb162-7"></a>okruga[<span class="dv">2</span>]        <span class="co"># столбец в виде фрейма данных/тиббла</span></span>
<span id="cb162-8"><a href="tables.html#cb162-8"></a></span>
<span id="cb162-9"><a href="tables.html#cb162-9"></a><span class="co"># Несколько столбцов - всегда фрейм данных/тиббл</span></span>
<span id="cb162-10"><a href="tables.html#cb162-10"></a>okruga[, <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">4</span>)]</span>
<span id="cb162-11"><a href="tables.html#cb162-11"></a>okruga[, <span class="kw">c</span>(<span class="st">&quot;Region&quot;</span>, <span class="st">&quot;Year11&quot;</span>)]</span>
<span id="cb162-12"><a href="tables.html#cb162-12"></a>okruga[<span class="kw">c</span>(<span class="st">&quot;Region&quot;</span>, <span class="st">&quot;Year11&quot;</span>)]</span>
<span id="cb162-13"><a href="tables.html#cb162-13"></a>okruga[<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">4</span>)]</span></code></pre></div>
</div>
<div id="tables_elements_rows" class="section level3">
<h3><span class="header-section-number">3.5.3</span> Обращение к строкам</h3>
<p>Обращаться к строкам можно по их номерам. В этом случае в качестве индекса можно передать номер (номера) интересующих строк, либо вектор логических значений, в котором интересующие строки помечены как TRUE, а остальные — FALSE (в этом случае длина вектора должна равняться количеству строк в таблице):</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="tables.html#cb163-1"></a>okruga[<span class="dv">5</span>, ] <span class="co"># Одна строка</span></span>
<span id="cb163-2"><a href="tables.html#cb163-2"></a>okruga[<span class="dv">2</span><span class="op">:</span><span class="dv">4</span>, ] <span class="co"># Несколько строк</span></span>
<span id="cb163-3"><a href="tables.html#cb163-3"></a>okruga[okruga<span class="op">$</span>Year10 <span class="op">&gt;</span><span class="st"> </span><span class="dv">2000</span>, ] <span class="co"># Несколько строк через TRUE/FALSE</span></span></code></pre></div>
<blockquote>
<p>В отличие от работы со столбцами, выбор строк всегда возвращает таблицу (фрейм или тиббл).</p>
</blockquote>
</div>
<div id="tables_elements_cells" class="section level3">
<h3><span class="header-section-number">3.5.4</span> Обращение к ячейкам</h3>
<p>Чтобы выбрать конкретные ячейки в таблице, необходимо задать оба измерения:</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="tables.html#cb164-1"></a>okruga[<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>, <span class="kw">c</span>(<span class="st">&quot;Year11&quot;</span>, <span class="st">&quot;Year12&quot;</span>)]</span>
<span id="cb164-2"><a href="tables.html#cb164-2"></a><span class="co">## # A tibble: 2 x 2</span></span>
<span id="cb164-3"><a href="tables.html#cb164-3"></a><span class="co">##   Year11 Year12</span></span>
<span id="cb164-4"><a href="tables.html#cb164-4"></a><span class="co">##    &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb164-5"><a href="tables.html#cb164-5"></a><span class="co">## 1   2866   2877</span></span>
<span id="cb164-6"><a href="tables.html#cb164-6"></a><span class="co">## 2   1436   1394</span></span></code></pre></div>
<p>Обратите внимание на то, что при этом возвращаются все комбинации строк и столбцов. То есть, нельзя выбрать ячейки <code>2,"Year11"</code> и <code>3,"Year2"</code> — вместе с ними также будут выбраны ячейки <code>3,"Year11"</code> и <code>2,"Year2"</code>. Впрочем, подобные задачи возникают довольно редко</p>
</div>
</div>
<div id="tables_manipuilations" class="section level2">
<h2><span class="header-section-number">3.6</span> Преобразования</h2>
<div id="tables_manipiulations_grammar" class="section level3">
<h3><span class="header-section-number">3.6.1</span> Грамматика манипуляций</h3>
<p>Если проанализировать наиболее типичные манипуляции, которые осуществляются над таблицами, то их окажется совсем немного. К таким манипуляциям относятся выбор переменных, фильтрация строк, сортировка, вычисление новых столбцов, агрегирующие статистики и группировка.</p>
<p>Все эти задачи можно решать стандартными средствами R (и мы увидим, как это делается). Однако некоторые из них достаточно громоздки в реализации (например, группировка). К счастью, экосистема R предлагает готовые средства, позволяющие справляться с подобными задачами простым и элегантным путем. Эти средства предоставляет пакет <a href="https://dplyr.tidyverse.org"><strong>dplyr</strong></a> (произносится как <em>deep liar</em> — ‘диплáйер’), входящий в набор инструментов <a href="https://www.tidyverse.org">tidyverse</a>.</p>
<p>В основе конецепции <strong>dplyr</strong> лежит понятие о грамматике табличных манипуляций, которая включает в себя ограниченное число наиболее используемых операций, а также ряд вспомогательных функций.</p>
<p>Основные функции пакета <strong>dplyr</strong> представлены в таблице ниже:</p>
<table>
<thead>
<tr class="header">
<th>Функция</th>
<th>Назначение</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>select()</code></td>
<td>Выбор переменных по их названиям</td>
</tr>
<tr class="even">
<td><code>filter()</code></td>
<td>Выбор строк по заданному критерию (запросу)</td>
</tr>
<tr class="odd">
<td><code>arrange()</code></td>
<td>Упорядочение по указанным переменным</td>
</tr>
<tr class="even">
<td><code>mutate()</code></td>
<td>Вычисление новых переменных (мутирование)</td>
</tr>
<tr class="odd">
<td><code>summarise()</code></td>
<td>Агрегирование значений переменных</td>
</tr>
<tr class="even">
<td><code>group_by()</code></td>
<td>Группировка строк (для последующего агрегирования)</td>
</tr>
</tbody>
</table>
<p>Как можно видеть, этих функций совсем немного. Дополнительно к ним пакет <strong>dplyr</strong> содержит еще множество вспомогательных функций, которые применяются при выполнении основных манипуляций.</p>
<p>Рассмотрим применение этих функций на примере работы с таблицей по восстановлению лесного фонда в регионах России. Для начала переименуем столбцы с годами, чтобы их названия начинались с буквы <code>y</code>:</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="tables.html#cb165-1"></a>old_names =<span class="st"> </span><span class="kw">colnames</span>(reforest)</span>
<span id="cb165-2"><a href="tables.html#cb165-2"></a><span class="kw">colnames</span>(reforest) =<span class="st"> </span><span class="kw">c</span>(old_names[<span class="dv">1</span>], <span class="kw">paste</span>(<span class="st">&#39;y&#39;</span>, old_names[<span class="dv">2</span><span class="op">:</span><span class="dv">9</span>], <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>))</span></code></pre></div>
<p>Начнем с <strong>выбора</strong> нужных переменных, используя <code>select()</code>. Оставим только название региона и данные за 2010 и 2015 гг:</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="tables.html#cb166-1"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb166-2"><a href="tables.html#cb166-2"></a>(<span class="dt">rdf =</span> <span class="kw">select</span>(reforest, Region, y2010, y2015))</span>
<span id="cb166-3"><a href="tables.html#cb166-3"></a><span class="co">## # A tibble: 89 x 3</span></span>
<span id="cb166-4"><a href="tables.html#cb166-4"></a><span class="co">##    Region                        y2010 y2015</span></span>
<span id="cb166-5"><a href="tables.html#cb166-5"></a><span class="co">##    &lt;chr&gt;                         &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb166-6"><a href="tables.html#cb166-6"></a><span class="co">##  1 Российская Федерация          812.  803. </span></span>
<span id="cb166-7"><a href="tables.html#cb166-7"></a><span class="co">##  2 Центральный федеральный округ  62.7  72.6</span></span>
<span id="cb166-8"><a href="tables.html#cb166-8"></a><span class="co">##  3 Белгородская область            0.1   0.2</span></span>
<span id="cb166-9"><a href="tables.html#cb166-9"></a><span class="co">##  4 Брянская область                2.8   3.1</span></span>
<span id="cb166-10"><a href="tables.html#cb166-10"></a><span class="co">##  5 Владимирская область            5.3   6  </span></span>
<span id="cb166-11"><a href="tables.html#cb166-11"></a><span class="co">##  6 Воронежская область             1.1   2.6</span></span>
<span id="cb166-12"><a href="tables.html#cb166-12"></a><span class="co">##  7 Ивановская область              1.6   4.6</span></span>
<span id="cb166-13"><a href="tables.html#cb166-13"></a><span class="co">##  8 Калужская область               2.3   3.2</span></span>
<span id="cb166-14"><a href="tables.html#cb166-14"></a><span class="co">##  9 Костромская область            25.2  15.1</span></span>
<span id="cb166-15"><a href="tables.html#cb166-15"></a><span class="co">## 10 Курская область                 0.3   0.5</span></span>
<span id="cb166-16"><a href="tables.html#cb166-16"></a><span class="co">## # … with 79 more rows</span></span></code></pre></div>
<p>Ту же самую задачу можно решить от противного — указать со знаком <code>-</code> те столбцы, которые надо убрать:</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="tables.html#cb167-1"></a>(<span class="dt">rdf =</span> <span class="kw">select</span>(reforest, <span class="op">-</span>y2005, <span class="op">-</span>y2011<span class="op">:-</span>y2014, <span class="op">-</span>y2016))</span>
<span id="cb167-2"><a href="tables.html#cb167-2"></a><span class="co">## # A tibble: 89 x 3</span></span>
<span id="cb167-3"><a href="tables.html#cb167-3"></a><span class="co">##    Region                        y2010 y2015</span></span>
<span id="cb167-4"><a href="tables.html#cb167-4"></a><span class="co">##    &lt;chr&gt;                         &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb167-5"><a href="tables.html#cb167-5"></a><span class="co">##  1 Российская Федерация          812.  803. </span></span>
<span id="cb167-6"><a href="tables.html#cb167-6"></a><span class="co">##  2 Центральный федеральный округ  62.7  72.6</span></span>
<span id="cb167-7"><a href="tables.html#cb167-7"></a><span class="co">##  3 Белгородская область            0.1   0.2</span></span>
<span id="cb167-8"><a href="tables.html#cb167-8"></a><span class="co">##  4 Брянская область                2.8   3.1</span></span>
<span id="cb167-9"><a href="tables.html#cb167-9"></a><span class="co">##  5 Владимирская область            5.3   6  </span></span>
<span id="cb167-10"><a href="tables.html#cb167-10"></a><span class="co">##  6 Воронежская область             1.1   2.6</span></span>
<span id="cb167-11"><a href="tables.html#cb167-11"></a><span class="co">##  7 Ивановская область              1.6   4.6</span></span>
<span id="cb167-12"><a href="tables.html#cb167-12"></a><span class="co">##  8 Калужская область               2.3   3.2</span></span>
<span id="cb167-13"><a href="tables.html#cb167-13"></a><span class="co">##  9 Костромская область            25.2  15.1</span></span>
<span id="cb167-14"><a href="tables.html#cb167-14"></a><span class="co">## 10 Курская область                 0.3   0.5</span></span>
<span id="cb167-15"><a href="tables.html#cb167-15"></a><span class="co">## # … with 79 more rows</span></span></code></pre></div>
<p>Обратите внимание на то, что можно указывать еще и диапазоны названий столбцов, если они идут друг за другом.</p>
<blockquote>
<p>Названия столбцов в функциях <strong>dplyr</strong> указываются без кавычек, что позволяет сделат код проще и читаемее. Этот прием называется <em>квотацией</em>, с ним мы познакомимся подробнее в следующей лекции.</p>
</blockquote>
<p>Чтобы осуществить <strong>фильтрацию</strong>, необходимо задать условие, накладываемое на строки. Текущая таблица содержит данные по субъектам, федеральным округам и России в целом. Поскольку данные по округам и стране являются избыточными (их можно получить путем агрегирования данных по субъектам), выполним фильтрацию таблицы, убрав строки, в которых содержатся слова <code>Федерация</code> и <code>федеральный округ</code>. Для этого используем функцию <code>str_detect()</code> из пакета <strong>stringr</strong>, который также входит в <em>tidyverse</em>:</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="tables.html#cb168-1"></a>flt =<span class="st"> </span><span class="op">!</span>stringr<span class="op">::</span><span class="kw">str_detect</span>(rdf<span class="op">$</span>Region, <span class="st">&#39;Федерация|федеральный округ&#39;</span>) <span class="co"># готовим фильтр для строк</span></span>
<span id="cb168-2"><a href="tables.html#cb168-2"></a>(<span class="dt">regdf =</span> <span class="kw">filter</span>(rdf, flt)) <span class="co"># применяем фильтр</span></span>
<span id="cb168-3"><a href="tables.html#cb168-3"></a><span class="co">## # A tibble: 80 x 3</span></span>
<span id="cb168-4"><a href="tables.html#cb168-4"></a><span class="co">##    Region               y2010 y2015</span></span>
<span id="cb168-5"><a href="tables.html#cb168-5"></a><span class="co">##    &lt;chr&gt;                &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb168-6"><a href="tables.html#cb168-6"></a><span class="co">##  1 Белгородская область   0.1   0.2</span></span>
<span id="cb168-7"><a href="tables.html#cb168-7"></a><span class="co">##  2 Брянская область       2.8   3.1</span></span>
<span id="cb168-8"><a href="tables.html#cb168-8"></a><span class="co">##  3 Владимирская область   5.3   6  </span></span>
<span id="cb168-9"><a href="tables.html#cb168-9"></a><span class="co">##  4 Воронежская область    1.1   2.6</span></span>
<span id="cb168-10"><a href="tables.html#cb168-10"></a><span class="co">##  5 Ивановская область     1.6   4.6</span></span>
<span id="cb168-11"><a href="tables.html#cb168-11"></a><span class="co">##  6 Калужская область      2.3   3.2</span></span>
<span id="cb168-12"><a href="tables.html#cb168-12"></a><span class="co">##  7 Костромская область   25.2  15.1</span></span>
<span id="cb168-13"><a href="tables.html#cb168-13"></a><span class="co">##  8 Курская область        0.3   0.5</span></span>
<span id="cb168-14"><a href="tables.html#cb168-14"></a><span class="co">##  9 Липецкая область       0.4   1.1</span></span>
<span id="cb168-15"><a href="tables.html#cb168-15"></a><span class="co">## 10 Московская область     2.7   8.9</span></span>
<span id="cb168-16"><a href="tables.html#cb168-16"></a><span class="co">## # … with 70 more rows</span></span></code></pre></div>
<p>Условие можно прописать непосредственно при вызове <code>filter()</code>. Например, выберем регионы, в которых объем лесовосстановительных работ в 2015 году был более 50 тыс. га:</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="tables.html#cb169-1"></a><span class="kw">filter</span>(regdf, y2015 <span class="op">&gt;</span><span class="st"> </span><span class="dv">50</span>)</span>
<span id="cb169-2"><a href="tables.html#cb169-2"></a><span class="co">## # A tibble: 4 x 3</span></span>
<span id="cb169-3"><a href="tables.html#cb169-3"></a><span class="co">##   Region                y2010 y2015</span></span>
<span id="cb169-4"><a href="tables.html#cb169-4"></a><span class="co">##   &lt;chr&gt;                 &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb169-5"><a href="tables.html#cb169-5"></a><span class="co">## 1 Архангельская область  39.4  57.6</span></span>
<span id="cb169-6"><a href="tables.html#cb169-6"></a><span class="co">## 2 Красноярский край      49    50.4</span></span>
<span id="cb169-7"><a href="tables.html#cb169-7"></a><span class="co">## 3 Иркутская область      80.4 117. </span></span>
<span id="cb169-8"><a href="tables.html#cb169-8"></a><span class="co">## 4 Хабаровский край       70.2  59.6</span></span></code></pre></div>
<p>Для <strong>сортировки</strong> таблицы посредством <code>arrange()</code> необходимо указать столбцы, по которым будет осуществлено упорядочение строк. Чаще всего это один столбец, например <em>y2015</em>:</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="tables.html#cb170-1"></a><span class="kw">arrange</span>(regdf, y2015) <span class="co"># по возрастанию</span></span>
<span id="cb170-2"><a href="tables.html#cb170-2"></a><span class="co">## # A tibble: 80 x 3</span></span>
<span id="cb170-3"><a href="tables.html#cb170-3"></a><span class="co">##    Region                              y2010 y2015</span></span>
<span id="cb170-4"><a href="tables.html#cb170-4"></a><span class="co">##    &lt;chr&gt;                               &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb170-5"><a href="tables.html#cb170-5"></a><span class="co">##  1 Орловская область                     0     0.1</span></span>
<span id="cb170-6"><a href="tables.html#cb170-6"></a><span class="co">##  2 Астраханская область                  0.1   0.1</span></span>
<span id="cb170-7"><a href="tables.html#cb170-7"></a><span class="co">##  3 Кабардино-Балкарская Республика       0.1   0.1</span></span>
<span id="cb170-8"><a href="tables.html#cb170-8"></a><span class="co">##  4 Карачаево-Черкесская Республика       0.2   0.1</span></span>
<span id="cb170-9"><a href="tables.html#cb170-9"></a><span class="co">##  5 Республика Северная Осетия – Алания  NA     0.1</span></span>
<span id="cb170-10"><a href="tables.html#cb170-10"></a><span class="co">##  6 Ставропольский край                   0.4   0.1</span></span>
<span id="cb170-11"><a href="tables.html#cb170-11"></a><span class="co">##  7 Белгородская область                  0.1   0.2</span></span>
<span id="cb170-12"><a href="tables.html#cb170-12"></a><span class="co">##  8 Тульская область                      0.1   0.2</span></span>
<span id="cb170-13"><a href="tables.html#cb170-13"></a><span class="co">##  9 Магаданская область                   2.6   0.4</span></span>
<span id="cb170-14"><a href="tables.html#cb170-14"></a><span class="co">## 10 Курская область                       0.3   0.5</span></span>
<span id="cb170-15"><a href="tables.html#cb170-15"></a><span class="co">## # … with 70 more rows</span></span>
<span id="cb170-16"><a href="tables.html#cb170-16"></a><span class="kw">arrange</span>(regdf, <span class="kw">desc</span>(y2015)) <span class="co"># по убыванию</span></span>
<span id="cb170-17"><a href="tables.html#cb170-17"></a><span class="co">## # A tibble: 80 x 3</span></span>
<span id="cb170-18"><a href="tables.html#cb170-18"></a><span class="co">##    Region                y2010 y2015</span></span>
<span id="cb170-19"><a href="tables.html#cb170-19"></a><span class="co">##    &lt;chr&gt;                 &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb170-20"><a href="tables.html#cb170-20"></a><span class="co">##  1 Иркутская область      80.4 117. </span></span>
<span id="cb170-21"><a href="tables.html#cb170-21"></a><span class="co">##  2 Хабаровский край       70.2  59.6</span></span>
<span id="cb170-22"><a href="tables.html#cb170-22"></a><span class="co">##  3 Архангельская область  39.4  57.6</span></span>
<span id="cb170-23"><a href="tables.html#cb170-23"></a><span class="co">##  4 Красноярский край      49    50.4</span></span>
<span id="cb170-24"><a href="tables.html#cb170-24"></a><span class="co">##  5 Вологодская область    32.3  49  </span></span>
<span id="cb170-25"><a href="tables.html#cb170-25"></a><span class="co">##  6 Республика Коми        33.3  36.7</span></span>
<span id="cb170-26"><a href="tables.html#cb170-26"></a><span class="co">##  7 Пермский край          22.9  32.5</span></span>
<span id="cb170-27"><a href="tables.html#cb170-27"></a><span class="co">##  8 Кировская область      26    31.1</span></span>
<span id="cb170-28"><a href="tables.html#cb170-28"></a><span class="co">##  9 Амурская область       29.8  28.5</span></span>
<span id="cb170-29"><a href="tables.html#cb170-29"></a><span class="co">## 10 Томская область         9.3  25.6</span></span>
<span id="cb170-30"><a href="tables.html#cb170-30"></a><span class="co">## # … with 70 more rows</span></span></code></pre></div>
<p><strong>Добавление</strong> новых переменных (столбцов) осуществляется посредством <code>mutate()</code>. Например, определим, как изменился объем лесовосстановительных работ в 2015 году по сравнению с 2010 годом:</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="tables.html#cb171-1"></a>(<span class="dt">regdf =</span> <span class="kw">mutate</span>(regdf, <span class="dt">delta =</span> y2015 <span class="op">-</span><span class="st"> </span>y2010))</span>
<span id="cb171-2"><a href="tables.html#cb171-2"></a><span class="co">## # A tibble: 80 x 4</span></span>
<span id="cb171-3"><a href="tables.html#cb171-3"></a><span class="co">##    Region               y2010 y2015  delta</span></span>
<span id="cb171-4"><a href="tables.html#cb171-4"></a><span class="co">##    &lt;chr&gt;                &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb171-5"><a href="tables.html#cb171-5"></a><span class="co">##  1 Белгородская область   0.1   0.2   0.1 </span></span>
<span id="cb171-6"><a href="tables.html#cb171-6"></a><span class="co">##  2 Брянская область       2.8   3.1   0.3 </span></span>
<span id="cb171-7"><a href="tables.html#cb171-7"></a><span class="co">##  3 Владимирская область   5.3   6     0.7 </span></span>
<span id="cb171-8"><a href="tables.html#cb171-8"></a><span class="co">##  4 Воронежская область    1.1   2.6   1.5 </span></span>
<span id="cb171-9"><a href="tables.html#cb171-9"></a><span class="co">##  5 Ивановская область     1.6   4.6   3.00</span></span>
<span id="cb171-10"><a href="tables.html#cb171-10"></a><span class="co">##  6 Калужская область      2.3   3.2   0.9 </span></span>
<span id="cb171-11"><a href="tables.html#cb171-11"></a><span class="co">##  7 Костромская область   25.2  15.1 -10.1 </span></span>
<span id="cb171-12"><a href="tables.html#cb171-12"></a><span class="co">##  8 Курская область        0.3   0.5   0.2 </span></span>
<span id="cb171-13"><a href="tables.html#cb171-13"></a><span class="co">##  9 Липецкая область       0.4   1.1   0.7 </span></span>
<span id="cb171-14"><a href="tables.html#cb171-14"></a><span class="co">## 10 Московская область     2.7   8.9   6.2 </span></span>
<span id="cb171-15"><a href="tables.html#cb171-15"></a><span class="co">## # … with 70 more rows</span></span></code></pre></div>
<p>Существует редко используемая разновидность мутирования, при которой сохраняются только столбцы, указанные в параметрах. Она называется <code>transmute()</code> — по сути это комбинация <code>mutate()</code> и <code>select()</code>. Если вы хотите просто сохранить какой-то из столбцов, то укажите его через оператор равенства:</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="tables.html#cb172-1"></a><span class="kw">transmute</span>(regdf, <span class="dt">Region =</span> Region, <span class="dt">delta =</span> y2015 <span class="op">-</span><span class="st"> </span>y2010) <span class="co"># сохраняем только Region и delta</span></span>
<span id="cb172-2"><a href="tables.html#cb172-2"></a><span class="co">## # A tibble: 80 x 2</span></span>
<span id="cb172-3"><a href="tables.html#cb172-3"></a><span class="co">##    Region                delta</span></span>
<span id="cb172-4"><a href="tables.html#cb172-4"></a><span class="co">##    &lt;chr&gt;                 &lt;dbl&gt;</span></span>
<span id="cb172-5"><a href="tables.html#cb172-5"></a><span class="co">##  1 Белгородская область   0.1 </span></span>
<span id="cb172-6"><a href="tables.html#cb172-6"></a><span class="co">##  2 Брянская область       0.3 </span></span>
<span id="cb172-7"><a href="tables.html#cb172-7"></a><span class="co">##  3 Владимирская область   0.7 </span></span>
<span id="cb172-8"><a href="tables.html#cb172-8"></a><span class="co">##  4 Воронежская область    1.5 </span></span>
<span id="cb172-9"><a href="tables.html#cb172-9"></a><span class="co">##  5 Ивановская область     3.00</span></span>
<span id="cb172-10"><a href="tables.html#cb172-10"></a><span class="co">##  6 Калужская область      0.9 </span></span>
<span id="cb172-11"><a href="tables.html#cb172-11"></a><span class="co">##  7 Костромская область  -10.1 </span></span>
<span id="cb172-12"><a href="tables.html#cb172-12"></a><span class="co">##  8 Курская область        0.2 </span></span>
<span id="cb172-13"><a href="tables.html#cb172-13"></a><span class="co">##  9 Липецкая область       0.7 </span></span>
<span id="cb172-14"><a href="tables.html#cb172-14"></a><span class="co">## 10 Московская область     6.2 </span></span>
<span id="cb172-15"><a href="tables.html#cb172-15"></a><span class="co">## # … with 70 more rows</span></span></code></pre></div>
<p>Вы можете выполнять <strong>агрегирование</strong> данных и вычислять суммы, средние значения и т.д. используя <code>summarise()</code>. После того как мы избавились от избыточных данных в таблице, мы всегда можем получить их через агрегирование. Например, посчитаем суммарный, минимальный и максимальный объем лесовосстановительных работ по всей стране:</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="tables.html#cb173-1"></a><span class="kw">summarise</span>(regdf, </span>
<span id="cb173-2"><a href="tables.html#cb173-2"></a>          <span class="dt">sumforest =</span> <span class="kw">sum</span>(y2015, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb173-3"><a href="tables.html#cb173-3"></a>          <span class="dt">minforest =</span> <span class="kw">min</span>(y2015, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb173-4"><a href="tables.html#cb173-4"></a>          <span class="dt">maxforest =</span> <span class="kw">max</span>(y2015, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</span>
<span id="cb173-5"><a href="tables.html#cb173-5"></a><span class="co">## # A tibble: 1 x 3</span></span>
<span id="cb173-6"><a href="tables.html#cb173-6"></a><span class="co">##   sumforest minforest maxforest</span></span>
<span id="cb173-7"><a href="tables.html#cb173-7"></a><span class="co">##       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb173-8"><a href="tables.html#cb173-8"></a><span class="co">## 1      801.       0.1      117.</span></span></code></pre></div>
<p>Как правило, <code>summarise()</code> используется в паре с агрегирующими функциями, которые берут вектор значений и возвращают одно значение. К таким функциям относятся стандартные операции типа <code>min()</code>, <code>max()</code>, <code>mean()</code>, <code>sum()</code> и т.д. В пакете <strong>dplyr</strong> также имеются полезные агрегирующие функции:</p>
<ul>
<li><code>n()</code> вычисляет количество элементов.</li>
<li><code>n_distinct()</code> вычисляет количество уникальных элементов.</li>
<li><code>first(x)</code>, <code>last(x)</code> и <code>nth(x, n)</code> извлекают, соответственно, первый, последний и n-ный элемент (они бывают особенно удобны, если вы сортируете строки по какому-то критерию).</li>
</ul>
<p>Достаточно часто данные надо агрегировать не по всей таблице, а <strong>по группам</strong> измерений. В этом случае сначала делается группировка, затем агрегирование данных в каждой группе. Предположим, что нам нужно найти регион с наибольшим объемом лесовосставновительных работ в каждом Федеральном округе. Для этого нам потребуется:</p>
<ul>
<li>Дополнить каждую строку региона информацией о принадлежности к федеральному округу</li>
<li>Сгруппировать субъекты по федеральным округам
— Отсортировать каждую группу по убыванию значения поля</li>
<li>Взять первую строку в каждой группе</li>
<li>Объединить строки в одну таблицу</li>
</ul>
<p>Для начала вернемся на этап, когда мы избавлялись от федеральных округов в таблице. Поскольку в исходной таблице данные были упорядочены по округам, эту информацию можно использовать для создания нового столбца с названием округа каждого субъекта. В этом нам поможет функция <code>fill()</code> из пакета <strong>tidyr</strong>:</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="tables.html#cb174-1"></a>flt2 =<span class="st"> </span>stringr<span class="op">::</span><span class="kw">str_detect</span>(rdf<span class="op">$</span>Region, <span class="st">&#39;федеральный округ&#39;</span>) <span class="co"># ищем округа</span></span>
<span id="cb174-2"><a href="tables.html#cb174-2"></a>(<span class="dt">rdf2 =</span> <span class="kw">mutate</span>(rdf, <span class="dt">okrug =</span> <span class="kw">if_else</span>(flt2, Region, <span class="ot">NULL</span>))) <span class="co"># перенесем названия округов в новый столбец</span></span>
<span id="cb174-3"><a href="tables.html#cb174-3"></a><span class="co">## # A tibble: 89 x 4</span></span>
<span id="cb174-4"><a href="tables.html#cb174-4"></a><span class="co">##    Region                        y2010 y2015 okrug                        </span></span>
<span id="cb174-5"><a href="tables.html#cb174-5"></a><span class="co">##    &lt;chr&gt;                         &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                        </span></span>
<span id="cb174-6"><a href="tables.html#cb174-6"></a><span class="co">##  1 Российская Федерация          812.  803.  &lt;NA&gt;                         </span></span>
<span id="cb174-7"><a href="tables.html#cb174-7"></a><span class="co">##  2 Центральный федеральный округ  62.7  72.6 Центральный федеральный округ</span></span>
<span id="cb174-8"><a href="tables.html#cb174-8"></a><span class="co">##  3 Белгородская область            0.1   0.2 &lt;NA&gt;                         </span></span>
<span id="cb174-9"><a href="tables.html#cb174-9"></a><span class="co">##  4 Брянская область                2.8   3.1 &lt;NA&gt;                         </span></span>
<span id="cb174-10"><a href="tables.html#cb174-10"></a><span class="co">##  5 Владимирская область            5.3   6   &lt;NA&gt;                         </span></span>
<span id="cb174-11"><a href="tables.html#cb174-11"></a><span class="co">##  6 Воронежская область             1.1   2.6 &lt;NA&gt;                         </span></span>
<span id="cb174-12"><a href="tables.html#cb174-12"></a><span class="co">##  7 Ивановская область              1.6   4.6 &lt;NA&gt;                         </span></span>
<span id="cb174-13"><a href="tables.html#cb174-13"></a><span class="co">##  8 Калужская область               2.3   3.2 &lt;NA&gt;                         </span></span>
<span id="cb174-14"><a href="tables.html#cb174-14"></a><span class="co">##  9 Костромская область            25.2  15.1 &lt;NA&gt;                         </span></span>
<span id="cb174-15"><a href="tables.html#cb174-15"></a><span class="co">## 10 Курская область                 0.3   0.5 &lt;NA&gt;                         </span></span>
<span id="cb174-16"><a href="tables.html#cb174-16"></a><span class="co">## # … with 79 more rows</span></span>
<span id="cb174-17"><a href="tables.html#cb174-17"></a>(<span class="dt">rdf2 =</span> tidyr<span class="op">::</span><span class="kw">fill</span>(rdf2, okrug)) <span class="co"># заполним все пустые строчки предыдущим значением</span></span>
<span id="cb174-18"><a href="tables.html#cb174-18"></a><span class="co">## # A tibble: 89 x 4</span></span>
<span id="cb174-19"><a href="tables.html#cb174-19"></a><span class="co">##    Region                        y2010 y2015 okrug                        </span></span>
<span id="cb174-20"><a href="tables.html#cb174-20"></a><span class="co">##    &lt;chr&gt;                         &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                        </span></span>
<span id="cb174-21"><a href="tables.html#cb174-21"></a><span class="co">##  1 Российская Федерация          812.  803.  &lt;NA&gt;                         </span></span>
<span id="cb174-22"><a href="tables.html#cb174-22"></a><span class="co">##  2 Центральный федеральный округ  62.7  72.6 Центральный федеральный округ</span></span>
<span id="cb174-23"><a href="tables.html#cb174-23"></a><span class="co">##  3 Белгородская область            0.1   0.2 Центральный федеральный округ</span></span>
<span id="cb174-24"><a href="tables.html#cb174-24"></a><span class="co">##  4 Брянская область                2.8   3.1 Центральный федеральный округ</span></span>
<span id="cb174-25"><a href="tables.html#cb174-25"></a><span class="co">##  5 Владимирская область            5.3   6   Центральный федеральный округ</span></span>
<span id="cb174-26"><a href="tables.html#cb174-26"></a><span class="co">##  6 Воронежская область             1.1   2.6 Центральный федеральный округ</span></span>
<span id="cb174-27"><a href="tables.html#cb174-27"></a><span class="co">##  7 Ивановская область              1.6   4.6 Центральный федеральный округ</span></span>
<span id="cb174-28"><a href="tables.html#cb174-28"></a><span class="co">##  8 Калужская область               2.3   3.2 Центральный федеральный округ</span></span>
<span id="cb174-29"><a href="tables.html#cb174-29"></a><span class="co">##  9 Костромская область            25.2  15.1 Центральный федеральный округ</span></span>
<span id="cb174-30"><a href="tables.html#cb174-30"></a><span class="co">## 10 Курская область                 0.3   0.5 Центральный федеральный округ</span></span>
<span id="cb174-31"><a href="tables.html#cb174-31"></a><span class="co">## # … with 79 more rows</span></span>
<span id="cb174-32"><a href="tables.html#cb174-32"></a>(<span class="dt">regdf =</span> <span class="kw">filter</span>(rdf2, flt)) <span class="co"># оставим только регионы</span></span>
<span id="cb174-33"><a href="tables.html#cb174-33"></a><span class="co">## # A tibble: 80 x 4</span></span>
<span id="cb174-34"><a href="tables.html#cb174-34"></a><span class="co">##    Region               y2010 y2015 okrug                        </span></span>
<span id="cb174-35"><a href="tables.html#cb174-35"></a><span class="co">##    &lt;chr&gt;                &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                        </span></span>
<span id="cb174-36"><a href="tables.html#cb174-36"></a><span class="co">##  1 Белгородская область   0.1   0.2 Центральный федеральный округ</span></span>
<span id="cb174-37"><a href="tables.html#cb174-37"></a><span class="co">##  2 Брянская область       2.8   3.1 Центральный федеральный округ</span></span>
<span id="cb174-38"><a href="tables.html#cb174-38"></a><span class="co">##  3 Владимирская область   5.3   6   Центральный федеральный округ</span></span>
<span id="cb174-39"><a href="tables.html#cb174-39"></a><span class="co">##  4 Воронежская область    1.1   2.6 Центральный федеральный округ</span></span>
<span id="cb174-40"><a href="tables.html#cb174-40"></a><span class="co">##  5 Ивановская область     1.6   4.6 Центральный федеральный округ</span></span>
<span id="cb174-41"><a href="tables.html#cb174-41"></a><span class="co">##  6 Калужская область      2.3   3.2 Центральный федеральный округ</span></span>
<span id="cb174-42"><a href="tables.html#cb174-42"></a><span class="co">##  7 Костромская область   25.2  15.1 Центральный федеральный округ</span></span>
<span id="cb174-43"><a href="tables.html#cb174-43"></a><span class="co">##  8 Курская область        0.3   0.5 Центральный федеральный округ</span></span>
<span id="cb174-44"><a href="tables.html#cb174-44"></a><span class="co">##  9 Липецкая область       0.4   1.1 Центральный федеральный округ</span></span>
<span id="cb174-45"><a href="tables.html#cb174-45"></a><span class="co">## 10 Московская область     2.7   8.9 Центральный федеральный округ</span></span>
<span id="cb174-46"><a href="tables.html#cb174-46"></a><span class="co">## # … with 70 more rows</span></span></code></pre></div>
<p>Теперь мы можем определить регион с максимальным объемом лесовосстановительных работ в каждом Федеральном округе, используя вспомогательную функцию <code>row_number()</code> которая возвращает номер для каждой строки таблицы:</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="tables.html#cb175-1"></a>regdf_gr =<span class="st"> </span><span class="kw">group_by</span>(regdf, okrug)</span>
<span id="cb175-2"><a href="tables.html#cb175-2"></a>regdf_arr =<span class="st"> </span><span class="kw">arrange</span>(regdf_gr, <span class="kw">desc</span>(y2015))</span>
<span id="cb175-3"><a href="tables.html#cb175-3"></a>(<span class="dt">regdf_res =</span> <span class="kw">filter</span>(regdf_arr, <span class="kw">row_number</span>() <span class="op">==</span><span class="st"> </span><span class="dv">1</span>))</span>
<span id="cb175-4"><a href="tables.html#cb175-4"></a><span class="co">## # A tibble: 8 x 4</span></span>
<span id="cb175-5"><a href="tables.html#cb175-5"></a><span class="co">## # Groups:   okrug [8]</span></span>
<span id="cb175-6"><a href="tables.html#cb175-6"></a><span class="co">##   Region                y2010 y2015 okrug                              </span></span>
<span id="cb175-7"><a href="tables.html#cb175-7"></a><span class="co">##   &lt;chr&gt;                 &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                              </span></span>
<span id="cb175-8"><a href="tables.html#cb175-8"></a><span class="co">## 1 Иркутская область      80.4 117.  Сибирский федеральный округ        </span></span>
<span id="cb175-9"><a href="tables.html#cb175-9"></a><span class="co">## 2 Хабаровский край       70.2  59.6 Дальневосточный федеральный округ  </span></span>
<span id="cb175-10"><a href="tables.html#cb175-10"></a><span class="co">## 3 Архангельская область  39.4  57.6 Северо-Западный федеральный округ  </span></span>
<span id="cb175-11"><a href="tables.html#cb175-11"></a><span class="co">## 4 Пермский край          22.9  32.5 Приволжский федеральный округ      </span></span>
<span id="cb175-12"><a href="tables.html#cb175-12"></a><span class="co">## 5 Свердловская область   25.6  24.4 Уральский федеральный округ        </span></span>
<span id="cb175-13"><a href="tables.html#cb175-13"></a><span class="co">## 6 Костромская область    25.2  15.1 Центральный федеральный округ      </span></span>
<span id="cb175-14"><a href="tables.html#cb175-14"></a><span class="co">## 7 Волгоградская область   1.8   0.9 Южный федеральный округ            </span></span>
<span id="cb175-15"><a href="tables.html#cb175-15"></a><span class="co">## 8 Чеченская Республика    0.9   0.7 Северо-Кавказский федеральный округ</span></span></code></pre></div>
<p><code>group_by()</code> часто используется в паре с <code>summarise()</code>. Например мы можем получить суммарный объем лесовосстановительных работ по каждому федеральному округу:</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="tables.html#cb176-1"></a>regdf_gr =<span class="st"> </span><span class="kw">group_by</span>(regdf, okrug)</span>
<span id="cb176-2"><a href="tables.html#cb176-2"></a><span class="kw">summarise</span>(regdf_gr, <span class="dt">total =</span> <span class="kw">sum</span>(y2015, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</span>
<span id="cb176-3"><a href="tables.html#cb176-3"></a><span class="co">## # A tibble: 8 x 2</span></span>
<span id="cb176-4"><a href="tables.html#cb176-4"></a><span class="co">##   okrug                               total</span></span>
<span id="cb176-5"><a href="tables.html#cb176-5"></a><span class="co">##   &lt;chr&gt;                               &lt;dbl&gt;</span></span>
<span id="cb176-6"><a href="tables.html#cb176-6"></a><span class="co">## 1 Дальневосточный федеральный округ   108. </span></span>
<span id="cb176-7"><a href="tables.html#cb176-7"></a><span class="co">## 2 Приволжский федеральный округ       110. </span></span>
<span id="cb176-8"><a href="tables.html#cb176-8"></a><span class="co">## 3 Северо-Западный федеральный округ   194. </span></span>
<span id="cb176-9"><a href="tables.html#cb176-9"></a><span class="co">## 4 Северо-Кавказский федеральный округ   1.1</span></span>
<span id="cb176-10"><a href="tables.html#cb176-10"></a><span class="co">## 5 Сибирский федеральный округ         259. </span></span>
<span id="cb176-11"><a href="tables.html#cb176-11"></a><span class="co">## 6 Уральский федеральный округ          52.9</span></span>
<span id="cb176-12"><a href="tables.html#cb176-12"></a><span class="co">## 7 Центральный федеральный округ        72.7</span></span>
<span id="cb176-13"><a href="tables.html#cb176-13"></a><span class="co">## 8 Южный федеральный округ               3.3</span></span></code></pre></div>
<p>Использование <strong>dplyr</strong> целым обладает рядом преимуществ по сравнению с применением стандартных средств <strong>R</strong>:</p>
<ul>
<li>вызов функций с говорящими названиями операции более понятными;</li>
<li>код выглядит более чистым и легко читаемым за счет отсутствия обращений к фреймам данных через квадратные скобки, доллары и «закавыченные» названия переменных;</li>
<li>код с использованием функций <strong>dplyr</strong> часто оказывается короче, чем его традиционные аналоги;</li>
<li>операции dplyr можно выстраивать в конвейеры с помощью пайп-оператора <code>%&gt;%</code>.</li>
</ul>
<p>Последнюю возможность мы рассмотрим в следующем параграфе.</p>
</div>
<div id="tables_manipiulations_pipeline" class="section level3">
<h3><span class="header-section-number">3.6.2</span> Конвейер манипуляций</h3>
<p>В предыдущем параграфе было показано как найти регион-лидер в каждой группе по выбранному показателю. При этом, несмотря на то что интерес представляет только конечный результат, нам пришлось шесть раз осуществить запись промежуточного результата в соответствующую переменную. Чтобы избежать подобного многословия в программах, в <strong>R</strong> реализована возможность организации <strong>конвейера манипуляций</strong> (pipeline) посредством использования <em>пайп-оператора</em> <code>%&gt;%</code>.</p>
<p><strong>Пайп-оператор <code>%&gt;%</code></strong> предназначен для компактной и наглядной записи <em>последовательностей</em> обработки данных. Работает он следующим образом:</p>
<ul>
<li><code>x %&gt;% f</code> эквивалентно <code>f(x)</code></li>
<li><code>x %&gt;% f(y)</code> эквивалентно <code>f(x, y)</code></li>
<li><code>x %&gt;% f %&gt;% g %&gt;% h</code> эквивалентно <code>h(g(f(x)))</code></li>
</ul>
<p>Коротко говоря, пайп оператор берет результат вычисления выражения слева и подставляет его в качестве первого аргумента в выражение справа. С помощью этого оператора вышеприведенный код по нахождению региона-лидера можно записать так:</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="tables.html#cb177-1"></a>regdf =<span class="st"> </span>rdf <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb177-2"><a href="tables.html#cb177-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">okrug =</span> <span class="kw">if_else</span>(flt2, Region, <span class="ot">NULL</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb177-3"><a href="tables.html#cb177-3"></a><span class="st">  </span>tidyr<span class="op">::</span><span class="kw">fill</span>(okrug) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb177-4"><a href="tables.html#cb177-4"></a><span class="st">  </span><span class="kw">filter</span>(flt)</span>
<span id="cb177-5"><a href="tables.html#cb177-5"></a></span>
<span id="cb177-6"><a href="tables.html#cb177-6"></a>leaders =<span class="st"> </span>regdf <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb177-7"><a href="tables.html#cb177-7"></a><span class="st">  </span><span class="kw">group_by</span>(okrug) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb177-8"><a href="tables.html#cb177-8"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(y2015)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb177-9"><a href="tables.html#cb177-9"></a><span class="st">  </span><span class="kw">filter</span>(<span class="kw">row_number</span>() <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb177-10"><a href="tables.html#cb177-10"></a></span>
<span id="cb177-11"><a href="tables.html#cb177-11"></a><span class="kw">print</span>(leaders)</span>
<span id="cb177-12"><a href="tables.html#cb177-12"></a><span class="co">## # A tibble: 8 x 4</span></span>
<span id="cb177-13"><a href="tables.html#cb177-13"></a><span class="co">## # Groups:   okrug [8]</span></span>
<span id="cb177-14"><a href="tables.html#cb177-14"></a><span class="co">##   Region                y2010 y2015 okrug                              </span></span>
<span id="cb177-15"><a href="tables.html#cb177-15"></a><span class="co">##   &lt;chr&gt;                 &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                              </span></span>
<span id="cb177-16"><a href="tables.html#cb177-16"></a><span class="co">## 1 Иркутская область      80.4 117.  Сибирский федеральный округ        </span></span>
<span id="cb177-17"><a href="tables.html#cb177-17"></a><span class="co">## 2 Хабаровский край       70.2  59.6 Дальневосточный федеральный округ  </span></span>
<span id="cb177-18"><a href="tables.html#cb177-18"></a><span class="co">## 3 Архангельская область  39.4  57.6 Северо-Западный федеральный округ  </span></span>
<span id="cb177-19"><a href="tables.html#cb177-19"></a><span class="co">## 4 Пермский край          22.9  32.5 Приволжский федеральный округ      </span></span>
<span id="cb177-20"><a href="tables.html#cb177-20"></a><span class="co">## 5 Свердловская область   25.6  24.4 Уральский федеральный округ        </span></span>
<span id="cb177-21"><a href="tables.html#cb177-21"></a><span class="co">## 6 Костромская область    25.2  15.1 Центральный федеральный округ      </span></span>
<span id="cb177-22"><a href="tables.html#cb177-22"></a><span class="co">## 7 Волгоградская область   1.8   0.9 Южный федеральный округ            </span></span>
<span id="cb177-23"><a href="tables.html#cb177-23"></a><span class="co">## 8 Чеченская Республика    0.9   0.7 Северо-Кавказский федеральный округ</span></span></code></pre></div>
<p>Если бы мы попытались написать те же последовательности операций одним выражением в традиционной «матрешечной» парадигме, это выглядело так:</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="tables.html#cb178-1"></a>regdf =<span class="st"> </span><span class="kw">filter</span>(</span>
<span id="cb178-2"><a href="tables.html#cb178-2"></a>           tidyr<span class="op">::</span><span class="kw">fill</span>(</span>
<span id="cb178-3"><a href="tables.html#cb178-3"></a>             <span class="kw">mutate</span>(</span>
<span id="cb178-4"><a href="tables.html#cb178-4"></a>               rdf,</span>
<span id="cb178-5"><a href="tables.html#cb178-5"></a>               <span class="dt">okrug =</span> <span class="kw">if_else</span>(flt2, Region, <span class="ot">NULL</span>)</span>
<span id="cb178-6"><a href="tables.html#cb178-6"></a>             ),</span>
<span id="cb178-7"><a href="tables.html#cb178-7"></a>             okrug</span>
<span id="cb178-8"><a href="tables.html#cb178-8"></a>           ),</span>
<span id="cb178-9"><a href="tables.html#cb178-9"></a>           flt</span>
<span id="cb178-10"><a href="tables.html#cb178-10"></a>         )</span>
<span id="cb178-11"><a href="tables.html#cb178-11"></a></span>
<span id="cb178-12"><a href="tables.html#cb178-12"></a>result =<span class="st"> </span><span class="kw">filter</span>(</span>
<span id="cb178-13"><a href="tables.html#cb178-13"></a>           <span class="kw">arrange</span>(</span>
<span id="cb178-14"><a href="tables.html#cb178-14"></a>             <span class="kw">group_by</span>(</span>
<span id="cb178-15"><a href="tables.html#cb178-15"></a>               regdf, </span>
<span id="cb178-16"><a href="tables.html#cb178-16"></a>               okrug</span>
<span id="cb178-17"><a href="tables.html#cb178-17"></a>             ),</span>
<span id="cb178-18"><a href="tables.html#cb178-18"></a>             <span class="kw">desc</span>(y2015)</span>
<span id="cb178-19"><a href="tables.html#cb178-19"></a>           ),</span>
<span id="cb178-20"><a href="tables.html#cb178-20"></a>           <span class="kw">row_number</span>() <span class="op">==</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb178-21"><a href="tables.html#cb178-21"></a>         )</span></code></pre></div>
<p>Выглядит несколько устрашающе. К тому же, читать такой код приходится задом наперед (изнутри наружу), чтобы понять последовательность действий. Таким образом, организация конвейера манипуляций с использованием пайп-оператора позволяет:</p>
<ul>
<li>упорядочить операции по обработке данных слева направо (в противоположность направлению изнутри наружу);</li>
<li>избежать вложенных вызовов функций (матрёшки);</li>
<li>минимизировать количество переменных для храненния промежуточных результатов;</li>
<li>упростить добавление новых операций по обработке данных в любое место последовательности.</li>
</ul>
<blockquote>
<p><strong>Пайп-оператор <code>%&gt;%</code> можно быстро набрать в RStudio</strong>, нажав клавиатурное сочетание <kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>M</kbd> (<kbd>Cmd</kbd> + <kbd>Shift</kbd> + <kbd>M</kbd> на помпьютерах Mac)</p>
</blockquote>
</div>
<div id="tables_tidy" class="section level3">
<h3><span class="header-section-number">3.6.3</span> Преобразование структуры</h3>
<p>Одни и те же данные можно предствить в табличной форме по-разному. Одна форма будет удобной для ручного заполнения таблицы. Другая форма будет удобной для программной обработки и анализа. Большинство же остальных форм не будут оптимальными ни для того, ни для другого. Наш курс посвящен автоматизированной обработке данных на языке R, поэтомы мы должны определить, какая форма таблицы удобна для этих целей.</p>
<p>В экосистеме R такие данные принято называть «аккуратными», или по-английски <a href="https://www.jstatsoft.org/article/view/v059i10"><strong>tidy data</strong></a>. Аккуратные таблицы отвечают следующим требованиям:</p>
<ol style="list-style-type: decimal">
<li>Каждый столбец представляет переменную</li>
<li>Каждая строка представляет измерение</li>
<li>Каждая ячейка представляет значение</li>
</ol>
<p>С некоторой долей условности можно говорить, что это <a href="https://ru.wikipedia.org/wiki/Третья_нормальная_форма">третья нормальная форма</a> реляционного отношения.</p>
<p>Таблицы, с которыми мы работали до настоящего момента в этой главе, не отвечают данным требованиям. В частности, данные по лесовосстановлению содержат столбцы, в которых приведены данные за соответствующие года. Это <strong>одна</strong> переменная, разбитая на несколько столбцов. При этом <em>год измерения</em> является второй переменной. Такая форма удобна для заполнения и визуального анализа, но неудобна для программной обработки. Предположим, что нам надо найти все регионы, у которых в промежутке между 2012 и 2015 годами лесовосстановительные работы хотя бы в один год не производились (их объем был равен нулю). В текущей форме таблицы нам придется сделать 4 условия — по одному на каждый год-столбец. Это при том, что мы должны быть уверены, что все промежуточные года в таблице присутствуют. Приведя таблицу к аккуратному виду, мы можем решить задачу более компактно, отправив всего 2 запроса: один на год измерения и второй на величину показателя.</p>
<p>Приведение таблицы к аккуратному виду можно сделать, используя функции из пакета <a href="https://tidyr.tidyverse.org"><strong>tidyr</strong></a>. Основных функций в этом пакете всего две<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>:</p>
<ul>
<li><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html"><code>pivot_longer()</code></a> берет несколько колонок и преобразует их к виду «ключ—значение»: широкие таблицы становятся длинными.</li>
<li><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html"><code>pivot_wider()</code></a> берет две колонки, соответствующие ключу и значению, и распределяет их на множество колонок: длинные таблицы становятся широкими.</li>
</ul>
<p>Помимо этого, есть еще 2 полезных функции, которые позволяют «распиливать» или «склеивать» колонки:</p>
<ul>
<li><code>separate()</code> разделяет колонку на несколько колонок, используя заданный символ-разделитель или позицию.</li>
<li><code>unite()</code> скливает несколько колонок, используя заданный символ-разделитель.</li>
</ul>
<p>Функция <code>pivot_longer()</code> имеет четыре основных параметра:</p>
<ul>
<li><code>data</code> — входная таблица (фрейм данных или тиббл)</li>
<li><code>cols</code> — перечисление столбцов, которые необходимо подвергнуть преобразованию</li>
<li><code>names_to</code> — имя нового столбца, который будет хранить ключи (бывшие названия столбцов)</li>
<li><code>values_to</code> — имя нового столбца, который будет хранить значения</li>
</ul>
<p>Рассмотрим на примере таблицы <em>reforest</em> приведение к аккуратному виду:</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="tables.html#cb179-1"></a><span class="kw">library</span>(tidyr)</span>
<span id="cb179-2"><a href="tables.html#cb179-2"></a>(<span class="dt">reforest_tidy =</span> reforest <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb179-3"><a href="tables.html#cb179-3"></a><span class="st">    </span><span class="kw">pivot_longer</span>(<span class="dt">cols =</span> y2005<span class="op">:</span>y2016, </span>
<span id="cb179-4"><a href="tables.html#cb179-4"></a>                 <span class="dt">names_to =</span> <span class="st">&#39;year&#39;</span>, </span>
<span id="cb179-5"><a href="tables.html#cb179-5"></a>                 <span class="dt">values_to =</span> <span class="st">&#39;value&#39;</span>))</span>
<span id="cb179-6"><a href="tables.html#cb179-6"></a><span class="co">## # A tibble: 712 x 3</span></span>
<span id="cb179-7"><a href="tables.html#cb179-7"></a><span class="co">##    Region                        year  value</span></span>
<span id="cb179-8"><a href="tables.html#cb179-8"></a><span class="co">##    &lt;chr&gt;                         &lt;chr&gt; &lt;dbl&gt;</span></span>
<span id="cb179-9"><a href="tables.html#cb179-9"></a><span class="co">##  1 Российская Федерация          y2005 812. </span></span>
<span id="cb179-10"><a href="tables.html#cb179-10"></a><span class="co">##  2 Российская Федерация          y2010 812. </span></span>
<span id="cb179-11"><a href="tables.html#cb179-11"></a><span class="co">##  3 Российская Федерация          y2011 860  </span></span>
<span id="cb179-12"><a href="tables.html#cb179-12"></a><span class="co">##  4 Российская Федерация          y2012 842. </span></span>
<span id="cb179-13"><a href="tables.html#cb179-13"></a><span class="co">##  5 Российская Федерация          y2013 872. </span></span>
<span id="cb179-14"><a href="tables.html#cb179-14"></a><span class="co">##  6 Российская Федерация          y2014 863  </span></span>
<span id="cb179-15"><a href="tables.html#cb179-15"></a><span class="co">##  7 Российская Федерация          y2015 803. </span></span>
<span id="cb179-16"><a href="tables.html#cb179-16"></a><span class="co">##  8 Российская Федерация          y2016 840. </span></span>
<span id="cb179-17"><a href="tables.html#cb179-17"></a><span class="co">##  9 Центральный федеральный округ y2005  52.6</span></span>
<span id="cb179-18"><a href="tables.html#cb179-18"></a><span class="co">## 10 Центральный федеральный округ y2010  62.7</span></span>
<span id="cb179-19"><a href="tables.html#cb179-19"></a><span class="co">## # … with 702 more rows</span></span></code></pre></div>
<blockquote>
<p>Обратите внимание на то, что параметры <code>names_to</code> и <code>values_to</code> надо передавать как строки, поскольку они содержат еще <em>не существующие</em> объекты.</p>
</blockquote>
<p>Полученный результат еще не вполне пригоден для анализа, поскольку в переменной <code>year</code> мы имеем строковые значения, начинающиеся с <code>y</code>. Чтобы избавиться от этого префикса, можно при вызове <code>pivot_longer()</code> указать параметр <code>names_prefix</code>. Поскольку по умолчанию ключи конвертируются в строковый столбец, а год — это целочисленное значение, следует дополнительно указать параметр <code>names_ptypes</code>. Помимо этого, конвертации подвергаются все столбцы, <em>кроме</em> <code>Region</code> — это означает, что можно пойти от обратного в параметре <code>cols</code>. Резюмируя перечисленные соображения, вышеприведенный вызов можно оптимизировать следующим образом:</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="tables.html#cb180-1"></a>(<span class="dt">reforest_tidy2 =</span> reforest <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb180-2"><a href="tables.html#cb180-2"></a><span class="st">    </span><span class="kw">pivot_longer</span>(<span class="dt">cols =</span> <span class="op">-</span>Region, </span>
<span id="cb180-3"><a href="tables.html#cb180-3"></a>                 <span class="dt">names_to =</span> <span class="st">&#39;year&#39;</span>,</span>
<span id="cb180-4"><a href="tables.html#cb180-4"></a>                 <span class="dt">names_prefix =</span> <span class="st">&#39;y&#39;</span>,</span>
<span id="cb180-5"><a href="tables.html#cb180-5"></a>                 <span class="dt">names_ptypes =</span> <span class="kw">list</span>(<span class="dt">year =</span> <span class="kw">integer</span>()),</span>
<span id="cb180-6"><a href="tables.html#cb180-6"></a>                 <span class="dt">values_to =</span> <span class="st">&#39;value&#39;</span>))</span>
<span id="cb180-7"><a href="tables.html#cb180-7"></a><span class="co">## # A tibble: 712 x 3</span></span>
<span id="cb180-8"><a href="tables.html#cb180-8"></a><span class="co">##    Region                         year value</span></span>
<span id="cb180-9"><a href="tables.html#cb180-9"></a><span class="co">##    &lt;chr&gt;                         &lt;int&gt; &lt;dbl&gt;</span></span>
<span id="cb180-10"><a href="tables.html#cb180-10"></a><span class="co">##  1 Российская Федерация           2005 812. </span></span>
<span id="cb180-11"><a href="tables.html#cb180-11"></a><span class="co">##  2 Российская Федерация           2010 812. </span></span>
<span id="cb180-12"><a href="tables.html#cb180-12"></a><span class="co">##  3 Российская Федерация           2011 860  </span></span>
<span id="cb180-13"><a href="tables.html#cb180-13"></a><span class="co">##  4 Российская Федерация           2012 842. </span></span>
<span id="cb180-14"><a href="tables.html#cb180-14"></a><span class="co">##  5 Российская Федерация           2013 872. </span></span>
<span id="cb180-15"><a href="tables.html#cb180-15"></a><span class="co">##  6 Российская Федерация           2014 863  </span></span>
<span id="cb180-16"><a href="tables.html#cb180-16"></a><span class="co">##  7 Российская Федерация           2015 803. </span></span>
<span id="cb180-17"><a href="tables.html#cb180-17"></a><span class="co">##  8 Российская Федерация           2016 840. </span></span>
<span id="cb180-18"><a href="tables.html#cb180-18"></a><span class="co">##  9 Центральный федеральный округ  2005  52.6</span></span>
<span id="cb180-19"><a href="tables.html#cb180-19"></a><span class="co">## 10 Центральный федеральный округ  2010  62.7</span></span>
<span id="cb180-20"><a href="tables.html#cb180-20"></a><span class="co">## # … with 702 more rows</span></span></code></pre></div>
<p>Если по какой-то причине вам уже досталась таблица, в которой в ячейках сцеплены несколько сущностей, разделить их можно с помощью функции <code>separate()</code>. Вышеприведенный тиббл <code>reforest_tidy</code> можно “довести до ума” последовательным вызовом <code>separate()</code>, <code>select()</code> и <code>mutate()</code>:</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="tables.html#cb181-1"></a>(<span class="dt">reforest_tidy =</span> reforest_tidy <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb181-2"><a href="tables.html#cb181-2"></a><span class="st">  </span><span class="kw">separate</span>(year, <span class="kw">c</span>(<span class="st">&#39;y&#39;</span>, <span class="st">&#39;year&#39;</span>), <span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb181-3"><a href="tables.html#cb181-3"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>y) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb181-4"><a href="tables.html#cb181-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">as.integer</span>(year)))</span>
<span id="cb181-5"><a href="tables.html#cb181-5"></a><span class="co">## # A tibble: 712 x 3</span></span>
<span id="cb181-6"><a href="tables.html#cb181-6"></a><span class="co">##    Region                         year value</span></span>
<span id="cb181-7"><a href="tables.html#cb181-7"></a><span class="co">##    &lt;chr&gt;                         &lt;int&gt; &lt;dbl&gt;</span></span>
<span id="cb181-8"><a href="tables.html#cb181-8"></a><span class="co">##  1 Российская Федерация           2005 812. </span></span>
<span id="cb181-9"><a href="tables.html#cb181-9"></a><span class="co">##  2 Российская Федерация           2010 812. </span></span>
<span id="cb181-10"><a href="tables.html#cb181-10"></a><span class="co">##  3 Российская Федерация           2011 860  </span></span>
<span id="cb181-11"><a href="tables.html#cb181-11"></a><span class="co">##  4 Российская Федерация           2012 842. </span></span>
<span id="cb181-12"><a href="tables.html#cb181-12"></a><span class="co">##  5 Российская Федерация           2013 872. </span></span>
<span id="cb181-13"><a href="tables.html#cb181-13"></a><span class="co">##  6 Российская Федерация           2014 863  </span></span>
<span id="cb181-14"><a href="tables.html#cb181-14"></a><span class="co">##  7 Российская Федерация           2015 803. </span></span>
<span id="cb181-15"><a href="tables.html#cb181-15"></a><span class="co">##  8 Российская Федерация           2016 840. </span></span>
<span id="cb181-16"><a href="tables.html#cb181-16"></a><span class="co">##  9 Центральный федеральный округ  2005  52.6</span></span>
<span id="cb181-17"><a href="tables.html#cb181-17"></a><span class="co">## 10 Центральный федеральный округ  2010  62.7</span></span>
<span id="cb181-18"><a href="tables.html#cb181-18"></a><span class="co">## # … with 702 more rows</span></span></code></pre></div>
<p>Теперь можно выполнять любые запросы, комбинирующие год измерения и величину показателя. Найдем субъекты, в которых с 2012 по 2015 год не производились лесовосстановительные работы:</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="tables.html#cb182-1"></a>reforest_tidy <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(year <span class="op">&gt;</span><span class="st"> </span><span class="dv">2011</span> <span class="op">&amp;</span><span class="st"> </span>year <span class="op">&lt;</span><span class="st"> </span><span class="dv">2016</span> <span class="op">&amp;</span><span class="st"> </span>value <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb182-2"><a href="tables.html#cb182-2"></a><span class="co">## # A tibble: 2 x 3</span></span>
<span id="cb182-3"><a href="tables.html#cb182-3"></a><span class="co">##   Region             year value</span></span>
<span id="cb182-4"><a href="tables.html#cb182-4"></a><span class="co">##   &lt;chr&gt;             &lt;int&gt; &lt;dbl&gt;</span></span>
<span id="cb182-5"><a href="tables.html#cb182-5"></a><span class="co">## 1 Орловская область  2013     0</span></span>
<span id="cb182-6"><a href="tables.html#cb182-6"></a><span class="co">## 2 Республика Адыгея  2014     0</span></span></code></pre></div>
<p>“Длинная” форма данных удобна для программного анализа, но может быть неудобна для ручного редактирования, визуальной оценки или передачи в другие программы, ожидающие на входе данные в “широком” формате. В этих случаях будет полезна функция <code>pivot_wider()</code>, которая по своему действию противоположна <code>pivot_longer()</code>. Данная функция имеет три основных параметра:</p>
<ul>
<li><code>data</code> — входная таблица (фрейм данных или тиббл)</li>
<li><code>names_from</code> — имя переменной, из которой будут браться названия столбцов</li>
<li><code>values_from</code> — имя переменной, из которой будут браться значения в ячейках</li>
</ul>
<p>Преобразуем ранее удлиненную таблицу к “широкому” виду:</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="tables.html#cb183-1"></a>(<span class="dt">reforest =</span> reforest_tidy <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb183-2"><a href="tables.html#cb183-2"></a><span class="st">   </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> year, <span class="dt">values_from =</span> value))</span>
<span id="cb183-3"><a href="tables.html#cb183-3"></a><span class="co">## # A tibble: 89 x 9</span></span>
<span id="cb183-4"><a href="tables.html#cb183-4"></a><span class="co">##    Region                `2005` `2010` `2011` `2012` `2013` `2014` `2015` `2016`</span></span>
<span id="cb183-5"><a href="tables.html#cb183-5"></a><span class="co">##    &lt;chr&gt;                  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb183-6"><a href="tables.html#cb183-6"></a><span class="co">##  1 Российская Федерация   812.   812.   860    842.   872.   863    803.   840. </span></span>
<span id="cb183-7"><a href="tables.html#cb183-7"></a><span class="co">##  2 Центральный федераль…   52.6   62.7   60.9   60.3   70.9   71.2   72.6   77  </span></span>
<span id="cb183-8"><a href="tables.html#cb183-8"></a><span class="co">##  3 Белгородская область     0.4    0.1    0.3    0.3    0.4    0.4    0.2    0.2</span></span>
<span id="cb183-9"><a href="tables.html#cb183-9"></a><span class="co">##  4 Брянская область         2.9    2.8    3      3.2    3.5    3.3    3.1    3  </span></span>
<span id="cb183-10"><a href="tables.html#cb183-10"></a><span class="co">##  5 Владимирская область     4.4    5.3    5.7    6      7.1    5.9    6      4.9</span></span>
<span id="cb183-11"><a href="tables.html#cb183-11"></a><span class="co">##  6 Воронежская область      1.1    1.1    1.8    3      2.7    2.7    2.6    2.3</span></span>
<span id="cb183-12"><a href="tables.html#cb183-12"></a><span class="co">##  7 Ивановская область       2.1    1.6    2.2    3.1    4      4.8    4.6    4.2</span></span>
<span id="cb183-13"><a href="tables.html#cb183-13"></a><span class="co">##  8 Калужская область        2.2    2.3    2.3    2.5    2.4    3.1    3.2    3.2</span></span>
<span id="cb183-14"><a href="tables.html#cb183-14"></a><span class="co">##  9 Костромская область     10     25.2   11     11.8   15.3   13.6   15.1   16.4</span></span>
<span id="cb183-15"><a href="tables.html#cb183-15"></a><span class="co">## 10 Курская область          0.5    0.3    0.4    0.6    0.6    0.6    0.5    0.4</span></span>
<span id="cb183-16"><a href="tables.html#cb183-16"></a><span class="co">## # … with 79 more rows</span></span></code></pre></div>
<blockquote>
<p>Обратите внимание на то, что параметры <code>names_from</code> и <code>values_from</code> можно задавать как имена переменных, а не как строки.</p>
</blockquote>
<p>В качестве примера операции с широкой таблицей вычислим разности по сравнению с предыдущим годом:</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="tables.html#cb184-1"></a>diffs =<span class="st"> </span>reforest <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="st">`</span><span class="dt">2011</span><span class="st">`</span><span class="op">:</span><span class="st">`</span><span class="dt">2016</span><span class="st">`</span>) <span class="op">-</span></span>
<span id="cb184-2"><a href="tables.html#cb184-2"></a><span class="st">        </span>reforest <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="st">`</span><span class="dt">2010</span><span class="st">`</span><span class="op">:</span><span class="st">`</span><span class="dt">2015</span><span class="st">`</span>)</span>
<span id="cb184-3"><a href="tables.html#cb184-3"></a></span>
<span id="cb184-4"><a href="tables.html#cb184-4"></a>diffs <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb184-5"><a href="tables.html#cb184-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Region =</span> reforest<span class="op">$</span>Region) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb184-6"><a href="tables.html#cb184-6"></a><span class="st">  </span><span class="kw">select</span>(Region, <span class="st">`</span><span class="dt">2011</span><span class="st">`</span><span class="op">:</span><span class="st">`</span><span class="dt">2016</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb184-7"><a href="tables.html#cb184-7"></a><span class="st">  </span><span class="kw">head</span>() <span class="co"># Посмотрим шапку таблицы</span></span>
<span id="cb184-8"><a href="tables.html#cb184-8"></a><span class="co">##                          Region 2011  2012 2013 2014  2015 2016</span></span>
<span id="cb184-9"><a href="tables.html#cb184-9"></a><span class="co">## 1          Российская Федерация 48.5 -18.3 30.6 -9.3 -60.1 37.0</span></span>
<span id="cb184-10"><a href="tables.html#cb184-10"></a><span class="co">## 2 Центральный федеральный округ -1.8  -0.6 10.6  0.3   1.4  4.4</span></span>
<span id="cb184-11"><a href="tables.html#cb184-11"></a><span class="co">## 3          Белгородская область  0.2   0.0  0.1  0.0  -0.2  0.0</span></span>
<span id="cb184-12"><a href="tables.html#cb184-12"></a><span class="co">## 4              Брянская область  0.2   0.2  0.3 -0.2  -0.2 -0.1</span></span>
<span id="cb184-13"><a href="tables.html#cb184-13"></a><span class="co">## 5          Владимирская область  0.4   0.3  1.1 -1.2   0.1 -1.1</span></span>
<span id="cb184-14"><a href="tables.html#cb184-14"></a><span class="co">## 6           Воронежская область  0.7   1.2 -0.3  0.0  -0.1 -0.3</span></span></code></pre></div>
</div>
</div>
<div id="tables_join" class="section level2">
<h2><span class="header-section-number">3.7</span> Соединение</h2>
<p>Данные, с которыми мы работаем, часто распределены по нескольким таблицам. Если возникает задача их совместного использования (сравнения, вычисления производных показателей), таблицы необходимо соединить.</p>
<p>В процессе <strong>соединения</strong> в обеих таблицах находятся строки, соответствующие одному и тому же измерению (например, региону). После этого столбцы второй таблицы пристыковываются к столбцам первой таблицы, а строки — к соответствующим строкам <em>(мутирующее соединение)</em>, либо же происходит фильтрация строк первой таблицы на основе нахождения соответствующих строк во второй таблице <em>(фильтрующее соединение)</em>.</p>
<p>Чтобы найти соответствие, в обеих таблицах должен быть по крайней мере один столбец, идентифицирующий каждую строку. В первой таблице он называется <strong>первичным ключом</strong> <em>(primary key)</em>, во второй таблице — <strong>внешним ключом</strong> <em>(foreign key)</em>.</p>
<p>Для выполнения соедининия в пакете dplyr имеется несколько функций.</p>
<p><em>Мутирующее соединение:</em></p>
<ul>
<li><code>inner_join(x, y, by = )</code> возвращает все строки из <code>x</code>, для которых имеются соответствующие строки в <code>y</code>, а также все столбцы из <code>x</code> и <code>y</code>.</li>
<li><code>left_join(x, y, by = )</code> возвращает все строки из <code>x</code>, а также все столбцы из <code>x</code> и <code>y</code>. Строки в <code>x</code>, для которых не найдены соответствия в <code>y</code>, будут иметь значения <code>NA</code> в присоединенных столбцах</li>
<li><code>right_join(x, y, by = )</code> возвращает все строки из <code>y</code>, а также все столбцы из <code>x</code> и <code>y</code>. Строки в <code>y</code>, для которых не найдены соответствия в <code>x</code>, будут иметь значения <code>NA</code> в присоединенных столбцах</li>
<li><code>full_join(x, y, by = )</code> возвращает все строки и колонки из <code>x</code> и <code>y</code>. В строках, для которых не найдено соответствие ячейки присоединяемых стольков будут заполнены значениями <code>NA</code></li>
</ul>
<p><em>Фильтрующее соединение:</em></p>
<ul>
<li><code>semi_join(x, y, by = )</code> возвращает все строки из <code>x</code>, для которых имеются соответствующие строки в <code>y</code>, а также все столбцы из <code>x</code></li>
<li><code>anti_join(x, y, by = )</code> возвращает все строки из <code>x</code>, для которыхне найдены соответствующие строки в <code>y</code>, а также все столбцы из <code>x</code></li>
</ul>
<p>Рассмотрим соединение таблиц на примере данных по лесовосстановлению и заготовкам древесины. Наша задача — оценить количество гектаров восстанавливаемой лесной площади (в га) на тысячу кубометров лесозаготовок (и таким образом оценить эффективность лесовосстановительных мероприятий).</p>
<p>Подгрузим таблицу по лесозаготовкам:</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="tables.html#cb185-1"></a>(<span class="dt">timber =</span> <span class="kw">read_excel</span>(<span class="st">&#39;data/timber.xlsx&#39;</span>, </span>
<span id="cb185-2"><a href="tables.html#cb185-2"></a>                    <span class="dt">col_types =</span> <span class="kw">c</span>(<span class="st">&#39;text&#39;</span>, <span class="kw">rep</span>(<span class="st">&#39;numeric&#39;</span>, <span class="dv">8</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb185-3"><a href="tables.html#cb185-3"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>stringr<span class="op">::</span><span class="kw">str_detect</span>(Регион, <span class="st">&#39;Федерация|федеральный округ&#39;</span>)))</span>
<span id="cb185-4"><a href="tables.html#cb185-4"></a><span class="co">## # A tibble: 75 x 9</span></span>
<span id="cb185-5"><a href="tables.html#cb185-5"></a><span class="co">##    Регион               `2010` `2011` `2012` `2013` `2014` `2015` `2016` Место</span></span>
<span id="cb185-6"><a href="tables.html#cb185-6"></a><span class="co">##    &lt;chr&gt;                 &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb185-7"><a href="tables.html#cb185-7"></a><span class="co">##  1 Белгородская область   30.4   39.6   27.7   37.4   34.1   45.6   30.4    60</span></span>
<span id="cb185-8"><a href="tables.html#cb185-8"></a><span class="co">##  2 Брянская область      614.   616.   824.   850.   793.   739.   750.     27</span></span>
<span id="cb185-9"><a href="tables.html#cb185-9"></a><span class="co">##  3 Владимирская область 1078   1335   1236   1142   1165   1272   1252      20</span></span>
<span id="cb185-10"><a href="tables.html#cb185-10"></a><span class="co">##  4 Воронежская область    73.6   69.5   68.6   47.9   81.1   86.6   53.5    58</span></span>
<span id="cb185-11"><a href="tables.html#cb185-11"></a><span class="co">##  5 Ивановская область    130.   140.   200.   199.   231.   326.   421.     38</span></span>
<span id="cb185-12"><a href="tables.html#cb185-12"></a><span class="co">##  6 Калужская область     274.   244.   192.   198.   183    145.   204      44</span></span>
<span id="cb185-13"><a href="tables.html#cb185-13"></a><span class="co">##  7 Костромская область  3000   3332   2797   2692   2564   2186   2515      14</span></span>
<span id="cb185-14"><a href="tables.html#cb185-14"></a><span class="co">##  8 Курская область        22.8   55.4   49.7   50.1   65.9   74.6   80.7    55</span></span>
<span id="cb185-15"><a href="tables.html#cb185-15"></a><span class="co">##  9 Липецкая область      163.   139     49.7   42.6   50.1   73.1   87.8    53</span></span>
<span id="cb185-16"><a href="tables.html#cb185-16"></a><span class="co">## 10 Московская область    126.   265.   299.   108.    15.6   NA     NA      74</span></span>
<span id="cb185-17"><a href="tables.html#cb185-17"></a><span class="co">## # … with 65 more rows</span></span></code></pre></div>
<p>Приведем ее к аккуратному виду, который соответствует виду таблицы по лесовосстановлению:</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="tables.html#cb186-1"></a>(<span class="dt">timber_tidy =</span> timber <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb186-2"><a href="tables.html#cb186-2"></a><span class="st">  </span><span class="kw">gather</span>(year, harvest, <span class="st">`</span><span class="dt">2010</span><span class="st">`</span><span class="op">:</span><span class="st">`</span><span class="dt">2016</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb186-3"><a href="tables.html#cb186-3"></a><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">Region =</span> Регион,</span>
<span id="cb186-4"><a href="tables.html#cb186-4"></a>            <span class="dt">year =</span> <span class="kw">as.numeric</span>(year),</span>
<span id="cb186-5"><a href="tables.html#cb186-5"></a>            <span class="dt">harvest =</span> harvest))</span>
<span id="cb186-6"><a href="tables.html#cb186-6"></a><span class="co">## # A tibble: 525 x 3</span></span>
<span id="cb186-7"><a href="tables.html#cb186-7"></a><span class="co">##    Region                year harvest</span></span>
<span id="cb186-8"><a href="tables.html#cb186-8"></a><span class="co">##    &lt;chr&gt;                &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span id="cb186-9"><a href="tables.html#cb186-9"></a><span class="co">##  1 Белгородская область  2010    30.4</span></span>
<span id="cb186-10"><a href="tables.html#cb186-10"></a><span class="co">##  2 Брянская область      2010   614. </span></span>
<span id="cb186-11"><a href="tables.html#cb186-11"></a><span class="co">##  3 Владимирская область  2010  1078  </span></span>
<span id="cb186-12"><a href="tables.html#cb186-12"></a><span class="co">##  4 Воронежская область   2010    73.6</span></span>
<span id="cb186-13"><a href="tables.html#cb186-13"></a><span class="co">##  5 Ивановская область    2010   130. </span></span>
<span id="cb186-14"><a href="tables.html#cb186-14"></a><span class="co">##  6 Калужская область     2010   274. </span></span>
<span id="cb186-15"><a href="tables.html#cb186-15"></a><span class="co">##  7 Костромская область   2010  3000  </span></span>
<span id="cb186-16"><a href="tables.html#cb186-16"></a><span class="co">##  8 Курская область       2010    22.8</span></span>
<span id="cb186-17"><a href="tables.html#cb186-17"></a><span class="co">##  9 Липецкая область      2010   163. </span></span>
<span id="cb186-18"><a href="tables.html#cb186-18"></a><span class="co">## 10 Московская область    2010   126. </span></span>
<span id="cb186-19"><a href="tables.html#cb186-19"></a><span class="co">## # … with 515 more rows</span></span></code></pre></div>
<p>Теперь нам осталось присоединить данные по лесозаготовкам к таблице по лесовосстановлению, используя имя региона (<code>Region</code>) и год (<code>year</code>) в качестве ключевых полей.</p>
<p>Для этого мы используем функцию <code>inner_join()</code>, поскольку нас интересует сравнение по тем годам, для которых имеются данные в обеих таблицах:</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="tables.html#cb187-1"></a>(<span class="dt">compare =</span> reforest_tidy <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb187-2"><a href="tables.html#cb187-2"></a><span class="st">  </span><span class="kw">inner_join</span>(timber_tidy, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;Region&quot;</span> =<span class="st"> &quot;Region&quot;</span>, <span class="st">&quot;year&quot;</span> =<span class="st"> &quot;year&quot;</span>)))</span>
<span id="cb187-3"><a href="tables.html#cb187-3"></a><span class="co">## # A tibble: 511 x 4</span></span>
<span id="cb187-4"><a href="tables.html#cb187-4"></a><span class="co">##    Region                year value harvest</span></span>
<span id="cb187-5"><a href="tables.html#cb187-5"></a><span class="co">##    &lt;chr&gt;                &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span id="cb187-6"><a href="tables.html#cb187-6"></a><span class="co">##  1 Белгородская область  2010   0.1    30.4</span></span>
<span id="cb187-7"><a href="tables.html#cb187-7"></a><span class="co">##  2 Белгородская область  2011   0.3    39.6</span></span>
<span id="cb187-8"><a href="tables.html#cb187-8"></a><span class="co">##  3 Белгородская область  2012   0.3    27.7</span></span>
<span id="cb187-9"><a href="tables.html#cb187-9"></a><span class="co">##  4 Белгородская область  2013   0.4    37.4</span></span>
<span id="cb187-10"><a href="tables.html#cb187-10"></a><span class="co">##  5 Белгородская область  2014   0.4    34.1</span></span>
<span id="cb187-11"><a href="tables.html#cb187-11"></a><span class="co">##  6 Белгородская область  2015   0.2    45.6</span></span>
<span id="cb187-12"><a href="tables.html#cb187-12"></a><span class="co">##  7 Белгородская область  2016   0.2    30.4</span></span>
<span id="cb187-13"><a href="tables.html#cb187-13"></a><span class="co">##  8 Брянская область      2010   2.8   614. </span></span>
<span id="cb187-14"><a href="tables.html#cb187-14"></a><span class="co">##  9 Брянская область      2011   3     616. </span></span>
<span id="cb187-15"><a href="tables.html#cb187-15"></a><span class="co">## 10 Брянская область      2012   3.2   824. </span></span>
<span id="cb187-16"><a href="tables.html#cb187-16"></a><span class="co">## # … with 501 more rows</span></span></code></pre></div>
<p>Наконец, вычислим искомое отношние и упорядочим регионы по году (возрастание) и отношению (убывание):</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="tables.html#cb188-1"></a>(<span class="dt">compare =</span> compare <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb188-2"><a href="tables.html#cb188-2"></a><span class="st">   </span><span class="kw">mutate</span>(<span class="dt">ratio =</span> <span class="dv">1000</span> <span class="op">*</span><span class="st"> </span>value <span class="op">/</span><span class="st"> </span>harvest) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb188-3"><a href="tables.html#cb188-3"></a><span class="st">   </span><span class="kw">select</span>(Region, year, ratio, value, harvest) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb188-4"><a href="tables.html#cb188-4"></a><span class="st">   </span><span class="kw">arrange</span>(year, <span class="kw">desc</span>(ratio)))</span>
<span id="cb188-5"><a href="tables.html#cb188-5"></a><span class="co">## # A tibble: 511 x 5</span></span>
<span id="cb188-6"><a href="tables.html#cb188-6"></a><span class="co">##    Region                    year ratio value harvest</span></span>
<span id="cb188-7"><a href="tables.html#cb188-7"></a><span class="co">##    &lt;chr&gt;                    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span id="cb188-8"><a href="tables.html#cb188-8"></a><span class="co">##  1 Ставропольский край       2010 182.    0.4     2.2</span></span>
<span id="cb188-9"><a href="tables.html#cb188-9"></a><span class="co">##  2 Ростовская область        2010 149.    1.5    10.1</span></span>
<span id="cb188-10"><a href="tables.html#cb188-10"></a><span class="co">##  3 Магаданская область       2010 118.    2.6    22  </span></span>
<span id="cb188-11"><a href="tables.html#cb188-11"></a><span class="co">##  4 Сахалинская область       2010  63.8  12.7   199. </span></span>
<span id="cb188-12"><a href="tables.html#cb188-12"></a><span class="co">##  5 Республика Саха (Якутия)  2010  63.3  58     917. </span></span>
<span id="cb188-13"><a href="tables.html#cb188-13"></a><span class="co">##  6 Республика Тыва           2010  61.8   4.4    71.2</span></span>
<span id="cb188-14"><a href="tables.html#cb188-14"></a><span class="co">##  7 Мурманская область        2010  52.2   3      57.5</span></span>
<span id="cb188-15"><a href="tables.html#cb188-15"></a><span class="co">##  8 Волгоградская область     2010  48.4   1.8    37.2</span></span>
<span id="cb188-16"><a href="tables.html#cb188-16"></a><span class="co">##  9 Камчатский  край          2010  38.9   5.2   134. </span></span>
<span id="cb188-17"><a href="tables.html#cb188-17"></a><span class="co">## 10 Амурская область          2010  38.5  29.8   773. </span></span>
<span id="cb188-18"><a href="tables.html#cb188-18"></a><span class="co">## # … with 501 more rows</span></span></code></pre></div>
<p>Из этой таблицы видно, что площадь восстанавливаемых лесов далеко не всегда пропорциональна объему заготовок необработанной древесины.</p>
</div>
<div id="tables_write" class="section level2">
<h2><span class="header-section-number">3.8</span> Запись</h2>
<p>Запись файлов <em>в текстовом формате</em> можно осуществить посредством функций из пакета <strong>readr</strong>, таких как <code>write_delim()</code>, <code>write_csv()</code> и <code>write_tsv()</code>. Базовый синтаксис их предельно прост:</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="tables.html#cb189-1"></a><span class="kw">write_csv</span>(compare, <span class="st">&quot;data/output/timber_compare.csv&quot;</span>)</span></code></pre></div>
<p>Для записи таблиц <em>Microsoft Excel</em> можно использовать возможности пакета <a href="https://cran.r-project.org/web/packages/writexl/index.html"><strong>writexl</strong></a>:</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="tables.html#cb190-1"></a><span class="kw">library</span>(writexl)</span>
<span id="cb190-2"><a href="tables.html#cb190-2"></a><span class="kw">write_xlsx</span>(compare, <span class="st">&quot;data/output/timber_compare.xlsx&quot;</span>)</span></code></pre></div>
<p>Каждая из этих функций содержит ряд дополнительных параметров, позволяющих управлять внешним видом выгружаемых таблиц. Более подробно с ними вы можете ознакомиться, вызвав справку для соответствующей функции.</p>
</div>
<div id="tables_rules" class="section level2">
<h2><span class="header-section-number">3.9</span> Рекомендации по подготовке таблиц для чтения в R</h2>
<p>Несмотря на то, что каких-то четких правил подготовки таблиц для программной обработки не существует, можно дать несколько полезных рекомендаций по данному поводу:</p>
<ol style="list-style-type: decimal">
<li>В первой строке таблицы должны располагаться названия столбцов.</li>
<li>Во второй строке таблицы должны начинаться данные. Не допускайте многострочных заголовков.</li>
<li>В названиях столбцов недопустимы объединенные ячейки, покрывающие несколько столбцов. Это может привести к неверному подсчету количества столбцов и, как следствие, некорректному чтению таблицы в целом.</li>
<li>Названия столбцов должны состоять из латинских букв и цифр, начинаться с буквы и не содержать пробелов. Сложносочиненные названия выделяйте прописными буквами. Плохое название столбца: <code>Валовый внутренний продукт за 2015 г.</code>. Хорошее название столбца: <code>GDP2015</code>.</li>
<li>Некоторые ошибки данных в таблицах (такие как неверные десятичные разделители), проще найти и исправить в табличном/текстовом редакторе, нежели после загрузки в <strong>R</strong>.</li>
</ol>
<p>Следование этим правилам значительно облегчит работу с табличными данными в среде <strong>R</strong>.</p>
</div>
<div id="tables_review" class="section level2">
<h2><span class="header-section-number">3.10</span> Краткий обзор</h2>
<p>Для просмотра презентации щелкните на ней один раз левой кнопкой мыши и листайте, используя кнопки на клавиатуре:
<iframe src="https://tsamsonov.github.io/r-geo-course/slides/03-Tables_slides.html#1" width="672" height="500px"></iframe></p>
<blockquote>
<p>Презентацию можно открыть в отдельном окне или вкладке браузере. Для этого щелкните по ней правой кнопкой мыши и выберите соответствующую команду.</p>
</blockquote>
</div>
<div id="tables_questions" class="section level2">
<h2><span class="header-section-number">3.11</span> Контрольные вопросы и упражнения</h2>
<div id="tables_questions_questions" class="section level3">
<h3><span class="header-section-number">3.11.1</span> Вопросы</h3>
<ol style="list-style-type: decimal">
<li>Какая функция позволяет установить новый пакет в R?</li>
<li>Как подключить пакет в текущую сессию R?</li>
<li>Как вызвать функцию из пакета, не подключая его в текущей сессии R?</li>
<li>Какие структуры данных используются для представления таблиц в среде R? Чем они отличаются друг от друга?</li>
<li>Какая функция позволяет создавать тибблы по строкам, а не столбцам?</li>
<li>Как загрузить в текущую сессию R набор данных из конкретного пакета? Под каким именем он будет доступен?</li>
<li>Каковы основные принципы создания текстовых файлов с разделителем для хранения таблиц? Какой аббревиатурой они обозначаются?</li>
<li>Чем отличаются файлы с фиксированной шириной столбца от файлов с разделителем? Какими спопообами можно указать границы колонок при чтении этих файлов?</li>
<li>Перечислите функции из пакета <strong>readr</strong>, которые можно использовать для чтения текстовых файлов с табличными данными?</li>
<li>Какой пакет позволяет читать данные в формате Microsoft Excel?</li>
<li>Если прочитанный вами файл содержит нечитаемые символы, что это означает? Как решить проблему?</li>
<li>Какие дополнительные параметры позволяют задавать функции чтения данных из пакетов <strong>readr</strong> и <strong>readxl</strong>, помимо имени файла?</li>
<li>Перечислите основные возможности для отображения табличных данных в среде R?</li>
<li>Можно ли заменять названия строк и столбцов таблицы? Если да, то какие функции для этого используются?</li>
<li>Назовите возможные способы извлечения столбца (столбцов) из фрейма данных/тиббла. Какие из них приводят к получения вектора, а какие возвращают фрейм данных/тиббл?</li>
<li>Как извлечь строки, удовлетворяющие некоторому критерию, используя стандартные средства <strong>R</strong>?</li>
<li>Перечислите основные типы манипуляций над таблицами.</li>
<li>Какой тип манипуляции всегда используется в сочетании с другими типами?</li>
<li>Нужно ли заключать названия переменных в кавычки при использовании функций пакета <strong>dplyr</strong>?</li>
<li>Какая функция <strong>dplyr</strong> позволяет выбирать нужные переменные? Как с помощью нее отобрать диапазон переменных? Можно ли пойти от обратного и
исключить, а не выбрать переменные?</li>
<li>Какая функция <strong>dplyr</strong> позволяет осуществлять фильтрацию строк? Как реализовать фильтрацию строк по нескольким условиям одновременно?</li>
<li>Как найти строки, в которых встречаются заданные фрагменты текста? Какая функция позволяет это сделать?</li>
<li>Назовите функцию <strong>dplyr</strong>, отвечающую за выполнение сортировки таблицы. Как с помощью нее упорядочить данные по нескольким столбцам? Сделать порядок сортировки по убыванию?</li>
<li>Что такое мутирование и трансмутирование таблицы?</li>
<li>Какая функция <strong>dplyr</strong> отвечает за добавление новых переменных? Можно ли с помощью нее добавить несколько переменных сразу? Как оставить только вновь создаваемые переменные?</li>
<li>С помощью какой функции можно вычислить обобщающие статистики по всем строкам или группам строк?</li>
<li>Как с помощью <strong>dplyr</strong> получить количество элементов и количество уникальных элементов в каждой группе?</li>
<li>Как с помощью <strong>dplyr</strong> получить первый, последний и n-ный элемент в каждой группе?</li>
<li>Что такое конвейер манипуляций и для чего он используется в R?</li>
<li>Опишите приципы действия пайп-оператора. С помощью какого клавиатурного сочетания его можно быстро ввести в <strong>RStudio</strong>?</li>
<li>Опишите требования, которым должны отвечать аккуратные табличные данные. Какой пакет <strong>R</strong> позволяет преборазовывать данные в такую форму?</li>
<li>Какие две основных операции над таблицами позволяют добиться длинного и широкого вида таблицы? Можно ли говорить о том, что для всех задач удобна какая-то одна из этих двух форм?</li>
<li>Как работают функции <code>pivot_longer()</code> и <code>pivot_wider()</code>?</li>
<li>Что такое соединение таблиц? В каких случаях оно бывает необходимо? Какие разновидности соединения реализованы в <strong>dplyr</strong>?</li>
<li>Каким требованиям должны отвечать таблицы для того чтобы их соединение было возможным?</li>
<li>Что такое первичный и внешний ключ в операции соединения таблиц?</li>
<li>Какие возможности существуют для записи табличных данных в текстовые файлы? Перечислите пакеты и функции, такие возможности реализующие.</li>
<li>Опишите общие рекомендации для подготовки таблиц к чтению средствами R.</li>
</ol>
</div>
<div id="tables_questions_tasks" class="section level3">
<h3><span class="header-section-number">3.11.2</span> Упражнения</h3>
<ol style="list-style-type: decimal">
<li><p>Таблица <em>quakes</em> из пакета <strong>datasets</strong> содержит магнитуду землетрясений в поле <code>mag</code>. Используя функции <strong>dplyr</strong> и пайп-оператор, создайте на ее основе таблицу с частотой (количеством штук) землетрясений каждой магнитуды.</p>
<blockquote>
<p><strong>Подсказка:</strong> при выполнении агрегирования используйте функцию <code>n()</code>, которая возвращает количество строк в группе.</p>
</blockquote></li>
<li><p>Таблица <em>storms</em> из пакета <strong>dplyr</strong> содержит увлекательные данные трекинга тропических циклонов c 1975 по 2015 год. Используя функции <strong>dplyr</strong> и пайп-оператор, создайте таблицу в которой зафиксировано: название циклона, дата начала, дата окончания, продолжительность в днях, максимальная скорость ветра, минимальное давление. Отсортируйте циклоны сначала по максимальной скорости ветра (по убыванию), затем по давлению (по возрастанию). Оформите результат в виде одного конвейера манипуляций.</p>
<blockquote>
<p><strong>Подсказка:</strong> перед выполнением агрегирования на основе существующих полей создайте новое поле, в котором хранится дата события, имеющая тип <code>Date</code>. Это позволит вам правильно вычислить продолжительность в днях. Чтобы создать строку для преобразования в дату, используйте функцию <code>paste()</code>, подставив в нее поля, составляющие даты, и укажите необходимый разделитель в параметре <code>sep()</code>. После агрегирования данных и перед сортировкой вызовите <code>ungroup()</code>, иначе вы будете сортировать внутри каждой группы, а вам нужно сортировать результаты группировки.</p>
</blockquote></li>
<li><p>Загрузите <a href="https://raw.githubusercontent.com/tsamsonov/r-geo-course/master/data/wind_energy.txt">файл</a> с данными по энергии ветра вдоль Черноморского побережья на высотах 50 и 100 метров, который был использован в этой лекции. Данный файл имеет формат фиксированной ширины столбца (см. параграф <a href="tables.html#tables-reading-text-fwf">3.3.2.2</a>). Произведите чтение данного файла и приведите его с помощью <strong>tidyr</strong> к аккуратному виду, разделив высоту и величину энергии на отдельные столбцы. Используя возможности <strong>dplyr</strong>, рассчитайте фрейм данных со средними значениями энергии на каждой высоте.</p></li>
<li><p>Загрузите <a href="https://raw.githubusercontent.com/tsamsonov/r-geo-course/master/data/okruga.csv">файл CSV</a> с данными по населению федеральных округов России, который был использован в этой лекции. Прочтите данную таблицу, приведите ее с помощью <strong>tidyr</strong> к аккуратному виду (федеральный округ — год — население), а также вычислите в виде дополнительного столбца долю (в %), которую каждый округ занимает в общем населении России на каждый год (получится федеральный округ — год — население — доля). Оформите результат в виде одного конвейера манипуляций.</p>
<blockquote>
<p><strong>Подсказка:</strong> используйте <em>группировку таблицы по году</em> и вычислите поле с долей путем деления поля населения на <em>сумму</em> по полю населения.</p>
</blockquote></li>
</ol>
<table>
<tbody>
<tr class="odd">
<td><em>Самсонов Т.Е.</em> <strong>Визуализация и анализ географических данных на языке R.</strong> М.: Географический факультет МГУ, 2020. DOI: <a href="https://doi.org/10.5281/zenodo.901911">10.5281/zenodo.901911</a></td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="2">
<li id="fn2"><p>Ранее вместо <code>pivot_longer()</code> и <code>pivot_wider()</code> использовались функции <code>gather()</code> и <code>spread()</code> соответственно. Новые функции имеют более очевидный синтаксис и более широкие возможности, поэтому использование <code>gather()</code> и <code>spread()</code> начиная с версии 1.0.0 пакета <strong>tidyr</strong> более не рекомендуется.<a href="tables.html#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-structures.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="tech.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"edit": "https://github.com/tsamsonov/r-geo-course/edit/master/%s"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
