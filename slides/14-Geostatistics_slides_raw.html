<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Геостатистика</title>
    <meta charset="utf-8" />
    <meta name="author" content="Тимофей Самсонов" />
    <meta name="date" content="2020-05-24" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link rel="stylesheet" href="style.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Геостатистика
## Пространственная статистика
### Тимофей Самсонов
### 2020-05-24

---




## Базовые компоненты

`$$\{p_1, p_2, ..., p_n\}$$`

`$$\{Z(p_1), Z(p_2), ..., Z(p_n)\}$$`

---

## Пространственная модель

`\(p \in \mathbb{R}^k\)` — ...

`\(Z(p)\)` — ...

`$$\{Z(p) | p \in D\}$$`

`$$\{z(p) | p \in D\}$$`

---

## Случайный процесс (функция)

---

## Автокорреляция

---

## Математическое ожидание

`$$E[Z(p)]=m(p)$$`

---

## Дисперсия

`$$Var[Z(p)]=E[Z^2(p)]-m^2(p)$$`

---

## Ковариация

`$$Cov(p_1,p_2) = Cov[Z(p_1), Z(p_2)] = \\E[Z(p_1)Z(p_2)]-m(p_1)m(p_2)$$`

---

## Свойства моментов случайных процессов

---

## Гипотеза стационарности

---

## Стационарность

`$$P\{Z(x_1)&lt;z_1,...,Z(x_k)&lt;z_k\} = \\P\{Z(x_1 + h)&lt;z_1,...,Z(x_k + h)&lt;z_k\}$$`

---

## Стационарность

---

## Стационарность второго порядка

`$$\begin{cases}
  E[Z(x)] = m \\
  E[(Z(x)-m)(Z(x+h)-m)] = C(h)
\end{cases}$$`

---

## Эргодичность

`$$\lim_{V \rightarrow \infty} \frac{1}{|V|}\int_{V} Z(x,w)dx = m(w)$$`

---

##  Простой кригинг

`$$Z^* = \sum_{i} \lambda_i Z_i + \lambda_0$$`

`$$E\big[(Z^* - Z_0)^2\big]$$`

---

##  Простой кригинг

`$$Z^* = \sum_{i} \lambda_i Z_i + \lambda_0$$`

`$$Var[X] = E[X^2] - (E[X])^2$$`

`$$E\big[(Z^* - Z_0)^2\big] = Var[Z^* - Z_0] + (E[Z^* - Z_0])^2$$`

`$$E[Z^* - Z_0] = E\Big[\sum_{i} \lambda_i Z_i + \lambda_0 - Z_0\Big] = 0$$`
---

##  Простой кригинг

`$$E[Z^* - Z_0] = E\Big[\sum_{i} \lambda_i Z_i + \lambda_0 - Z_0\Big] = 0$$`

`$$\lambda_0 = -E\Big[\sum_{i} \lambda_i Z_i - Z_0\Big] = m_0 - \sum_i \lambda_i m_i,$$`

---

##  Простой кригинг

`$$Z^* = \sum_{i} \lambda_i Z_i + \lambda_0,\\
\lambda_0 = m_0 - \sum_i \lambda_i m_i,$$`

`$$Z^* = \sum_{i} \lambda_i Z_i + m_0 - \sum_i \lambda_i m_i = \\
m_0 + \sum_{i} \lambda_i (Z_i - m_i)$$`

---

##  Простой кригинг

`$$Z^* = m_0 + \sum_{i} \lambda_i (Z_i - m_i)$$`

`$$Y^* = \sum_{i} \lambda_i Y_i,$$`

---

##  Простой кригинг

`$$E\big[(Z^* - Z_0)^2\big] = Var[Z^* - Z_0]$$`

- `\(Var[X + Y] = Var[X] + Var[Y] + 2 Cov[X, Y]\)`,  
- `\(Var[-X] = Var[X]\)`,
- `\(Cov[X, -Y] = -Cov[X, Y]\)`

`$$Var[Z^* - Z_0] = Var[Z^*] + Var[Z_0] - 2 Cov[Z^*, Z_0]$$`

---

##  Простой кригинг

`$$Var[Z^* - Z_0] = Var[Z^*] + Var[Z_0] - 2 Cov[Z^*, Z_0]$$`

`$$X_1,\ldots, X_n$$`,
`$$Y_1 = \sum\limits_{i=1}^n a_i X_i,\; Y_2 = \sum\limits_{j=1}^m b_j X_j$$`

`$$\mathrm{cov}[Y_1,Y_2] = \sum\limits_{i=1}^n\sum\limits_{j=1}^m a_i b_j \mathrm{cov}[X_i,X_j]$$`.
---

##  Простой кригинг

`$$Var[Z^* - Z_0] = Var[Z^*] + Var[Z_0] - 2 Cov[Z^*, Z_0]$$`

`\(Var[Z^*] = Cov[Z^*, Z^*] = Cov\Big[\sum_{i} \lambda_i Z_i, \sum_{j} \lambda_j Z_j\Big] = \\ \sum_{i}\sum_{j} \lambda_i \lambda_j Cov[Z_i, Z_j] = \sum_{i}\sum_{j} \lambda_i \lambda_j \sigma_{ij}\)`

`\(Var[Z_0] = Cov[Z_0, Z_0] = \sigma_{00}\)`

`\(Cov[Z^*, Z_0] = Cov\Big[\sum_{i} \lambda_i Z_i, Z_0\Big] =\\ \sum_{i} \lambda_i Cov[Z_i, Z_0] = \sum_{i} \lambda_i \sigma_{i0}\)`

---

##  Простой кригинг

`$$Var[Z^* - Z_0] = Var[Z^*] + Var[Z_0] - 2 Cov[Z^*, Z_0]$$`

`$$Var[Z^* - Z_0] = \sum_{i}\sum_{j} \lambda_i \lambda_j \sigma_{ij} - 2 \sum_{} \lambda_i \sigma_{i0} + \sigma_{00}$$`

`$$\frac{\partial}{\partial \lambda_i} E\big[(Z^* - Z_0)^2\big] = 2 \sum_{j} \lambda_j \sigma_{ij} - 2 \sigma_{i0} = 0$$`

---

##  Простой кригинг

`$$\frac{\partial}{\partial \lambda_i} E\big[(Z^* - Z_0)^2\big] = 2 \sum_{j} \lambda_j \sigma_{ij} - 2 \sigma_{i0} = 0$$`

`$$\color{red}{\boxed{\color{blue}{\sum_{j} \lambda_j \sigma_{ij} = \sigma_{i0}\color{gray}{,~i = 1,...,N}}}}$$`

---

## Дисперсия простого кригинга

`$$\sum_{j} \lambda_j \sigma_{ij} = \sigma_{i0}$$`

`$$Var[Z^* - Z_0] = \sum_{i}\sum_{j} \lambda_i \lambda_j \sigma_{ij} - 2 \sum_{} \lambda_i \sigma_{i0} + \sigma_{00}$$`

---

## Дисперсия простого кригинга

`$$\sum_{j} \lambda_j \sigma_{ij} = \sigma_{i0}~\Bigg|\times \lambda_i\\
\sum_{i}\sum_{j} \lambda_i \lambda_j \sigma_{ij} = \sum_{i}\lambda_i\sigma_{i0}$$`

`$$Var[Z^* - Z_0] = \color{red}{\sum_{i}\sum_{j} \lambda_i \lambda_j \sigma_{ij}} - 2 \sum_{} \lambda_i \sigma_{i0} + \sigma_{00}$$`

---

## Дисперсия простого кригинга

`$$Var[Z^* - Z_0] = \color{red}{\sum_{i}\sum_{j} \lambda_i \lambda_j \sigma_{ij}} - 2 \sum_{} \lambda_i \sigma_{i0} + \sigma_{00} =\\
\sum_{i}\lambda_i\sigma_{i0} - 2 \sum_{} \lambda_i \sigma_{i0} + \sigma_{00}$$`

`$$\color{red}{\boxed{\color{blue}{\sigma_{SK} = Var[Z^* - Z_0] = \sigma_{00} - \sum_{i}\lambda_i\sigma_{i0}}}}$$`

---

## Стационарность приращений

`$$Y_h(x) = Z(x+h)-Z(x)$$`

---

## Стационарность приращений

`$$\begin{cases}
E[Z(x+h)-Z(x)] = \langle a,h \rangle \\
Var[Z(x+h)-Z(x)] = 2\gamma(h)
\end{cases}$$`

- `\(\langle a,h \rangle\)` обозначает ..., который варажется через

- `\(\gamma(h)\)` — дисперсия приращений, называемая _вариограммой_

---

## Стационарность приращений

`$$\begin{cases}
E[Z(x+h)-Z(x)] = \langle a,h \rangle \\
Var[Z(x+h)-Z(x)] = 2\gamma(h)
\end{cases}$$`

`$$2\gamma(h) = Var[Z(x+h)-Z(x)] =  Var[Y_h(x)] \\=E\big[Y_h(x)\big]^2 - \Big(E\big[Y_h(x)\big]\Big)^2 \\=E\big[Y_h(x)\big]^2 = E\big[Z(x+h)-Z(x)\big]^2$$`
---

## Стационарность приращений

`$$\begin{cases}
E\big[Z(x)\big] = m\\
E\big[Z(x+h)-Z(x)\big] = 0 \\
E\big[Z(x+h)-Z(x)\big]^2 = 2\gamma(h)
\end{cases}$$`

---

## Положительная определенность

`$$Var \Bigg[\sum_{i=1}^N \lambda_i Z(x_i)\Bigg] = \sum_{i=1}^N \sum_{j=1}^N \lambda_i \lambda_j cov\big[Z(x_i), Z(x_j)\big] \\= \sum_{i=1}^N \sum_{j=1}^N \lambda_i \lambda_j C(x_j - x_i)$$`
&gt; Функция `\(C(h)\)`, для которой при любых значениях `\(N\)`, `\(x_i\)` и `\(\lambda_i\)` выражение `\(\sum_{i=1}^N \sum_{j=1}^N \lambda_i \lambda_j C(x_j - x_i)\)` принимает неотрицательные значения, называется __положительно определенной__.

---

## Допустимые линейные комбинации

`\(\sum_{i=1}^N \lambda_i = 0\)`, `\(\sum_{i=1}^N \lambda_i Z(x_0) = 0\)`:

`$$\sum_{i=1}^N \lambda_i Z(x_i) = \sum_{i=1}^N \lambda_i \big[Z(x_i) - Z(x_0)\big]$$`

&gt; Линейные комбинации, отвечающие условию `\(\sum_{i=1}^N \lambda_i = 0\)`, называются ...
---

## Условная положительная определенность


`$$Var \Bigg[\sum_{i=1}^N \lambda_i Z(x_i)\Bigg] = - \sum_{i=1}^N \sum_{j=1}^N \lambda_i \lambda_j \gamma(x_j - x_i)$$`

Функция `\(G(h)\)`, для которой при условии и `\(\sum_{i=1}^N \lambda_i = 0\)` выражение `\(\sum_{i=1}^N \sum_{j=1}^N \lambda_i \lambda_j G(x_j - x_i)\)` принимает неотрицательные значения, называется ...

---

### Переход от ковариации к вариограмме

`$$Cov \Bigg[\sum_{i=1}^N \lambda_i Z(x_i), \sum_{j=1}^M \mu_j Z(x_j) \Bigg] = \sum_{i=1}^N \sum_{j=1}^M \lambda_i \mu_j C(x_j - x_i)$$`

`$$Cov[X + \alpha, Y + \beta] = Cov[X, Y]$$`:

`$$\sum_{i=1}^N \sum_{j=1}^M \lambda_i \mu_j C(x_j - x_i) =\\
=\sum_{i=1}^N \sum_{j=1}^M \lambda_i \mu_j Cov \big[Z(x_i) - Z(x_0), Z(x_j) - Z(x_0)\big]$$`
---

### Переход от ковариации к вариограмме

`\(E\big[Z(x+h)-Z(x)\big] = 0\)`

`$$Cov \big[Z(x_i) - Z(x_0), Z(x_j) - Z(x_0)\big] =\\
= E\big[Z_i - Z_0\big]\big[Z_j - Z_0\big] - E\big[Z_i - Z_0\big] E\big[Z_j - Z_0\big] = \\
= E\big[Z_i - Z_0\big]\big[Z_j - Z_0\big]$$`

`$$\color{blue}{(Z_j - Z_i)^2} = \big[(Z_j - Z_0) - (Z_i - Z_0)\big]^2 = \\ = \color{blue}{(Z_i - Z_0)^2} - 2\color{red}{(Z_i - Z_0)(Z_j - Z_0)} + \color{blue}{(Z_j - Z_0)^2}$$`
---

### Переход от ковариации к вариограмме

$$ (Z_i - Z_0)(Z_j - Z_0) = \frac{1}{2} \Big[(Z_i - Z_0)^2 + (Z_j - Z_0)^2 - (Z_j - Z_i)^2\Big]$$

`$$E\big[Z(x+h)-Z(x)\big]^2 = 2\gamma(h)$$`

`$$Cov \big[Z(x_i) - Z(x_0), Z(x_j) - Z(x_0)\big] = E\big[Z_i - Z_0\big]\big[Z_j - Z_0\big] = \\
= \frac{1}{2} E \Big[(Z_i - Z_0)^2 + (Z_j - Z_0)^2 - (Z_j - Z_i)^2\Big] = \\
= \gamma(x_i - x_0) + \gamma(x_j - x_0) - \gamma(x_j - x_i)$$`
---

### Переход от ковариации к вариограмме

`$$\sum_{i=1}^N \sum_{j=1}^M \lambda_i \mu_j Cov \big[Z(x_i) - Z(x_0), Z(x_j) - Z(x_0)\big] = \\ 
= \sum_{i=1}^N \sum_{j=1}^M \lambda_i \mu_j \big[\gamma(x_i - x_0) + \gamma(x_j - x_0) - \gamma(x_j - x_i)\big] = \\
= - \sum_{i=1}^N \sum_{j=1}^M \lambda_i \mu_j \gamma(x_j - x_i),$$`

- `\(\sum_{i=1}^N \sum_{j=1}^M \lambda_i \mu_j \gamma(x_i - x_0) = \sum_{j=1}^M \mu_j \sum_{i=1}^N \lambda_i \gamma(x_i - x_0) = 0\)`
- `\(\sum_{i=1}^N \sum_{j=1}^M \lambda_i \mu_j \gamma(x_j - x_0) = \sum_{i=1}^N \lambda_i \sum_{j=1}^M \mu_i \gamma(x_j - x_0) = 0\)`

---

### Переход от ковариации к вариограмме

`$$Cov \Bigg[\sum_{i=1}^N \lambda_i Z(x_i), \sum_{j=1}^M \mu_j Z(x_j) \Bigg] = \sum_{i=1}^N \sum_{j=1}^M \lambda_i \mu_j C(x_j - x_i)$$`

`$$Cov \Bigg[\sum_{i=1}^N \lambda_i Z(x_i), \sum_{j=1}^M \mu_j Z(x_j) \Bigg] = - \sum_{i=1}^N \sum_{j=1}^M \lambda_i \mu_j \gamma(x_j - x_i)$$`

&gt; `\(\sigma_{ij} = -\gamma_{ij}\)`

---

## Обычный кригинг

`\(m(x) = a_0\)`, `\(Z^* = \sum_{i} \lambda_i Z_i + \lambda_0\)`

`$$E\big[(Z^* - Z_0)^2\big] = Var[Z^* - Z_0] + \big(E[Z^* - Z_0]\big)^2 =\\
= Var[Z^* - Z_0] + \Bigg[\lambda_0 + \bigg(\sum_i \lambda_i - 1 \bigg) a_0 \Bigg]^2$$`

---

## Обычный кригинг

`$$Var[Z^* - Z_0] = \sum_{i}\sum_{j} \lambda_i \lambda_j \sigma_{ij} - 2 \sum_{} \lambda_i \sigma_{i0} + \sigma_{00}$$`

`\(\sum \lambda_i -1 = 0\)`:

`$$Q = Var[Z^* - Z_0] + 2\mu \bigg(\sum_i \lambda_i - 1 \bigg),$$`

где `\(\mu\)` -- ...

---

## Обычный кригинг

`$$Q = Var[Z^* - Z_0] + 2\mu \bigg(\sum_i \lambda_i - 1 \bigg)$$`

`$$\begin{cases}\frac{\partial Q}{\partial \lambda_i} = 2 \sum_j \lambda_j \sigma_{ij} - 2 \sigma_{i0} + 2\mu = 0,~i = 1,...,N,\\
\frac{\partial Q}{\partial \mu} = 2\bigg(\sum_i \lambda_i - 1 \bigg) = 0
\end{cases}$$`

---

## Обычный кригинг

`$$\begin{cases}\sum_j \lambda_j \sigma_{ij} + \mu = \sigma_{i0},~i = 1,...,N,\\
\sum_i \lambda_i = 1
\end{cases}$$`

`$$\color{red}{\boxed{\color{blue}{\begin{cases}\sum_j \lambda_j \gamma_{ij} - \mu = \gamma_{i0},\color{gray}{~i = 1,...,N,}\\
\sum_i \lambda_i = 1
\end{cases}}}}$$`

---

## Дисперсия обычного кригинга

`$$\sum_j \lambda_j \gamma_{ij} - \mu = \gamma_{i0}~\Bigg|\times \lambda_i$$`

`$$\color{red}{\boxed{\color{blue}{\sigma_{OK} = Var[Z^* - Z_0] = \sum_{i}\lambda_i\gamma_{i0} - \mu}}}$$`

---

## Универсальный кригинг

`$$Z(x) = m(x) + Y(x)$$`

- `\(m(x)\)` — ...

- `\(Y(x)\)` - ..;

&gt; Декомпозиция любого явления на дрифт и остаток зависит от масштаба рассмотрения явления. 

---

## Универсальный кригинг

`$$m(x) = \sum_{k=0}^{K} a_k f^k(x),$$`

где `\(f^k(x)\)` — ..., а `\(a_k\)` — ....

---

## Универсальный кригинг

`$$m(x) = \sum_{k=0}^{K} a_k f^k(x),$$`

---

## Универсальный кригинг

`$$Z(x) = a_0 + a_1 H(x) + Y(x)$$`

---

## Универсальный кригинг

`$$E[Z^* - Z_0]^2 = Var[Z^* - Z_0] + \big(E[Z^* - Z_0]\big)^2$$`

`\(m(x) = \sum_{k=0}^{K} a^k f^k(x)\)`:

`$$E[Z^* - Z_0] = E[Z^*\big] - E[Z_0] = \\
\sum_i \lambda_i \sum_k a_k f_i^k - \sum_k a_k f_0^k = \sum_k a_k \Bigg(\sum_i \lambda_i f_i^k - f_0^k\Bigg)$$`

---

## Универсальный кригинг

`$$E[Z^* - Z_0] = \sum_k a_k \Bigg(\sum_i \lambda_i f_i^k - f_0^k\Bigg)$$`

`$$\sum_i \lambda_i f_i^k = f_0^k,~k = 0, 1, ..., K.$$`

Эти условия называются ...

---

## Универсальный кригинг

`$$Var[Z^* - Z_0] = \sum_{i}\sum_{j} \lambda_i \lambda_j \sigma_{ij} - 2 \sum_{} \lambda_i \sigma_{i0} + \sigma_{00}$$`

`\(\sum_i \lambda_i f_i^k = f_0^k\)`:

`$$Q = Var[Z^* - Z_0] + 2 \sum_{k=0}^K \mu_k \Bigg[ \sum_i \lambda_i f_i^k - f_0^k\Bigg],$$`

`\(\mu_k,~k = 0, 1, ..., K\)` представляют ...

---

## Универсальный кригинг

`$$Var[Z^* - Z_0] = \sum_{i}\sum_{j} \lambda_i \lambda_j \sigma_{ij} - 2 \sum_{} \lambda_i \sigma_{i0} + \sigma_{00}$$`

`$$\begin{cases}\frac{\partial Q}{\partial \lambda_i} = 2 \sum_j \lambda_j \sigma_{ij} -2 \sigma_{i0} + 2 \sum_k \mu_k f_i^k = 0,\color{gray}{~i = 1,...,N,}\\
\frac{\partial Q}{\partial \mu} = 2\bigg[\sum_i \lambda_i f_i^k - f_0^k \bigg] = 0\color{gray}{,~k = 0, 1,..., K.}
\end{cases}$$`

---

## Универсальный кригинг

`$$\begin{cases}\sum_j \lambda_j \sigma_{ij} + \sum_k \mu_k f_i^k = \sigma_{i0},~i = 1,...,N,\\
\sum_i \lambda_i f_i^k = f_0^k,~k = 0, 1,..., K.
\end{cases}$$`

`$$\color{red}{\boxed{\color{blue}{\begin{cases}\sum_j \lambda_j \gamma_{ij} - \sum_k \mu_k f_i^k = \gamma_{i0},\color{gray}{~i = 1,...,N,}\\
\sum_i \lambda_i f_i^k = f_0^k\color{gray}{,~k = 0, 1,..., K.}
\end{cases}}}}$$`

---

## Дисперсия универсального кригинга

`$$\sum_j \lambda_j \gamma_{ij} - \sum_k \mu_k f_i^k = \gamma_{i0} ~ \Bigg|\times \lambda_i$$`

`$$\color{red}{\boxed{\color{blue}{\sigma^2_{UK} = E[Z^* - Z_0]^2 = \sum_{i}\lambda_i\gamma_{i0} - \sum_k \mu_k f_0^k}}}$$`

---

## Кросс-валидация

`\(Z_{-i}^*\)`, `\(\sigma_{Ki}^2\)`, `\(Z_i = Z(x_i)\)`

- ... `\(E_i = Z_{-i}^* - Z_i\)`
- ... `\(e_i = E_i / \sigma_{Ki}\)`

---

## Кросс-валидация

Стандартно анализируются следующие карты и графики:

- ... `\(e_i\)`.

- ... `\(e_i\)`.

- `\((Z_{-i}^*, Z_i)\)`.

- `\((Z_{-i}^*, e_i)\)`.

---

## Вариограмма

`$$\gamma (\mathbf{h}) = \gamma(\mathbf{x}, \mathbf{x + h}) = E\big[Z(x + h)-Z(x)\big]^2$$`

`$$\gamma(\mathbf{h}) = \frac{1}{2N(h)}\sum_{i=1}^{N(\mathbf{h})} \big[Z(\mathbf{x_i}) - Z(\mathbf{x_i + h})\big]^2$$`

---

## Свойства вариограммы

  `$$\gamma(\mathbf{x}) = \gamma(-\mathbf{x})$$`
  
  `$$\gamma(\infty) = Var\big[ Z(\mathbf{x}) \big]$$`
  
  `$$\gamma(\mathbf{h}) = Var\big[ Z(\mathbf{x}) \big] - C(\mathbf{h})$$`

---

## ... модель

`$$\gamma(h) = \begin{cases}
  c_0 + c\Big[\frac{3h}{2a} - \frac{1}{2}\big(\frac{h}{a}\big)^3\Big], &amp; h \leq a; \\
  c_0 + c, &amp; h &gt; a.
\end{cases}$$`

`$$\gamma(a) = Var[Z(p)] = c_0 + c$$`

&lt;img src="14-Geostatistics_slides_raw_files/figure-html/unnamed-chunk-1-1.png" style="display: block; margin: auto;" /&gt;

&lt;!-- - Данная модель достигает плато в точке `\(h = a\)`. --&gt;

---

## ... модель

`$$\gamma(h) = \begin{cases}
  0, &amp; h = 0; \\
  c_0 + (c-c_0)\Big[1 - \exp\big(\frac{-3h}{a}\big)\Big], &amp; h \neq 0.
\end{cases}$$`

`$$\gamma(a) = Var[Z(p)] = c_0 + c$$`
&lt;img src="14-Geostatistics_slides_raw_files/figure-html/unnamed-chunk-2-1.png" style="display: block; margin: auto;" /&gt;

---

## ... модель

&lt;img src="14-Geostatistics_slides_raw_files/figure-html/unnamed-chunk-3-1.png" style="display: block; margin: auto;" /&gt;

---

## ... модель

`$$\gamma(h) = c_0 + c\Bigg[1 - \exp\bigg(\frac{-3h^2}{a^2}\bigg)\Bigg]$$`

&lt;img src="14-Geostatistics_slides_raw_files/figure-html/unnamed-chunk-4-1.png" style="display: block; margin: auto;" /&gt;

---

## ... модель

&lt;img src="14-Geostatistics_slides_raw_files/figure-html/unnamed-chunk-5-1.png" style="display: block; margin: auto;" /&gt;

---

### ... модель

`$$\gamma(h) = \begin{cases}
  0, &amp; h = 0; \\
  c h^\alpha, &amp; h \neq 0.
\end{cases}$$`

&lt;img src="14-Geostatistics_slides_raw_files/figure-html/unnamed-chunk-6-1.png" style="display: block; margin: auto;" /&gt;

---

### ... модель

&lt;img src="14-Geostatistics_slides_raw_files/figure-html/unnamed-chunk-7-1.png" style="display: block; margin: auto;" /&gt;

---

## Эффект ... (модель ...)

`$$\gamma(h) = \begin{cases}
  0, &amp; h = 0; \\
  c_0, &amp; h \neq 0.
\end{cases}, ~ c_0 = C(0)$$`

&lt;img src="14-Geostatistics_slides_raw_files/figure-html/sam-1.png" style="display: block; margin: auto;" /&gt;

---

## Эффект ... (модель ...)

&lt;img src="14-Geostatistics_slides_raw_files/figure-html/unnamed-chunk-8-1.png" style="display: block; margin: auto;" /&gt;
  
---

## Диаграмма ...

&lt;img src="14-Geostatistics_slides_raw_files/figure-html/unnamed-chunk-9-1.png" style="display: block; margin: auto;" /&gt;


---

## ... облако

![](14-Geostatistics_slides_raw_files/figure-html/unnamed-chunk-10-1.png)&lt;!-- --&gt;
  
---

## Эмпирическая ...
  
![](14-Geostatistics_slides_raw_files/figure-html/unnamed-chunk-11-1.png)&lt;!-- --&gt;

---

## Эмпирическая ...

`$$\hat{\gamma} = \frac{1}{2N_h} \sum_{x_i - x_j \approx h} \big[z(x_i) - z(x_j)\big]^2$$`

![](14-Geostatistics_slides_raw_files/figure-html/unnamed-chunk-12-1.png)&lt;!-- --&gt;

---

## Эмпирическая ...

![](14-Geostatistics_slides_raw_files/figure-html/unnamed-chunk-13-1.png)&lt;!-- --&gt;

---

## ...карта

__...карта__ представляет ... как функцию ...:

`$$\hat{\gamma} (\Delta x, \Delta y) = \frac{1}{2N_{\substack{\Delta x\\ \Delta y}}} \sum_{\substack{\Delta x_{ij} \approx \Delta x\\ \Delta y_{ij} \approx \Delta y}} \big[z(p_i) - z(p_j)\big]^2$$`
.pull-left[
![](14-Geostatistics_slides_raw_files/figure-html/unnamed-chunk-14-1.png)&lt;!-- --&gt;
]
.pull-right[
...карта используется для выявления _..._. Профиль по линии из центра к краю ...карты даст ...]
---

## Приближение теоретической модели

![](14-Geostatistics_slides_raw_files/figure-html/unnamed-chunk-15-1.png)&lt;!-- --&gt;

---

## Автоматическое приближение

`\(\gamma (h; \mathbf{b})\)`, `\(\mathbf{b} = (b_1, ..., b_k)\)`:

`$$Q(\mathbf{b}) = \sum_{l=1}^{L} w_l \big[\hat{\gamma}(h_l) - \gamma (h; \mathbf{b})\big]^2,$$`

`\(\big\{\hat{\gamma} (h_l): l = 1,...,L\big\}\)`

`\(w_l = N(h_l) / |h_l|\)`.

---

## Автоматическое приближение

`$$Q(\mathbf{b}) = \sum_{l=1}^{L} w_l \big[\hat{\gamma}(h_l) - \gamma (h; \mathbf{b})\big]^2$$`

1. `\(\mathbf{b}^{(0)}\)`
2. `\(Q(\mathbf{b}^{(s)}) \approx \sum_{i=1}^k \sum_{j=1}^k \delta_{ij} b_i b_j\)`, `\(\mathbf{b}^{(s)}\)`.
3. `\(\mathbf{b}^{(s+1)}\)`.

---

## Автоматическое приближение

![](14-Geostatistics_slides_raw_files/figure-html/unnamed-chunk-16-1.png)&lt;!-- --&gt;

---

## Обычный кригинг

![](14-Geostatistics_slides_raw_files/figure-html/unnamed-chunk-17-1.png)&lt;!-- --&gt;

---

## Обычный кригинг


```r
tempkriged = krige(rain_24~1, rainfall, pts.grid, model = varmd)
```

```
## [using ordinary kriging]
```

```r
head(tempkriged@data)
```

```
##   var1.pred var1.var
## 1  18.29349 91.09811
## 2  18.52693 79.15896
## 3  18.88785 68.34137
## 4  19.80443 59.91650
## 5  21.81098 54.09888
## 6  23.91279 49.17230
```

```r
temps = SpatialPixelsDataFrame(tempkriged, data = tempkriged@data['var1.pred']) %&gt;% raster()
vars = SpatialPixelsDataFrame(tempkriged, data = tempkriged@data['var1.var']) %&gt;% raster()
```

---

## Оценка и дисперсия кригинга

![](14-Geostatistics_slides_raw_files/figure-html/unnamed-chunk-19-1.png)&lt;!-- --&gt;![](14-Geostatistics_slides_raw_files/figure-html/unnamed-chunk-19-2.png)&lt;!-- --&gt;

---

## Кросс-валидация


```r
cvl = krige.cv(rain_24~1, rainfall, varmd) %&gt;% 
  st_as_sf() %&gt;% 
  mutate(sterr = residual / sqrt(var1.var))

head(cvl %&gt;% st_set_geometry(NULL), 10)
```

```
##    var1.pred var1.var observed     residual      zscore fold       sterr
## 1   5.743730 34.84033      6.0   0.25627005  0.04341669    1  0.04341669
## 2  11.137129 60.24070     10.0  -1.13712865 -0.14650910    2 -0.14650910
## 3   6.929502 47.22732      7.0   0.07049833  0.01025846    3  0.01025846
## 4  23.252858 48.06354      1.0 -22.25285758 -3.20979954    4 -3.20979954
## 5  15.655167 56.76258      1.0 -14.65516724 -1.94517957    5 -1.94517957
## 6  11.794241 44.03055      1.0 -10.79424095 -1.62672846    6 -1.62672846
## 7  11.325378 62.65261      0.1 -11.22537769 -1.41818009    7 -1.41818009
## 8  28.421330 75.24988      0.2 -28.22133030 -3.25330355    8 -3.25330355
## 9   2.340115 58.30350      1.0  -1.34011550 -0.17550719    9 -0.17550719
## 10  3.489972 62.96551      0.2  -3.28997242 -0.41461106   10 -0.41461106
```

---

## Кросс-валидация

![](14-Geostatistics_slides_raw_files/figure-html/unnamed-chunk-21-1.png)&lt;!-- --&gt;

---

## Кросс-валидация

![](14-Geostatistics_slides_raw_files/figure-html/unnamed-chunk-22-1.png)&lt;!-- --&gt;

---

## Кросс-валидация

![](14-Geostatistics_slides_raw_files/figure-html/unnamed-chunk-23-1.png)&lt;!-- --&gt;

---

## Кросс-валидация

![](14-Geostatistics_slides_raw_files/figure-html/unnamed-chunk-24-1.png)&lt;!-- --&gt;
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
